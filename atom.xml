<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Leilei&#39;s Blog | ç£Šç£Šçš„åšå®¢</title>
  
  <subtitle>Because it&#39;s there</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.llchen60.com/"/>
  <updated>2022-09-17T03:53:15.657Z</updated>
  <id>https://www.llchen60.com/</id>
  
  <author>
    <name>Leilei Chen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è§‚å¯Ÿè€…æ¨¡å¼å®ç°</title>
    <link href="https://www.llchen60.com/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-1/"/>
    <id>https://www.llchen60.com/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-1/</id>
    <published>2022-09-17T03:49:49.000Z</published>
    <updated>2022-09-17T03:53:15.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-è§‚å¯Ÿè€…æ¨¡å¼Overview"><a href="#1-è§‚å¯Ÿè€…æ¨¡å¼Overview" class="headerlink" title="1. è§‚å¯Ÿè€…æ¨¡å¼Overview"></a>1. è§‚å¯Ÿè€…æ¨¡å¼Overview</h1><ul><li>å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„äº¤äº’æ–¹å¼ï¼Œå¯ä»¥è¢«è§‚å¯Ÿçš„å¯¹è±¡å¯ä»¥é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ä»–ä»¬æœŸå¾…çš„å¯¹è±¡çš„å˜åŒ–ï¼ŒPull vs Push.<ul><li>å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€çš„æ—¶å€™ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶ä¸”ä¼šè‡ªåŠ¨æ›´æ–°</li></ul></li><li>Subject/ Observable<ul><li>ç®¡ç†æŸäº›æ•°æ®</li><li>å½“æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œé€šçŸ¥è®¢é˜…è€…</li></ul></li><li>Observer<ul><li>åœ¨è®¢é˜…çš„æ•°æ®å‘ç”Ÿæ”¹å˜äº†ä»¥åï¼Œå¾—åˆ°é€šçŸ¥</li></ul></li></ul><h1 id="2-ä½¿ç”¨åœºæ™¯"><a href="#2-ä½¿ç”¨åœºæ™¯" class="headerlink" title="2. ä½¿ç”¨åœºæ™¯"></a>2. ä½¿ç”¨åœºæ™¯</h1><ul><li>å‡ºç‰ˆè€… + è®¢é˜…è€…</li><li>Check Java Observable, though deprecated</li></ul><h1 id="3-ä½¿ç”¨ç›®çš„"><a href="#3-ä½¿ç”¨ç›®çš„" class="headerlink" title="3. ä½¿ç”¨ç›®çš„"></a>3. ä½¿ç”¨ç›®çš„</h1><ul><li>è´£ä»»çš„åˆ†å¼€ï¼Œåªæœ‰ä¸€ä»½æ•°æ®ï¼Œç”±Observableæ¥è¿›è¡Œç®¡ç†ï¼Œ</li><li>Observeråªæ˜¯æ‹¿åˆ°äº†æ•°æ®çš„æ›´æ–°ï¼Œç„¶ååšè‡ªå·±ç‰¹å®šçš„äº‹æƒ…ï¼Œobservableå®Œå…¨ä¸éœ€è¦çŸ¥é“è¿™é‡Œçš„ç»†èŠ‚ã€‚ç”¨è¿™ç§æ–¹å¼å®ç°äº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆ</li></ul><h1 id="4-å…·ä½“å®ç°"><a href="#4-å…·ä½“å®ç°" class="headerlink" title="4. å…·ä½“å®ç°"></a>4. å…·ä½“å®ç°</h1><p><img src="https://s2.loli.net/2022/09/17/pSb5gUW3ynxAroB.png" alt="Class Diagram"></p><h2 id="4-1-æ¥å£å’Œæ•°æ®å¯¹è±¡å®šä¹‰"><a href="#4-1-æ¥å£å’Œæ•°æ®å¯¹è±¡å®šä¹‰" class="headerlink" title="4.1 æ¥å£å’Œæ•°æ®å¯¹è±¡å®šä¹‰"></a>4.1 æ¥å£å’Œæ•°æ®å¯¹è±¡å®šä¹‰</h2><pre><code class="java">/** * Observer other abilities */public interface IDisplay &#123;    void display();&#125;/*** Observable interface, used to register/remove/notify observers */public interface IObservable &#123;    ActionResult registerObserver(IObserver observer);    ActionResult removeObserver(IObserver observer);    void notifyObservers();&#125;/** * Observable will call update method for regiestered observer to update the status in observer side */public interface IObserver &#123;    void update(SharebleData data);@Data@RequiredArgsConstructor@AllArgsConstructorpublic class SharebleData &#123;    Double temperature;    Double humidity;    Double pressure;&#125;public enum Status &#123;    SUCCESS,    FAILURE&#125;@Data@AllArgsConstructorpublic class ActionResult &#123;    @NonNull    Status status;    @Nullable    List&lt;String&gt; errorReason;&#125;</code></pre><h2 id="4-2-å…·ä½“å®ç°ç±»çš„å®šä¹‰"><a href="#4-2-å…·ä½“å®ç°ç±»çš„å®šä¹‰" class="headerlink" title="4.2 å…·ä½“å®ç°ç±»çš„å®šä¹‰"></a>4.2 å…·ä½“å®ç°ç±»çš„å®šä¹‰</h2><pre><code class="java">public class ObservableImpl implements IObservable&#123;    private static List&lt;IObserver&gt; observerList;    private SharebleData data;    public ObservableImpl() &#123;        observerList = new ArrayList&lt;&gt;();        data = new SharebleData();    &#125;    public void setSharebleData(double tem, double humidity, double pressure) &#123;        data.setHumidity(humidity);        data.setTemperature(tem);        data.setPressure(pressure);        notifyObservers();    &#125;    @Override    public ActionResult registerObserver(IObserver observer) &#123;        observerList.add(observer);        return new ActionResult(Status.SUCCESS, null);    &#125;    @Override    public ActionResult removeObserver(IObserver observer) &#123;        observerList.remove(observer);        return new ActionResult(Status.SUCCESS, null);    &#125;    @Override    public void notifyObservers() &#123;        observerList.forEach(observer -&gt; &#123;observer.update(data);&#125;);    &#125;&#125;public class CurrentConditionDisplay implements IObserver, IDisplay&#123;    private double temp;    private double pressure;    private IObservable observable;    public CurrentConditionDisplay(IObservable subject) &#123;        this.observable = subject;        observable.registerObserver(this);    &#125;    @Override    public void display() &#123;        System.out.println(String.format(&quot;======= print out current tem and pressure! temp: %f, pressure: %f &quot;, temp, pressure));    &#125;    @Override    public void update(SharebleData data) &#123;        temp = data.getTemperature();        pressure = data.getPressure();        display();    &#125;&#125;</code></pre><h2 id="4-3-æµ‹è¯•"><a href="#4-3-æµ‹è¯•" class="headerlink" title="4.3 æµ‹è¯•"></a>4.3 æµ‹è¯•</h2><pre><code class="java">@RestControllerpublic class TestController &#123;    @GetMapping(&quot;/observer&quot;)    public String observer() &#123;        StringBuilder sb = new StringBuilder();        ObservableImpl observable = new ObservableImpl();        observable.setSharebleData(30, 0.7, 80);        CurrentConditionDisplay currentConditionDisplay = new CurrentConditionDisplay(observable);        observable.setSharebleData(31, 0.7, 80);        observable.setSharebleData(32, 0.7, 80);        observable.setSharebleData(33, 0.7, 80);        return &quot;Please check log&quot;;    &#125;&#125;// Output from console ======= print out current tem and pressure! temp: 31.000000, pressure: 80.000000 ======= print out current tem and pressure! temp: 32.000000, pressure: 80.000000 ======= print out current tem and pressure! temp: 33.000000, pressure: 80.000000 </code></pre><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://learning.oreilly.com/library/view/head-first-design/9781492077992/ch02.html">https://learning.oreilly.com/library/view/head-first-design/9781492077992/ch02.html</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-è§‚å¯Ÿè€…æ¨¡å¼Overview&quot;&gt;&lt;a href=&quot;#1-è§‚å¯Ÿè€…æ¨¡å¼Overview&quot; class=&quot;headerlink&quot; title=&quot;1. è§‚å¯Ÿè€…æ¨¡å¼Overview&quot;&gt;&lt;/a&gt;1. è§‚å¯Ÿè€…æ¨¡å¼Overview&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„äº¤
      
    
    </summary>
    
    
      <category term="Design Pattern" scheme="https://www.llchen60.com/categories/Design-Pattern/"/>
    
    
  </entry>
  
  <entry>
    <title>How to use Sprint transactional annotation</title>
    <link href="https://www.llchen60.com/How-to-use-Sprint-transactional-annotation/"/>
    <id>https://www.llchen60.com/How-to-use-Sprint-transactional-annotation/</id>
    <published>2022-07-15T12:58:18.000Z</published>
    <updated>2022-07-15T12:59:24.908Z</updated>
    
    <content type="html"><![CDATA[<h1 id="How-to-use-Sprint-transactional-annotation"><a href="#How-to-use-Sprint-transactional-annotation" class="headerlink" title="How to use Sprint transactional annotation"></a>How to use Sprint transactional annotation</h1><h1 id="1-Attributes"><a href="#1-Attributes" class="headerlink" title="1. Attributes"></a>1. Attributes</h1><ul><li><code>value</code> and <code>transactionManager</code><ul><li>used to provide a TransactionManager reference to be used when handling the transaction for the annotated block</li></ul></li><li><code>propagation</code><ul><li>define how the transaction boundaries propagate to other methods that will be called either directly or indirectly from within the annotated block</li><li>default is <code>REQUIRED</code><ul><li>means a transaction is started if no transaction is already available</li><li>otherwise use the current running thread</li></ul></li></ul></li><li><code>timeout</code> and <code>timeoutString</code><ul><li>define the max number of seconds the current method is allowed to run</li></ul></li><li><code>readOnly</code><ul><li>defines if the current transaction is read-only or read-write</li></ul></li><li><code>rollbackFor</code> and <code>rollbackForClassName</code><ul><li>define one or more Throwable classes for which the current transaction will be rolled back</li><li>default is RuntimeException or an Error is thrown, but not for a checked Exception</li></ul></li><li><code>noRollbackFor</code> and <code>noRollbackForClassName</code><ul><li>used for one or more RuntimeException</li></ul></li></ul><h1 id="2-Transaction-Override"><a href="#2-Transaction-Override" class="headerlink" title="2. Transaction Override"></a>2. Transaction Override</h1><ul><li><code>addStatementReportOperation</code> is using the serializeble level, which override the class level readonly transaction</li></ul><pre><code class="java">@Service@Transactional(readOnly = true)public class OperationService &#123;    @Transactional(isolation = Isolation.SERIALIZABLE)    public boolean addStatementReportOperation(        String statementFileName,        long statementFileSize,        int statementChecksum,        OperationType reportType) &#123;        ...    &#125;&#125;</code></pre><ul><li>we use readOnly in class level because Spring could perform some read only optimization<ul><li>we could save memory when loading read only entities since the loaded state is discarded right away, and not kept for the whole duration of the currently running persistence context</li><li>also, in the cluster, read only data source could be redirected to DB replica instead of DB primary, this could also reduce the burden for primary</li></ul></li></ul><ol><li><a href="https://stackoverflow.com/questions/10394857/how-to-use-transactional-with-spring-data#:~:text=Thus%20we%20recommend%20using%20%40Transactional,re%2Ddecorated%20in%20that%20interface">https://stackoverflow.com/questions/10394857/how-to-use-transactional-with-spring-data#:~:text=Thus we recommend using %40Transactional,re-decorated in that interface</a> </li><li><a href="https://vladmihalcea.com/spring-read-only-transaction-hibernate-optimization/">https://vladmihalcea.com/spring-read-only-transaction-hibernate-optimization/</a>  </li><li><a href="https://vladmihalcea.com/spring-transactional-annotation/">https://vladmihalcea.com/spring-transactional-annotation/</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;How-to-use-Sprint-transactional-annotation&quot;&gt;&lt;a href=&quot;#How-to-use-Sprint-transactional-annotation&quot; class=&quot;headerlink&quot; title=&quot;How to u
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="Spring" scheme="https://www.llchen60.com/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>PG::DuplicatePstatement Error prepared statement axxx already exists</title>
    <link href="https://www.llchen60.com/PG-DuplicatePstatement-Error-prepared-statement-axxx-already-exists/"/>
    <id>https://www.llchen60.com/PG-DuplicatePstatement-Error-prepared-statement-axxx-already-exists/</id>
    <published>2022-07-01T14:04:04.000Z</published>
    <updated>2022-07-01T14:05:31.350Z</updated>
    
    <content type="html"><![CDATA[<p>Thatâ€™s an interesting issue we faced in production during one deployment which only contain some frontend changes. </p><p>Upon check, this happens in such scenario: </p><pre><code class="java">A prepared statement is generated in postgresql, but never stored in rails. Since the code was interrupted before storing the statement, the @counter variable was never incremented even though it was used to generate a prepared statement.</code></pre><p>That pretty much described the issue, prepared statement on postgres side is a server side object that can be used to optimize performance. When the <code>PREPARE</code><br> statement is executed, the specified statement is parsed, analyzed, and rewritten. When an <code>EXECUTE</code>command is subsequently issued, the prepared statement is planned and executed.  </p><p>When the identifiers already bound to existing prepared statements but rails does not realize it, this issue will be happened. </p><p>here is the fix </p><p><a href="https://github.com/rails/rails/pull/41356/files">https://github.com/rails/rails/pull/41356/files</a></p><pre><code class="java">def next_key     &quot;a#&#123;@counter + 1&#125;&quot;end def next_key     &quot;a#&#123;@counter += 1&#125;&quot;end This change make the postgres prepared statement counter before makeing a prepared statementThus if the statemnt is aborted in rails side, app won&#39;t end up in perpetual crash state </code></pre><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://github.com/rails/rails/issues/1627">https://github.com/rails/rails/issues/1627</a></li><li><a href="https://github.com/rails/rails/pull/25827">https://github.com/rails/rails/pull/25827</a></li><li><a href="https://github.com/rails/rails/pull/17607">https://github.com/rails/rails/pull/17607</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Thatâ€™s an interesting issue we faced in production during one deployment which only contain some frontend changes. &lt;/p&gt;
&lt;p&gt;Upon check, th
      
    
    </summary>
    
    
      <category term="Ruby" scheme="https://www.llchen60.com/categories/Ruby/"/>
    
    
      <category term="Postgres" scheme="https://www.llchen60.com/tags/Postgres/"/>
    
  </entry>
  
  <entry>
    <title>Equity 101</title>
    <link href="https://www.llchen60.com/Equity-101/"/>
    <id>https://www.llchen60.com/Equity-101/</id>
    <published>2022-04-02T09:08:11.000Z</published>
    <updated>2022-04-02T09:09:25.877Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-What-is-equity"><a href="#1-What-is-equity" class="headerlink" title="1. What is equity?"></a>1. What is equity?</h1><ul><li>A form of compensation<ul><li>give you partial ownership in the company<ul><li>shares<ul><li>options</li><li>RSUs</li></ul></li></ul></li><li>can have seriously life changing result</li></ul></li><li>Liquidity<ul><li>the ability to sell your shares</li></ul></li></ul><h1 id="2-Cap-Table"><a href="#2-Cap-Table" class="headerlink" title="2. Cap Table"></a>2. Cap Table</h1><ul><li>A document that details who has ownership in a company</li><li>records<ul><li>how and when youâ€™ll get your shares</li><li>how many shares youâ€™ll get</li><li>how youâ€™ll be paid out</li></ul></li><li>employee option pool<ul><li>investors require it, to hire talented people</li><li>let talented stay longer</li></ul></li><li>different types of equity<ul><li>preferred shares â€” investors</li><li>stock options â€” employees</li><li>advisory shares â€” advisors</li></ul></li></ul><h1 id="3-Equity-grants"><a href="#3-Equity-grants" class="headerlink" title="3. Equity grants"></a>3. Equity grants</h1><ul><li><p>equity grant agreements</p><ul><li>how many shares you are getting</li><li>how much each share is worth</li><li>how long it will take to vest all your shares</li></ul></li><li><p>types of equity</p><ul><li>stock option â€” early stage<ul><li>you have the option to buy shares, but not obligated to</li><li>only vest on a single trigger</li><li>taxed when you buy/ sell your shares</li><li>option types<ul><li>incentive stock option<ul><li>pay tax when you sell your shares</li></ul></li><li>non qualified stock option<ul><li>pay taxes when you buy and sell shares</li></ul></li></ul></li></ul></li><li>restricted stock units - large startup<ul><li>you receive shares that you own automatically</li><li>often vest on a double trigger</li><li>taxed when get vested</li></ul></li></ul></li></ul><h1 id="4-How-vesting-work"><a href="#4-How-vesting-work" class="headerlink" title="4. How vesting work"></a>4. How vesting work</h1><ul><li>Earning the right to buy your shares<ul><li>when you are taxed</li><li>when you are able to buy shares</li></ul></li><li>vesting structures<ul><li>time based vesting</li><li>event based vesting</li><li>hybrid vesting</li></ul></li><li>option outstanding<ul><li>options has not been granted</li></ul></li></ul><h1 id="5-How-exercising-equity-works"><a href="#5-How-exercising-equity-works" class="headerlink" title="5. How exercising equity works"></a>5. How exercising equity works</h1><ul><li>Being granted stock options doesnâ€™t mean youâ€™re automatically a shareholder in a company.</li><li>Stock option not means share, you need to buy it</li><li>exercise<ul><li>means you purchase stock at a specified price</li><li>purchase your options</li><li>then company give stock certificate</li></ul></li><li>strike price<ul><li>option price you could leverage on to buy stocks</li><li>fixed price</li></ul></li><li>409A valuation<ul><li>an analysis of your companyâ€™s financials, which determines the value of the companyâ€™s shares</li><li>usually done every 12 months</li><li>Fair Market Value - FMV<ul><li>the value of one share of common stock</li></ul></li></ul></li><li>Spread/ Gain<ul><li>the difference between stock price and strike price</li></ul></li><li>PTEP - post termination exercise period<ul><li>the amount of time you have to exercise your options after you leave the company</li></ul></li><li>early exercise<ul><li>company let you buy everything today</li><li>then you just need to pay taxes at strike price</li><li>83b election<ul><li>a form sent to IRS</li><li>you want to pay tax now</li></ul></li></ul></li></ul><h1 id="6-How-to-sell-shares"><a href="#6-How-to-sell-shares" class="headerlink" title="6. How to sell shares"></a>6. How to sell shares</h1><ul><li>How and when can you sell your shares<ul><li>think about<ul><li>any restrictions on selling?</li><li>do you need the cash?</li><li>is the value increasing?</li><li>only chance to sell?</li></ul></li></ul></li><li>ways<ul><li>public company<ul><li>public shares pretty liquid,<ul><li>as itâ€™s easy to convert them into cash at market price</li></ul></li></ul></li><li>private company<ul><li>strongly restrict sell usually</li><li>ways<ul><li>IPO<ul><li>usually 6 month lock up period after going public</li></ul></li><li>M&amp;A<ul><li>bought or merge   acquisition</li><li>another company buys your shares<ul><li>pay for cash or other stocks</li></ul></li></ul></li><li>tender offer<ul><li>company buy from employee</li><li>could happen while the company still private</li></ul></li></ul></li></ul></li></ul></li></ul><h1 id="7-How-are-equity-grants-taxed"><a href="#7-How-are-equity-grants-taxed" class="headerlink" title="7. How are equity grants taxed?"></a>7. How are equity grants taxed?</h1><ul><li>ISO shares<ul><li>when sell it, tax rate come to be different</li></ul></li><li>qualifying disposition<ul><li>1 year after exercise</li><li>2 years after option grant date</li></ul></li><li>long term capital gains tax<ul><li>0% 0 20%</li></ul></li><li>short term capital gains<ul><li>taxed at ordinary income rates</li></ul></li><li>AMT<ul><li>alternative minimum tax</li><li>a low threshold, or floor, defining the minimum amount of taxes you are obligated to pay</li></ul></li></ul><h1 id="8-Valuations"><a href="#8-Valuations" class="headerlink" title="8. Valuations"></a>8. Valuations</h1><ul><li>dilution<ul><li>affect the percentage you have</li></ul></li><li>how valuation works<ul><li>term sheet<ul><li>a legal document defining the terms of an investment</li></ul></li><li>valuation<ul><li>an appraisal of a companyâ€™s worth</li><li>affect<ul><li>how many shares</li><li>price per shares</li><li>percentage</li></ul></li></ul></li></ul></li><li>stage<ul><li>pre money valuation<ul><li>post money matters you</li><li>the employee stock option poolâ€”that percentage of the company that gets carved out for new hires and new employees? Well, if you think about how dilution works, when an option pool gets carved out, it reduces the ownership percentage of all of the other shareholders. So thatâ€™s why a lot of the time, when an investor puts money into a company, theyâ€™ll require that this option pool gets sliced out of the company on a pre-money basis.</li></ul></li><li>investment</li><li>post money valuation</li></ul></li><li>how valuations are calculated<ul><li>valuation for startup come to be complex,<ul><li>revenue, profit, tax, etc.</li><li>growth rate</li><li>user count</li><li>industry</li><li>founding team</li></ul></li><li>section 409A<ul><li>let 3rd party help do valuation for the startup</li><li>every 12 months</li><li>or every time do a new fund raising</li></ul></li></ul></li></ul><h1 id="9-Who-can-invest-in-startups"><a href="#9-Who-can-invest-in-startups" class="headerlink" title="9. Who can invest in startups"></a>9. Who can invest in startups</h1><ul><li>For private company<ul><li>no need to release any info to public</li><li>less info and more risk comparing with public company investment</li></ul></li><li>who can invest in a startup<ul><li>accredited investor<ul><li>more relevant to individuals</li><li>criteria (either one of them)<ul><li>net worth  over a million, not include the primary living place;</li><li>income  net income 200k per year for last 2 years. reasonable expectation in following year; for a family is 300k</li><li>passing a financial exam, hold a license</li></ul></li></ul></li><li>qualified purchaser<ul><li>more relevant for funds, institution,</li><li>all about investment, purchasing power</li><li>an entity that has a significant amount of investment capital â€” their purchasing power</li></ul></li></ul></li></ul><h1 id="10-How-venture-capital-works"><a href="#10-How-venture-capital-works" class="headerlink" title="10. How venture capital works"></a>10. How venture capital works</h1><ul><li>venture capital system<ul><li>equity financing<ul><li>angel investors</li><li>venture capital fund<ul><li>invest other peopleâ€™s money through fund</li></ul></li></ul></li><li>debt financing</li></ul></li><li>type of fundraising instruments<ul><li>convertible instrument<ul><li>investor iou, convert the note into shares, owns equity in the future<ul><li>control - startup not lose control in this way</li></ul></li><li>used for very early stage of startups</li></ul></li><li>priced round<ul><li>used at later stages, when the company is growing</li></ul></li></ul></li><li>type of investors<ul><li>accredited investor - angel investor</li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://carta.com/equity/learn/what-is-equity/">https://carta.com/equity/learn/what-is-equity/</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-What-is-equity&quot;&gt;&lt;a href=&quot;#1-What-is-equity&quot; class=&quot;headerlink&quot; title=&quot;1. What is equity?&quot;&gt;&lt;/a&gt;1. What is equity?&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;A fo
      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
      <category term="Equity" scheme="https://www.llchen60.com/tags/Equity/"/>
    
      <category term="RSU" scheme="https://www.llchen60.com/tags/RSU/"/>
    
  </entry>
  
  <entry>
    <title>System.nanoTime vs System.currentTimeMillis</title>
    <link href="https://www.llchen60.com/System-nanoTime-vs-System-currentTimeMillis/"/>
    <id>https://www.llchen60.com/System-nanoTime-vs-System-currentTimeMillis/</id>
    <published>2022-03-28T10:13:34.000Z</published>
    <updated>2022-03-28T10:14:08.401Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Monotonic-Clock"><a href="#1-Monotonic-Clock" class="headerlink" title="1. Monotonic Clock"></a>1. Monotonic Clock</h1><ul><li>suitable for measuring a duration, such as a timeout or a serviceâ€™s response time<ul><li><code>clock_gettime(CLOCK_MONOTONIC)</code></li><li><code>System.nanoTime()</code></li></ul></li><li>They are guaranteed to always move forward</li><li>However, the <em>absolute</em> value of the clock is meaningless: it might be the number of nanoseconds since the computer was started, or something similarly arbitrary. In particular, it makes no sense to compare monotonic clock values from two different computers, because they donâ€™t mean the same thing.<ul><li>On a server with multiple CPU sockets, there may be a separate timer per CPU, which is not necessarily synchronized with other CPUs</li></ul></li></ul><h1 id="2-Time-of-day-clock"><a href="#2-Time-of-day-clock" class="headerlink" title="2. Time of day clock"></a>2. Time of day clock</h1><ul><li>It returns the current date and time according to some calendar<ul><li><code>clock_gettime(CLOCK_REALTIME)</code></li><li><code>System.currentTimeMillis()</code><ul><li>return the number of seconds since the epoch</li></ul></li></ul></li><li>this time is synchronized with NTP, which means a timestamp from one machine ideally means the same as a timestamp on another machine</li><li>Oddies<ul><li>In particular, if the local clock is too far ahead of the NTP server, it may be forcibly reset and appear to jump back to a previous point in time. These jumps, as well as similar jumps caused by leap seconds, make time-of-day clocks unsuitable for measuring elapsed time</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Monotonic-Clock&quot;&gt;&lt;a href=&quot;#1-Monotonic-Clock&quot; class=&quot;headerlink&quot; title=&quot;1. Monotonic Clock&quot;&gt;&lt;/a&gt;1. Monotonic Clock&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;su
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="Java" scheme="https://www.llchen60.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Transaction Understanding</title>
    <link href="https://www.llchen60.com/Transaction-Understanding/"/>
    <id>https://www.llchen60.com/Transaction-Understanding/</id>
    <published>2022-03-25T03:16:10.000Z</published>
    <updated>2022-03-25T13:52:19.167Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Transaction-Understanding"><a href="#Transaction-Understanding" class="headerlink" title="Transaction Understanding"></a>Transaction Understanding</h1><h1 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h1><h2 id="1-1-Things-can-go-wrong"><a href="#1-1-Things-can-go-wrong" class="headerlink" title="1.1 Things can go wrong"></a>1.1 Things can go wrong</h2><ul><li>db software or hardware could fail at any time</li><li>application could crash at any time</li><li>interruptions in the network can unexpectedly cut off the application from the db, or one db node from another</li><li>several clients may write to the db at the same time, overwriting each otherâ€™s change</li><li>race conditions between clients can cause surprising bugs</li></ul><h2 id="1-2-Transaction"><a href="#1-2-Transaction" class="headerlink" title="1.2 Transaction"></a>1.2 Transaction</h2><ul><li>Transaction is the mechanism for us to simplify those issues<ul><li>Group several reads and writes together is a logical unit</li><li>either the entire transaction succeeds or it fails<ul><li>application can safely retry if it fails</li></ul></li></ul></li><li>Transaction makes error handling much more easier<ul><li>no need to worry about partial failure</li></ul></li><li>Transaction is created with a purpose, to simplify the programming model for applications accessing a database<ul><li>database take care of such issue</li></ul></li><li>for transaction, we need to understand<ul><li>what safety guarantees transactions can provide</li><li>what costs are associated with them</li></ul></li></ul><h1 id="2-ACID"><a href="#2-ACID" class="headerlink" title="2. ACID"></a>2. ACID</h1><ul><li>ACID are the safety guarantees provided by transactions<ul><li>Atomicity</li><li>Consistency</li><li>Isolation</li><li>Durability</li></ul></li></ul><h2 id="2-1-Atomicity"><a href="#2-1-Atomicity" class="headerlink" title="2.1 Atomicity"></a>2.1 Atomicity</h2><aside>ğŸ’¡ The ability to abort a transaction on error and have all writes from that transaction discarded is the defining feature of ACID atomicity</aside><ul><li>Atomic means sth <strong>cannot be</strong> broken down into smaller parts</li><li>Describes what happens if a client want to make several writes, but a fault occurs after some of the writes have been processed<ul><li>if the writes are grouped together into an atomic transaction</li><li>the transaction cannot be completed due to a fault,</li><li>then the transaction is aborted</li><li>the database must discard or undo any writes it has made so far in that transaction</li></ul></li><li>The ability to abort a transaction on error and have all writes from that transaction discarded is the defining feature of ACID atomicity</li></ul><h2 id="2-2-Consistency"><a href="#2-2-Consistency" class="headerlink" title="2.2 Consistency"></a>2.2 Consistency</h2><ul><li>Consistency refers to an application specific notion of the database being in a good state</li><li>The idea of ACID consistency is that you have certain statements about your data (<em>invariants</em>) that must always be trueâ€”for example, in an accounting system, credits and debits across all accounts must always be balanced</li><li>But this ususally is application code responsibility to define what data is valid or invalid</li></ul><h2 id="2-3-Isolation"><a href="#2-3-Isolation" class="headerlink" title="2.3 Isolation"></a>2.3 Isolation</h2><ul><li>Isolation means that concurrently executing transactions are isolated from each other: they cannot step on each otherâ€™s toe</li></ul><h2 id="2-4-Durability"><a href="#2-4-Durability" class="headerlink" title="2.4 Durability"></a>2.4 Durability</h2><ul><li>Purpose of a db system is to provide a safe place where data can be stored without fear of losing it</li><li><em>Durability</em> is the promise that once a transaction has committed successfully, any data it has written will not be forgotten, even if there is a hardware fault or the database crashes.</li><li>In a single node database<ul><li>means data has been written to nonvolatile storage such as a hard drive or SSD</li><li>could also involves a write ahead log</li></ul></li><li>In a replicated db,<ul><li>means data has been successfully copied to some number of nodes</li></ul></li></ul><h1 id="3-Single-and-Multi-Objects-Operations-Atomicity-Isolation"><a href="#3-Single-and-Multi-Objects-Operations-Atomicity-Isolation" class="headerlink" title="3. Single and Multi Objects Operations - Atomicity + Isolation"></a>3. Single and Multi Objects Operations - Atomicity + Isolation</h1><h2 id="3-1-Multi-Object-Transactions"><a href="#3-1-Multi-Object-Transactions" class="headerlink" title="3.1 Multi Object Transactions"></a>3.1 Multi Object Transactions</h2><h3 id="3-1-1-Why-we-need-it"><a href="#3-1-1-Why-we-need-it" class="headerlink" title="3.1.1 Why we need it"></a>3.1.1 Why we need it</h3><ul><li>Need some way to determine which read and write operations belong to the same transaction<ul><li>In relational db, typically done based on the <strong>clientâ€™s TCP connection to the database server</strong></li><li>on any particular connection, everything between a <strong>BEGIN TRANSACTION and a COMMIT statement</strong> is considered to be part of the same transaction</li></ul></li></ul><h3 id="3-1-2-Scenarios"><a href="#3-1-2-Scenarios" class="headerlink" title="3.1.2 Scenarios"></a>3.1.2 Scenarios</h3><ul><li>In a relational data model, a row in one table often has a foreign key reference to a row in another table<ul><li>multi object transactions allow you to ensure that these references remain valid</li></ul></li><li>In a document data model, the fields that need to be updated together are often <strong>within the same document</strong>, which is treated as a single objectâ€”no multi-object transactions are needed when updating a single document. However, document databases lacking join functionality also encourage denormalization. When denormalized information needs to be updated, you need to update several documents in one go. Transactions are very useful in this situation to prevent denormalized data from going out of sync</li><li>In db with secondary indexes, indexes also need to be updated every time you change a value<ul><li>These indexes are different database objects from a transaction point of view: for example, without transaction isolation, itâ€™s possible for a record to appear in one index but not another, because the update to the second index hasnâ€™t happened yet.</li></ul></li></ul><h2 id="3-2-Single-Object-Writes"><a href="#3-2-Single-Object-Writes" class="headerlink" title="3.2 Single Object Writes"></a>3.2 Single Object Writes</h2><ul><li>Atomicity and isolation also apply when a single object is being changed<ul><li>all storage engines universally aim to provide atomicity and isolation on the level of a single object on one node</li></ul></li><li>Atomicity<ul><li>Using a log for crash recovery</li><li>increment operation</li><li>compare and set</li></ul></li><li>Isolation<ul><li>Using a lock on each object</li></ul></li></ul><h2 id="3-3-Handling-errors-and-aborts"><a href="#3-3-Handling-errors-and-aborts" class="headerlink" title="3.3 Handling errors and aborts"></a>3.3 Handling errors and aborts</h2><ul><li>ACID DB Philosophy</li></ul><aside>ğŸ’¡ if the database is in danger of violating its guarantee of atomicity, isolation, or durability, it would rather abandon the transaction entirely than allow it to remain half-finished.</aside><ul><li>Aborts of transaction point is to safely retry, thus we should have some retry mechanism build for such scenario</li></ul><h1 id="4-Isolation-Levels"><a href="#4-Isolation-Levels" class="headerlink" title="4. Isolation Levels"></a>4. Isolation Levels</h1><p>Concurrency bugs are hard to find by testing, cause they are rare, and difficult to reproduce. For such reasons, databases have long tried to hide concurrency issues from application developers by providing transaction isolation </p><p>In theory, isolation should make your life easier by letting you pretend that no concurrency is happening: <em>serializable</em> isolation means that the database guarantees that transactions have the same effect as if they ran <em>serially</em></p><p>In practice, isolation has a performance cost, and many databased donâ€™t want to pay that price. Thus itâ€™s common for systems to use weaker levels of isolation, which protect against some concurrency issues, but not all </p><h2 id="4-1-Read-Committed"><a href="#4-1-Read-Committed" class="headerlink" title="4.1 Read Committed"></a>4.1 Read Committed</h2><h3 id="4-1-1-Guarantees"><a href="#4-1-1-Guarantees" class="headerlink" title="4.1.1 Guarantees"></a>4.1.1 Guarantees</h3><ul><li>when reading from the database, you will only see data that has been committed(no dirty reads)</li><li>when writing to the database, you will only overwrite data that has been committed (no dirty writes)</li></ul><h3 id="4-1-2-No-dirty-reads-Explanation"><a href="#4-1-2-No-dirty-reads-Explanation" class="headerlink" title="4.1.2 No dirty reads Explanation"></a>4.1.2 No dirty reads Explanation</h3><p><img src="https://s2.loli.net/2022/03/25/IPV8vCO1M93YxZT.png" alt=""></p><ul><li><p>Prevent dirty read, only committed record could be seen</p></li><li><p>reasons for dirty read prevention</p><ul><li>See the database in a partially updated state is confusing to users and may cause other transactions to take incorrect decisions</li><li>If a transaction aborts, any writes it has made need to be rolled back (like in <a href="https://learning.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/ch07.html#fig_transactions_atomicity">Figure 7-3</a>). If the database allows dirty reads, that means a transaction may see data that is later rolled backâ€”i.e., which is never actually committed to the database. Reasoning about the consequences quickly becomes mind-bending.</li></ul></li></ul><h3 id="4-1-3-No-Dirty-Write-Explanation"><a href="#4-1-3-No-Dirty-Write-Explanation" class="headerlink" title="4.1.3 No Dirty Write Explanation"></a>4.1.3 No Dirty Write Explanation</h3><ul><li>If two transactions concurrently try to update the same object in a db, we normally assume that the later write overwrites the earlier write</li><li>Dirty write happen when<ul><li>the earlier write is part of a transaction that has not yet committed, so the later write overwrites an uncommitted value</li></ul></li><li>how does committed isolation level work?<ul><li>by delaying the second write until the first writeâ€™s transaction has committed or aborted</li></ul></li></ul><p><img src="https://s2.loli.net/2022/03/25/3Z6NycPtjEGU9dB.png" alt=""></p><h3 id="4-1-4-Implementation"><a href="#4-1-4-Implementation" class="headerlink" title="4.1.4 Implementation"></a>4.1.4 Implementation</h3><ul><li><p>Dirty writes â€” Row level lock</p><ul><li>when a transaction wants to modify a particular object (row or document), it must first acquire a lock on that object.</li><li>It must then hold that lock until the transaction is committed or aborted.</li><li>Only one transaction can hold the lock for any given object;</li><li>if another transaction wants to write to the same object, it must wait until the first transaction is committed or aborted before it can acquire the lock and continue.</li><li>This locking is done automatically by databases in <strong>read committed mode (or stronger isolation levels)</strong>.</li></ul></li><li><p>Dirty Reads â€”</p><ul><li><p>still use row level lock</p><ul><li>the approach of requiring read locks does not work well in practice, because one long-running write transaction can force many other transactions to wait until the long-running transaction has completed, even if the other transactions only read and do not write anything to the database</li></ul></li><li><p>This harms the response time of read-only transactions and is bad for operability: a slowdown in one part of an application can have a knock-on effect in a completely different part of the application, due to waiting for locks.</p></li><li><p>most databases prevent dirty reads using the approach illustrated  here</p><p>  <img src="https://s2.loli.net/2022/03/25/IPV8vCO1M93YxZT.png" alt=""></p></li><li><p>for every object that is written, the database remembers <strong>both the old committed value and the new value</strong> set by the transaction that currently holds the write lock.</p></li><li><p>While the transaction is ongoing, any other transactions that read the object are simply given the old value. Only when the new value is committed do transactions switch over to reading the new value.</p></li></ul></li></ul><h2 id="4-2-Snapshot-Isolation-and-Repeatable-Read"><a href="#4-2-Snapshot-Isolation-and-Repeatable-Read" class="headerlink" title="4.2 Snapshot Isolation and Repeatable Read"></a>4.2 Snapshot Isolation and Repeatable Read</h2><h3 id="4-2-1-Issue-with-Read-Committed"><a href="#4-2-1-Issue-with-Read-Committed" class="headerlink" title="4.2.1 Issue with Read Committed"></a>4.2.1 Issue with Read Committed</h3><p><img src="https://s2.loli.net/2022/03/25/1rRcBlD7Funjztg.png" alt=""></p><ul><li>Read committed can still have concurrency bug<ul><li>In the image above, there will be certain time the amount of 2 accounts are not equal to 1000</li><li>called read skew â€” nonrepeatable read<ul><li>there will be temporary inconsistency</li><li><strong>read the committed data by another transaction</strong></li></ul></li></ul></li><li>But there are certain situations, that cannot tolerate such temporary inconsistency<ul><li>Backup<ul><li>Taking a backup requires making a copy of the entire database, which may take hours on a large database. During the time that the backup process is running, writes will continue to be made to the database. Thus, you could end up with some parts of the backup containing an older version of the data, and other parts containing a newer version. If you need to restore from such a backup, the inconsistencies (such as disappearing money) become permanent.</li></ul></li><li>Analytic queries and integrity checks<ul><li>nonsensical results will be returned if the database is at different points in time</li></ul></li></ul></li></ul><h3 id="4-2-2-Solution-Snapshot-isolation"><a href="#4-2-2-Solution-Snapshot-isolation" class="headerlink" title="4.2.2 Solution: Snapshot isolation"></a>4.2.2 Solution: Snapshot isolation</h3><ul><li>Each transaction reads from a consistent snapshot of the database,<ul><li>the transaction sees all the data that was committed in the db at the start of the transaction</li></ul></li></ul><h3 id="4-2-3-Snapshot-Isolation-Implementation"><a href="#4-2-3-Snapshot-Isolation-Implementation" class="headerlink" title="4.2.3 Snapshot Isolation Implementation"></a>4.2.3 Snapshot Isolation Implementation</h3><ul><li><p>Use write locks to prevent dirty writes</p><ul><li>a transaction that makes a write can block the progress of another transaction that writes to the same object</li></ul></li><li><p>reads do not require any locks.</p><ul><li>From a performance point of view, a key principle of snapshot isolation is <em>readers never block writers, and writers never block readers</em></li><li>This allows a database to handle long-running read queries on a consistent snapshot at the same time as processing writes normally, without any lock contention between the two.</li></ul></li><li><p>To implement snapshot isolation, db uses a generalization of the mechanism</p><ul><li>db must potentially keep several different committed versions of an object, because various in progress transactions may need to see the state of the db at different points in time</li><li>â€” named as multi version concurrency control â€” MVCC</li></ul></li><li><p>If a database only needed to provide read committed isolation, but not snapshot isolation, it would be sufficient to keep two versions of an object:</p><ul><li>the committed version and the overwritten-but-not-yet-committed version.</li></ul></li><li><p>However, storage engines that support snapshot isolation typically use MVCC for their read committed isolation level as well.</p><ul><li><strong>A typical approach is that read committed uses a separate snapshot for each query, while snapshot isolation uses the same snapshot for an entire transaction.</strong></li></ul></li></ul><h3 id="4-2-4-Visibility-rules-for-observing-a-consistent-snapshot"><a href="#4-2-4-Visibility-rules-for-observing-a-consistent-snapshot" class="headerlink" title="4.2.4 Visibility rules for observing a consistent snapshot"></a>4.2.4 Visibility rules for observing a consistent snapshot</h3><ul><li>Transaction IDs are used to decide which objects it can see and which are invisible</li><li>Rules<ol><li>At the start of each transaction, the database makes a list of all the other transactions that are in progress (not yet committed or aborted) at that time. Any writes that those transactions have made are ignored, even if the transactions subsequently commit.</li><li>Any writes made by aborted transactions are ignored.</li><li>Any writes made by transactions with a later transaction ID (i.e., which started after the current transaction started) are ignored, regardless of whether those transactions have committed.</li><li>All other writes are visible to the applicationâ€™s queries.</li></ol></li></ul><h2 id="4-3-Preventing-Lost-Updates"><a href="#4-3-Preventing-Lost-Updates" class="headerlink" title="4.3 Preventing Lost Updates"></a>4.3 Preventing Lost Updates</h2><h3 id="4-3-1-Issues"><a href="#4-3-1-Issues" class="headerlink" title="4.3.1 Issues"></a>4.3.1 Issues</h3><p>The lost update problem can occur if an application reads some value from the database, modifies it, and writes back the modified value (a <em>read-modify-write cycle</em>). <strong>If two transactions do this concurrently, one of the modifications can be lost, because the second write does not include the first modification.</strong> (We sometimes say that the later write <em>clobbers</em> the earlier write.) This pattern occurs in various different scenarios: </p><ul><li>Incrementing a counter or updating an account balance (requires reading the current value, calculating the new value, and writing back the updated value)</li><li>Making a local change to a complex value, e.g., adding an element to a list within a JSON document (requires parsing the document, making the change, and writing back the modified document)</li><li>Two users editing a wiki page at the same time, where each user saves their changes by sending the entire page contents to the server, overwriting whatever is currently in the database</li></ul><h3 id="4-3-2-Solution-1-Atomic-Write-Operations"><a href="#4-3-2-Solution-1-Atomic-Write-Operations" class="headerlink" title="4.3.2 Solution 1: Atomic Write Operations"></a>4.3.2 Solution 1: Atomic Write Operations</h3><ul><li>Using atomic update provided by database,</li></ul><pre><code class="ruby">UPDATE counters SET value = value + 1 WHERE key = &#39;foo&#39;;</code></pre><ul><li>Atomic operations are usually implemented by taking an <strong>exclusive lock on the object when it is read</strong> so that no other transaction can read it until the update has been applied</li><li>Also, we could force all atomic operations to be executed on a single thread</li></ul><h3 id="4-3-3-Solution-2-Explicit-Locking"><a href="#4-3-3-Solution-2-Explicit-Locking" class="headerlink" title="4.3.3 Solution 2: Explicit Locking"></a>4.3.3 Solution 2: Explicit Locking</h3><ul><li>Explicitly lock objects that are going to be updated<ul><li>then the application can perform a read modify write cycle</li><li>if any other transaction tries to concurrently read the same object, it is forced to wait until the first read-modify-write cycle has completed</li></ul></li></ul><pre><code class="ruby">BEGIN TRANSACTION;SELECT * FROM figures  WHERE name = &#39;robot&#39; AND game_id = 222// For Update will let databse take a lock o  FOR UPDATE; 1-- Check whether move is valid, then update the position-- of the piece that was returned by the previous SELECT.UPDATE figures SET position = &#39;c4&#39; WHERE id = 1234;COMMIT;</code></pre><h3 id="4-3-4-Solution-3-Automatically-detecting-lost-updates"><a href="#4-3-4-Solution-3-Automatically-detecting-lost-updates" class="headerlink" title="4.3.4 Solution 3: Automatically detecting lost updates"></a>4.3.4 Solution 3: Automatically detecting lost updates</h3><ul><li>Atomic operations and locks are ways of preventing lost updates by forcing the read-modify-write cycles to happen sequentially.</li><li>An alternative is to allow them to <strong>execute in parallel</strong> and, if the transaction manager <strong>detects a lost update, abort the transaction</strong> and <strong>force it to retry its read-modify-write cycle</strong>.</li><li>Lost update detection is great because it doesnâ€™t require application code to use any special database features, you could forget to use a lock or an atomic operation, but lost update detection happens automatically and thus less error prone</li></ul><h3 id="4-3-5-Solution-4-Compare-and-set"><a href="#4-3-5-Solution-4-Compare-and-set" class="headerlink" title="4.3.5 Solution 4: Compare and set"></a>4.3.5 Solution 4: Compare and set</h3><ul><li>Avoid lost updates by allowing an update to happen only if the value has not changed since you last read it</li></ul><pre><code class="ruby">UPDATE wiki_pages SET content = &#39;new content&#39;  WHERE id = 1234 AND content = &#39;old content&#39;;</code></pre><ul><li>But notice the compare and set operation is possible to be unsafe if db by default read from the old snapshot</li></ul><h3 id="4-3-6-Solution-5-Conflict-resolution-and-replication"><a href="#4-3-6-Solution-5-Conflict-resolution-and-replication" class="headerlink" title="4.3.6 Solution 5: Conflict resolution and replication"></a>4.3.6 Solution 5: Conflict resolution and replication</h3><p>In multi leader or leaderless replication system, a common approach in such replicated databases is to allow concurrent writes to create several conflicting versions of a value (also known as <em>siblings</em>), and to use application code or special data structures to resolve and merge these versions after the fact.</p><h2 id="4-4-Write-Skew-and-Phantoms"><a href="#4-4-Write-Skew-and-Phantoms" class="headerlink" title="4.4 Write Skew and Phantoms"></a>4.4 Write Skew and Phantoms</h2><p><img src="https://s2.loli.net/2022/03/25/pFhAQWIU8O4bEZY.png" alt=""></p><ul><li>In each transaction, we first check that two or more doctors are currently on call,<ul><li>since db is using snapshot isolation, both checks return 2, so both of them proceed to the next stage</li></ul></li><li>Write Skew<ul><li>itâ€™s neither a dirty write nor a lost update, because the two transactions are updating two different objects</li><li>But itâ€™s a race condition as the anomalous behavior was only possible because the transactions ran concurrently</li></ul></li><li>You can think of write skew as a generalization of the lost update problem.<ul><li>Write skew can occur if <strong>two transactions read the same objects</strong>, and <strong>then update some of those objects (different transactions may update different objects).</strong></li><li>In the special case where different transactions update the same object, you get a dirty write or lost update anomaly (depending on the timing).</li></ul></li></ul><h3 id="4-4-2-Solution"><a href="#4-4-2-Solution" class="headerlink" title="4.4.2 Solution"></a>4.4.2 Solution</h3><ul><li>We need to explicitly lock the rows as solution in isolation snapshot works for one object, now the case come to be multiple objects, so that comes to be different</li></ul><pre><code class="ruby">BEGIN TRANSACTION;SELECT * FROM doctors  WHERE on_call = true  AND shift_id = 1234 FOR UPDATE; 1UPDATE doctors  SET on_call = false  WHERE name = &#39;Alice&#39;  AND shift_id = 1234;COMMIT;</code></pre><h3 id="4-4-3-Phantoms"><a href="#4-4-3-Phantoms" class="headerlink" title="4.4.3 Phantoms"></a>4.4.3 Phantoms</h3><p>All of these examples follow a similar pattern:</p><ol><li><p>A <code>SELECT</code> query checks whether some requirement is satisfied by searching for rows that match some search condition (there are at least two doctors on call, there are no existing bookings for that room at that time, the position on the board doesnâ€™t already have another figure on it, the username isnâ€™t already taken, there is still money in the account).</p></li><li><p>Depending on the result of the first query, the application code decides how to continue (perhaps to go ahead with the operation, or perhaps to report an error to the user and abort).</p></li><li><p>If the application decides to go ahead, it makes a write (<code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code>) to the database and commits the transaction.</p><p> The effect of this write changes the precondition of the decision of step 2. In other words, if you were to repeat the <code>SELECT</code> query from step 1 after committing the write, you would get a different result, because the write changed the set of rows matching the search condition (there is now one fewer doctor on call, the meeting room is now booked for that time, the position on the board is now taken by the figure that was moved, the username is now taken, there is now less money in the account).</p></li></ol><p>The steps may occur in a different order. For example, you could first make the write, then the <code>SELECT</code> query, and finally decide whether to abort or commit based on the result of the query.</p><p>In the case of the doctor on call example, the row being modified in step 3 was one of the rows returned in step 1, so we could make the transaction safe and avoid write skew by locking the rows in step 1 (<code>SELECT FOR UPDATE</code>). However, the other four examples are different: they check for the <em>absence</em> of rows matching some search condition, and the write <em>adds</em> a row matching the same condition. If the query in step 1 doesnâ€™t return any rows, <code>SELECT FOR UPDATE</code> canâ€™t attach locks to anything.</p><p>This effect, where a write in one transaction changes the result of a search query in another transaction, is called a <em>phantom</em> [<a href="https://learning.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/ch07.html#Eswaran1976uu">3</a>]. Snapshot isolation avoids phantoms in read-only queries, but in read-write transactions like the examples we discussed, phantoms can lead to particularly tricky cases of write skew.</p><h3 id="4-4-4-Materializing-conflicts-for-Phantoms"><a href="#4-4-4-Materializing-conflicts-for-Phantoms" class="headerlink" title="4.4.4 Materializing conflicts for Phantoms"></a>4.4.4 Materializing conflicts for Phantoms</h3><ul><li>Pre create all rows in the db, thus phantoms problems could be converted to the doctor appointment problem we discussed before</li></ul><h3 id="4-4-5-Predicate-Locks"><a href="#4-4-5-Predicate-Locks" class="headerlink" title="4.4.5 Predicate Locks"></a>4.4.5 Predicate Locks</h3><ul><li>We could use a predicate lock for booking case, works similarly to  the shared/ exclusive lock, but rather than belong to a particular object, it belongs to all objects that match some search condition</li></ul><pre><code class="ruby">SELECT * FROM bookings  WHERE room_id = 123 AND    end_time   &gt; &#39;2018-01-01 12:00&#39; AND    start_time &lt; &#39;2018-01-01 13:00&#39;;</code></pre><ul><li>If transaction A wants to read objects matching some condition, like in that <code>SELECT</code> query, it must acquire a shared-mode predicate lock on the conditions of the query. If another transaction B currently has an exclusive lock on any object matching those conditions, A must wait until B releases its lock before it is allowed to make its query.</li><li>If transaction A wants to insert, update, or delete any object, it must first check whether either the old or the new value matches any existing predicate lock. If there is a matching predicate lock held by transaction B, then A must wait until B has committed or aborted before it can continue.</li></ul><h2 id="4-5-Serializability"><a href="#4-5-Serializability" class="headerlink" title="4.5 Serializability"></a>4.5 Serializability</h2><ul><li>There are a lot of different isolation levels, and each db declare their isolation level slightly different,<ul><li>We could use serializable isolation to simplify it</li></ul></li><li>Serializable isolation<ul><li>Strongest isolation level</li><li>without any concurrency</li></ul></li><li>Serializable Mechanism<ul><li>Literally executing transactions in a serail order</li><li>Two Phase Locking</li><li>Optimistic concurrency control techniques such as serializable snapshot isolation</li></ul></li></ul><h3 id="4-5-1-Actual-Serial-Execution"><a href="#4-5-1-Actual-Serial-Execution" class="headerlink" title="4.5.1 Actual Serial Execution"></a>4.5.1 Actual Serial Execution</h3><ul><li><p>We could try to only execute one transaction at a time, in serial order, on a single thread</p></li><li><p>This comes to be realistic recently around 2007 because</p><ul><li>RAM became cheap enough, thus itâ€™s now feasible to keep the entire active dataset in memory</li><li>OLTP transactions are usually short and only make a small number of reads and writes<ul><li>by contrast, long running analytic queries are typically read only, so they can be run on a consistent snapshot outside of the serial execution loop</li></ul></li></ul></li><li><p>This approach is implemented in VoltDB/ Hstore, Redis, and Datomic</p></li><li><p>Notice</p><ul><li>A system designed for a single threaded execution can sometimes perform better than a system that supports concurrency, because it can avoid the coordination overhead of locking</li></ul></li></ul><h3 id="4-5-2-Encapsulating-transactions-in-stored-procedures"><a href="#4-5-2-Encapsulating-transactions-in-stored-procedures" class="headerlink" title="4.5.2 Encapsulating transactions in stored procedures"></a>4.5.2 Encapsulating transactions in stored procedures</h3><ul><li><p>Philosophy</p><ul><li>Keep transactions short by avoiding interactively waiting for a user within a transaction</li><li>means a transaction is committed within the same HTTP request,</li></ul></li><li><p>IN the interactive style of transaction, network and db will take a lot time, we need to make sure we could handle enough throughput, we need to process multiple transactions concurrently in order to get reasonable performance.</p></li><li><p>Systems with single threaded serial transaction processing could receive the entier transaction code to db ahead of time , as a <strong>stored procedure</strong></p></li></ul><p><img src="https://s2.loli.net/2022/03/25/W1TFbpKA5JGhwXd.png" alt=""></p><ul><li>Pros and Cons<ul><li>Each db has its own language for stored procedures</li><li>Code running in db is difficult to manage, more awkward to keep in version control and deploy</li><li>db is often much more performance sensitive,because a single db instance is often shared by a lot of application servers. A bad written stored procedure can cause much more trouble than equivalent badly written code in an application server</li></ul></li></ul><h3 id="4-5-3-Partitioning"><a href="#4-5-3-Partitioning" class="headerlink" title="4.5.3 Partitioning"></a>4.5.3 Partitioning</h3><ul><li>Partition data to scale to multiple CPU cores, and multiple nodes.</li><li>However, for any transaction that needs to access multiple partitions, the database must coordinate the transaction across all the partitions that it touches. The stored procedure needs to be performed in lock-step across all partitions to ensure serializability across the whole system.</li></ul><h1 id="5-Two-Phase-Locking"><a href="#5-Two-Phase-Locking" class="headerlink" title="5. Two Phase Locking"></a>5. Two Phase Locking</h1><h2 id="5-1-Concepts"><a href="#5-1-Concepts" class="headerlink" title="5.1 Concepts"></a>5.1 Concepts</h2><ul><li>Several transactions are allowed to concurrently read the same object as long as nobody is writing to it</li><li>But as soon as anyone wants to write(modify or delete) an object, exclusive access is required<ul><li>Writes not only block other writers, it also block all readers</li></ul></li></ul><h2 id="5-2-Implementation"><a href="#5-2-Implementation" class="headerlink" title="5.2 Implementation"></a>5.2 Implementation</h2><ul><li>If a transaction wants to read an object, it must first acquire the lock in shared mode. Several transactions are allowed to hold the lock in shared mode simultaneously, but if another transaction already has an exclusive lock on the object, these transactions must wait.</li><li>If a transaction wants to write to an object, it must first acquire the lock in exclusive mode. No other transaction may hold the lock at the same time (either in shared or in exclusive mode), so if there is any existing lock on the object, the transaction must wait.</li><li>If a transaction first reads and then writes an object, it may upgrade its shared lock to an exclusive lock. The upgrade works the same as getting an exclusive lock directly.</li><li>After a transaction has acquired the lock, it must continue to hold the lock until the end of the transaction (commit or abort). This is where the name â€œtwo-phaseâ€ comes from: the first phase (while the transaction is executing) is when the locks are acquired, and the second phase (at the end of the transaction) is when all the locks are released.</li></ul><h2 id="5-3-Performance"><a href="#5-3-Performance" class="headerlink" title="5.3 Performance"></a>5.3 Performance</h2><ul><li>transaction throughput and response times of queries are significantly worse under two-phase locking than under weak isolation.<ul><li>overhead of <strong>acquiring and releasing all those locks</strong>, but more importantly due to <strong>reduced concurrency</strong>.</li></ul></li></ul><h1 id="6-Serializable-Snapshot-Isolation"><a href="#6-Serializable-Snapshot-Isolation" class="headerlink" title="6. Serializable Snapshot Isolation"></a>6. Serializable Snapshot Isolation</h1><ul><li>It provides full serializability, but has only a small performance penalty compared to snapshot isolation</li><li>Snapshot + Serializable<ul><li>optimistic concurrency control mechanism</li><li>It performs badly if there is high contention (many transactions trying to access the same objects), as this leads to a high proportion of transactions needing to abort. If the system is already close to its maximum throughput, the additional transaction load from retried transactions can make performance worse.</li></ul></li><li>to achieve serialization, db need to know if the query result has been changed within the transaction<ul><li>Detecting reads of a stale MVCC object version (uncommitted write occurred before the read)</li><li>Detecting writes that affect prior reads (the write occurs after the read)</li></ul></li></ul><h2 id="6-1-Detecting-stale-MVCC-reads"><a href="#6-1-Detecting-stale-MVCC-reads" class="headerlink" title="6.1 Detecting stale MVCC reads"></a>6.1 Detecting stale MVCC reads</h2><p>In order to prevent this anomaly, the database needs to track when a transaction ignores another transactionâ€™s writes due to MVCC visibility rules. When the transaction wants to commit, the database checks whether any of the ignored writes have now been committed. If so, the transaction must be aborted.</p><p><img src="https://s2.loli.net/2022/03/25/kyCJZvs5QB93b1u.png" alt=""></p><h2 id="6-2-Detecting-writes-that-affect-prior-reads"><a href="#6-2-Detecting-writes-that-affect-prior-reads" class="headerlink" title="6.2 Detecting writes that affect prior reads"></a>6.2 Detecting writes that affect prior reads</h2><p>When a transaction writes to the database, it must look in the indexes for any other transactions that have recently read the affected data. This process is similar to acquiring a write lock on the affected key range, but rather than blocking until the readers have committed, the lock acts as a tripwire: it simply notifies the transactions that the data they read may no longer be up to date.</p><h2 id="6-3-Performance"><a href="#6-3-Performance" class="headerlink" title="6.3 Performance"></a>6.3 Performance</h2><p>Compared to two-phase locking, the big advantage of serializable snapshot isolation is that one transaction doesnâ€™t need to block waiting for locks held by another transaction. Like under snapshot isolation, writers donâ€™t block readers, and vice versa. This design principle makes query latency much more predictable and less variable. In particular, read-only queries can run on a consistent snapshot without requiring any locks, which is very appealing for read-heavy workloads.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Transaction-Understanding&quot;&gt;&lt;a href=&quot;#Transaction-Understanding&quot; class=&quot;headerlink&quot; title=&quot;Transaction Understanding&quot;&gt;&lt;/a&gt;Transaction
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="transaction" scheme="https://www.llchen60.com/tags/transaction/"/>
    
  </entry>
  
  <entry>
    <title>ç½®èº«äº‹å†… ç¬”è®°</title>
    <link href="https://www.llchen60.com/%E7%BD%AE%E8%BA%AB%E4%BA%8B%E5%86%85-%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.llchen60.com/%E7%BD%AE%E8%BA%AB%E4%BA%8B%E5%86%85-%E7%AC%94%E8%AE%B0/</id>
    <published>2022-02-02T08:41:20.000Z</published>
    <updated>2022-02-05T09:21:58.786Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-æ•´ä½“æ¡†æ¶"><a href="#1-æ•´ä½“æ¡†æ¶" class="headerlink" title="1. æ•´ä½“æ¡†æ¶"></a>1. æ•´ä½“æ¡†æ¶</h1><ul><li>å¾®è§‚æœºåˆ¶<ul><li>åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡</li><li>è´¢ç¨ä¸æ”¿åºœè¡Œä¸º</li><li>æ”¿åºœæŠ•èèµ„å’Œå€ºåŠ¡</li><li>å·¥ä¸šåŒ–å½“ä¸­çš„æ”¿åºœè§’è‰²</li></ul></li><li>å®è§‚ç°è±¡<ul><li>åŸå¸‚åŒ–å’Œä¸å¹³è¡¡</li><li>å€ºåŠ¡ä¸é£é™©</li><li>å›½å†…å›½é™…å¤±è¡¡</li><li>æ”¿åºœä¸ç»æµå‘å±•</li></ul></li></ul><h1 id="2-åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡"><a href="#2-åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡" class="headerlink" title="2. åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡"></a>2. åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡</h1><aside>ğŸ’¡ åœ°æ–¹æ”¿åºœä¸åªæä¾›äº†å…¬å…±æœåŠ¡ï¼Œä¹Ÿæ·±åº¦å‚ä¸ç”Ÿäº§å’Œåˆ†é…ã€‚</aside><h2 id="2-1-ä½“åˆ¶ç‰¹ç‚¹"><a href="#2-1-ä½“åˆ¶ç‰¹ç‚¹" class="headerlink" title="2.1 ä½“åˆ¶ç‰¹ç‚¹"></a>2.1 ä½“åˆ¶ç‰¹ç‚¹</h2><ul><li>æ”¿åºœç®¡ç†ä½“ç³»<ul><li>ä¸­å¤® - çœ - å¸‚ - å¿åŒº - ä¹¡é•‡</li></ul></li><li>ä½“åˆ¶ç‰¹ç‚¹<ul><li>ä¸­å¤®ä¸åœ°æ–¹æ”¿åºœ<ul><li>æ—¥å¸¸è¿ä½œä»¥åœ°æ–¹æ”¿åºœä¸ºä¸»</li></ul></li><li>å…šä¸æ”¿åºœ<ul><li>å…šè´Ÿè´£é‡å¤§å†³ç­–å’Œäººäº‹ä»»å…</li><li>æ”¿åºœè´Ÿè´£æ‰§è¡Œ</li></ul></li><li>æ¡å—åˆ†å‰²ï¼Œå¤šé‡é¢†å¯¼<ul><li>å±‚å±‚å¤åˆ¶</li><li>å…šå§”æ”¿åºœäººå¤§æ”¿åå››å¥—ç­å­</li><li>æ¡æ¡å…³ç³»æ˜¯ä¸šåŠ¡å…³ç³»ï¼Œå—å—å…³ç³»æ˜¯é¢†å¯¼å…³ç³»â€”åœ°æ–¹å…šå§”å’Œæ”¿åºœå¯ä»¥å†³å®šäººäº‹ä»»å…</li></ul></li><li>ä¸Šå±‚é¢†å¯¼ä¸åè°ƒ<ul><li>æƒåŠ›åˆ†æ•£ï¼Œå†³ç­–å®¹æ˜“å‘ä¸Šé›†ä¸­</li><li>å°½é‡åœ¨èƒ½è¾¾æˆå…±è¯†çš„æœ€ä½å±‚çº§ä¸Šè§£å†³é—®é¢˜</li></ul></li><li>å®˜åƒšä½“ç³»<ul><li>å®˜å‘˜å¿…é¡»å­¦ä¹ å’Œè´¯å½»ç»Ÿä¸€çš„æ„è¯†å½¢æ€</li><li>å®˜å‘˜ç”±ä¸Šçº§ä»»å‘½</li><li>åœ°æ–¹ä¸»å®˜éœ€è¦åœ¨å¤šåœ°è½®æ¢ä»»èŒ</li></ul></li></ul></li><li>æ”¿åºœæ²»ç†å’Œè¿ä½œçš„æ¨¡å¼<ul><li>äº†è§£æƒåŠ›å’Œèµ„æºåœ¨æ”¿åºœä½“ç³»ä¸­çš„åˆ†å¸ƒè§„åˆ™<ul><li>ä¸Šä¸‹çº§æ”¿åºœé—´çš„çºµå‘åˆ†å¸ƒ</li><li>åŒçº§æ”¿åºœé—´çš„æ¨ªå‘åˆ†å¸ƒ</li></ul></li></ul></li><li>äº‹æƒåˆ’åˆ†çš„åŸåˆ™<ul><li>å…¬å…±æœåŠ¡çš„è§„æ¨¡ç»æµ</li><li>ä¿¡æ¯çš„å¤æ‚æ€§</li><li>æ¿€åŠ±ç›¸å®¹</li></ul></li></ul><h2 id="2-2-å¤–éƒ¨æ€§-è§„æ¨¡ç»æµ"><a href="#2-2-å¤–éƒ¨æ€§-è§„æ¨¡ç»æµ" class="headerlink" title="2.2 å¤–éƒ¨æ€§ è§„æ¨¡ç»æµ"></a>2.2 å¤–éƒ¨æ€§ è§„æ¨¡ç»æµ</h2><ul><li>ä¸€ä¸ªäº‹ç‰©æ˜¯åªåœ¨åˆ’å®šçš„åŒºåŸŸèŒƒå›´å†…æœ‰å½±å“ è¿˜æ˜¯å¯¹å¤–ä¹Ÿæœ‰å½±å“</li><li>è¡Œæ”¿åŒºåŸŸåˆ’åˆ†<ul><li>äººå£å¯†åº¦ â€” æä¾›å…¬å…±ç‰©å“å’ŒæœåŠ¡éœ€è¦æˆæœ¬</li><li>å±±å·æ²³æµ</li><li>è¯­è¨€æ–‡åŒ–å·®å¼‚</li></ul></li><li>åŸå¸‚ç¾¤çš„è§„åˆ’<ul><li>å› ä¸ºç»æµæ´»åŠ¨å’Œäººå£é›†èšï¼Œéœ€è¦æ‰“ç ´ç°æœ‰çš„è¡Œæ”¿è¾¹ç•Œï¼Œåœ¨æ›´å¤§èŒƒå›´å†…æä¾›æ— ç¼å¯¹æ¥çš„æ ‡å‡†åŒ–å…¬å…±æœåŠ¡</li></ul></li><li>è¡Œæ”¿äº¤ç•Œåœ°åŒºç»æµå‘å±•å¼±<ul><li>åœ°ç†åŸå› </li><li>äºšæ–‡åŒ–åŒºï¼Œè·ç¦»ä¸»æµæ–‡åŒ–ç›¸å¯¹è¿œ â€” æ–‡åŒ–ï¼Œè¯­è¨€ä¸Š</li><li>çœæ”¿åºœä¹Ÿä¸ä¼šæŠŠæœ‰é™èµ„æºä¼˜å…ˆé…ç½®åˆ°è¾¹ç•Œåœ°åŒº</li><li>ç¯å¢ƒæ±¡æŸ“è°æ¥æ²»ç†çš„é—®é¢˜</li></ul></li></ul><h2 id="2-3-å¤æ‚ä¿¡æ¯"><a href="#2-3-å¤æ‚ä¿¡æ¯" class="headerlink" title="2.3 å¤æ‚ä¿¡æ¯"></a>2.3 å¤æ‚ä¿¡æ¯</h2><ul><li>ä¿¡æ¯ä¸æƒåŠ›<ul><li>åŸåˆ™ä¸Š  ä¸Šçº§å½¢å¼æƒå¨</li><li>å®é™…ä¸Šç»™ä¸‹çº§  ä¸‹çº§æœ‰å®é™…æƒå¨</li><li>ä¿¡æ¯ä¼˜åŠ¿  æƒå¨çš„å¹³è¡¡æ˜¯æ ¸å¿ƒé—®é¢˜</li></ul></li><li>ä¿¡æ¯è·å–+éšç’<ul><li>ä¿¡æ¯ä¼ é€’å¾ˆé‡è¦<ul><li>å¤§é‡çš„ä¼šè®®å’Œæ–‡ä»¶</li></ul></li><li>å¤æ‚çš„æ–‡ä»¶å’Œä¼šè®®åˆ¶åº¦<ul><li>æ–‡ä»¶ç±»å‹ï¼Œæ ¼å¼ï¼Œä»¥åŠæŠ¥é€éƒ½æœ‰ä¸¥æ ¼çš„æµç¨‹</li></ul></li></ul></li><li>ä¸Šå±‚çš„ç›‘ç£å’Œå®¡è®¡</li></ul><aside>ğŸ’¡ æ‰€è°“æƒåŠ›ï¼Œå®è´¨ä¸Šå°±æ˜¯åœ¨è¯´ä¸æ¸…æ¥šçš„æƒ…å†µä¸‹ç”±è°æ¥æ‹æ¿å†³ç­–çš„é—®é¢˜</aside><h2 id="2-4-æ¿€åŠ±ç›¸å®¹"><a href="#2-4-æ¿€åŠ±ç›¸å®¹" class="headerlink" title="2.4 æ¿€åŠ±ç›¸å®¹"></a>2.4 æ¿€åŠ±ç›¸å®¹</h2><ul><li>å‚ç›´ç®¡ç†<ul><li>ä¸“ä¸šæ€§å¼ºï¼Œæ ‡å‡†åŒ–ç¨‹åº¦é«˜çš„éƒ¨é—¨</li><li>é¢å¯¹æœ‰åŒé‡é¢†å¯¼çš„éƒ¨é—¨ï¼Œéƒ½æœ‰ä¸€ä¸ªæ ¹æœ¬çš„æ¿€åŠ±è®¾è®¡çš„é—®é¢˜<ul><li>èƒ½è¯„ä»·å’Œå¥–æƒ©å·¥ä½œä¸šç»©çš„ä¸Šçº§ï¼Œèƒ½å†³å®šå·¥ä½œå†…å®¹çš„ä¸Šçº§ï¼Œå—ä¸‹çº§å·¥ä½œå½±å“æœ€å¤§çš„ä¸Šçº§ï¼Œåº”è¯¥å°½é‡æ˜¯åŒä¸€ä¸ªä¸Šçº§</li></ul></li></ul></li><li>åœ°æ–¹ç®¡ç†<ul><li>æ›´åŠ å®è§‚ï¼Œæ›´åŠ éœ€è¦å¤šéƒ¨é—¨åˆä½œçš„æ–¹é¢ï¼Œæ¯”å¦‚ç»æµå‘å±•</li><li>éœ€è¦ç»™åœ°æ–¹æ”¾æƒï¼Œåœ°æ–¹è´Ÿè´£ä¸”åœ°æ–¹èƒ½å¤Ÿåˆ†äº«å‘å±•æˆæœ</li></ul></li></ul><h2 id="2-5-æ‹›å•†å¼•èµ„"><a href="#2-5-æ‹›å•†å¼•èµ„" class="headerlink" title="2.5 æ‹›å•†å¼•èµ„"></a>2.5 æ‹›å•†å¼•èµ„</h2><aside>ğŸ’¡ åœ°æ–¹æ”¿åºœä¸ä»…åœ¨ä¸ºç»æµå‘å±•åˆ›é€ ç¯å¢ƒï¼Œå®ƒæœ¬èº«å°±æ˜¯ç»æµå‘å±•çš„æ·±åº¦å‚ä¸è€…ã€‚</aside><ul><li>å…¨æ°‘æ‹›å•†æ”¿ç­–<ul><li>å³æ‹›å•†ä¸æ˜¯å•ä¸ªéƒ¨é—¨è¦åšçš„ï¼Œæ˜¯æ‰€æœ‰éƒ¨é—¨éƒ½éœ€è¦ç†Ÿæ‚‰æ”¿ç­–ï¼Œå¯»æ‰¾æ‹›å•†æœºä¼šçš„</li></ul></li><li>åœ°æ–¹æ”¿åºœæ˜¯åŸå¸‚åœŸåœ°æ‰€æœ‰è€…<ul><li>ä¼šå°†å·¥ä¸šç”¨åœ°ä»¥éå¸¸ä¼˜æƒ çš„ä»·æ ¼è½¬è®©ç»™ä¼ä¸šä½¿ç”¨</li><li>è´Ÿè´£å¯¹åœŸåœ°è¿›è¡Œä¸€ç³»åˆ—åˆæœŸå¼€å‘ â€” ä¸ƒé€šä¸€å¹³</li></ul></li><li>é‡‘èæ”¯æŒ<ul><li>æ”¿åºœæ§åˆ¶çš„æŠ•èµ„å¹³å°å…¥è‚¡</li><li>è°ƒåŠ¨æœ¬åœ°å›½ä¼å‚ä¸æŠ•èµ„</li><li>é€šè¿‡å„ç§æ–¹å¼ååŠ©ä¼ä¸šè·å¾—é“¶è¡Œè´·æ¬¾</li></ul></li><li>äº‹åŠ¡ä¸Šæ”¯æŒ<ul><li>å„ç§è®¸å¯</li></ul></li><li>è¡¥è´´ï¼Œç¨æ”¶ä¼˜æƒ </li></ul><h1 id="3-è´¢ç¨ä¸æ”¿åºœè¡Œä¸º"><a href="#3-è´¢ç¨ä¸æ”¿åºœè¡Œä¸º" class="headerlink" title="3. è´¢ç¨ä¸æ”¿åºœè¡Œä¸º"></a>3. è´¢ç¨ä¸æ”¿åºœè¡Œä¸º</h1><ul><li><p>æŠŠæ¡æ”¿åºœçš„çœŸå®æ„å›¾ï¼Œä¸èƒ½å…‰è¯»æ–‡ä»¶ï¼Œè¿˜è¦çœ‹æ”¿åºœèµ„é‡‘çš„æµå‘å’Œæ•°é‡</p></li><li><p>äº‹æƒä¸è´¢åŠ›åŒ¹é… â€” äº‹æƒå’Œæ”¯å‡ºè´£ä»»åŒ¹é…</p></li><li><p>å®é™…æƒ…å†µ</p><ul><li>äº‹æƒä¸è´¢æƒé«˜åº¦ä¸åŒ¹é…<ul><li>è‡ª1994å¹´å®è¡Œåˆ†ç¨åˆ¶æ”¹é©ä¾èµ–ï¼Œåœ°æ–¹è´¢æ”¿é¢„ç®—æ”¯å‡ºji</li></ul></li></ul></li></ul><h2 id="3-1-åˆ†ç¨åˆ¶æ”¹é©"><a href="#3-1-åˆ†ç¨åˆ¶æ”¹é©" class="headerlink" title="3.1 åˆ†ç¨åˆ¶æ”¹é©"></a>3.1 åˆ†ç¨åˆ¶æ”¹é©</h2><ul><li>1985å¹´ â€” 1993å¹´ è´¢æ”¿åŒ…å¹²<ul><li>æ‰¿åŒ…åˆ¶<ul><li>åœŸåœ°æ‰¿åŒ…</li><li>ä¼ä¸šæ‰¿åŒ…</li><li>è´¢æ”¿æ‰¿åŒ…</li></ul></li><li>æ‰¿åŒ…åˆ¶åŸå› ï¼Œæˆ‘å›½åŸºæœ¬å›½ç­–å†³å®šäº†ä¸èƒ½å¯¹æ‰€æœ‰æƒåšå‡ºæ ¹æœ¬æ€§å˜é©ï¼Œåªèƒ½å¯¹ä½¿ç”¨æƒå’Œç»è¥æƒå®è¡Œæ‰¿åŒ…åˆ¶</li><li>å®è¡Œæ–¹å¼<ul><li>1988å¹´åŒ—äº¬  ä»¥1987å¹´è´¢æ”¿æ”¶å…¥ä¸ºåŸºæ•°ï¼Œè®¾å®šä¸€ä¸ªå›ºå®šçš„å¹´æ”¶å…¥å¢é•¿ç‡4%ï¼Œè¶…è¿‡4%çš„éƒ¨åˆ†éƒ½å½’åŒ—äº¬ï¼Œæ²¡è¶…è¿‡çš„éƒ¨åˆ†åˆ™å’Œä¸­å¤®äº”äº”åˆ†æˆ</li></ul></li><li>åœ°æ–¹å®ç°æ–¹å¼<ul><li>å¤§åŠ›å‘å±•ä¹¡é•‡ä¼ä¸š</li></ul></li><li>å½±å“<ul><li>ä¸­å¤®è´¢æ”¿é¢„ç®—æ”¶å…¥å å…¨å›½è´¢æ”¿é¢„ç®—æ€»æ”¶å…¥çš„æ¯”é‡è¶Šæ¥è¶Šä½</li><li>å…¨å›½è´¢æ”¿é¢„ç®—æ€»æ”¶å…¥å GDPçš„æ¯”é‡ä¹Ÿè¶Šæ¥è¶Šä½<ul><li>å¤®åœ°åˆ†æˆæ¯”ä¾‹æ¯è¿‡å‡ å¹´å°±è¦é‡æ–°è°ˆåˆ¤</li><li>é¢„ç®—å¤–æ”¶å…¥å¯ç‹¬äº«ï¼Œå› æ­¤åœ°æ–¹æ”¿åºœç–¯ç‹‚ç»™æ”¿åºœå‡ç¨ï¼Œè—å¯Œäºä¼ä¸šï¼Œå†é€šè¿‡è¡Œæ”¿æ”¶è´¹ï¼Œé›†èµ„ï¼Œæ‘Šæ´¾ï¼ŒèµåŠ©ç­‰æ–¹å¼æ”¶å›ä¸€éƒ¨åˆ†</li></ul></li></ul></li></ul></li><li>1994å¹´åˆ†ç¨åˆ¶æ”¹é©<ul><li>ç¨åŠ¡åˆ†ç±»<ul><li>ä¸­å¤®ç¨</li><li>åœ°æ–¹ç¨</li><li>å…±äº«ç¨<ul><li>å¢å€¼ç¨ â€” å å…¨å›½ç¨æ”¶çš„1/4<ul><li>ä¸­å¤®æ‹¿75% åœ°æ–¹ç•™25%</li><li>è½¬æ¢è¿‡ç¨‹<ul><li>ä¸ºäº†é˜²æ­¢åœ°æ–¹è´¢æ”¿æ”¶å…¥çš„å‰§çƒˆä¸‹è·Œï¼Œè®¾ç«‹äº†ç¨æ”¶è¿”è¿˜çš„æœºåˆ¶ï¼Œä¿è¯æ”¹é©ååœ°æ–¹å¢å€¼ç¨æ”¶å…¥å’Œæ”¹é©å‰ä¸€æ ·ï¼Œæ–°å¢éƒ¨åˆ†æ‰å’Œä¸­å¤®åˆ†</li></ul></li></ul></li></ul></li></ul></li><li>æœºæ„è®¾ç½® â€” ä¸åœ°æ–¹è´¢æ”¿è„±é’©<ul><li>å›½ç¨</li><li>åœ°ç¨</li></ul></li><li>è¡Œæ”¿æ–¹å¼<ul><li>çœä»¥ä¸‹ç¨åŠ¡æœºå…³ä»¥å‚ç›´ç®¡ç†ä¸ºä¸»ï¼Œç”±ä¸Šçº§ç¨åŠ¡æœºæ„è´Ÿè´£ç®¡ç†äººå‘˜å’Œå·¥èµ„</li></ul></li></ul></li></ul><aside>ğŸ’¡ å…¬ä¼—æ‰€æ¥è§¦çš„ä¿¡æ¯å’Œçœ‹åˆ°çš„ç°è±¡ï¼Œå¤§éƒ½æ˜¯å·²ç»åšå¼ˆäº†çš„ç»“æœï¼Œè€Œç¼ºå°‘ç¤¾ä¼šé˜…å†çš„å­¦ç”Ÿå®¹æ˜“æŠŠåšå¼ˆç»“æœé”™å½“æˆåšå¼ˆè¿‡ç¨‹ã€‚æˆåŠŸçš„æ”¿ç­–èƒŒåæ˜¯æˆåŠŸçš„åå•†å’Œå¦¥åï¼Œè€Œä¸æ˜¯æœºæ¢°çš„å‘½ä»¤å’Œæ‰§è¡Œï¼Œæ‰€ä»¥ç†è§£åˆ©ç›Šå†²çªï¼Œç†è§£åè°ƒå’Œè§£å†³æœºåˆ¶ï¼Œæ˜¯ç†è§£æ”¿ç­–çš„åŸºç¡€ã€‚</aside><ul><li>åˆ†ç¨åˆ¶æ”¹é©ä¸­çš„æƒè¡¡<ul><li>93å¹´è°ˆï¼Œæƒ³ä»¥92å¹´ä½œä¸ºåŸºå¹´ï¼Œä½†æ˜¯åå•†åæ”¹æˆ93å¹´ï¼Œå› æ­¤å„ä¸ªåœ°æ–¹æ”¿åºœå¼€å§‹93å¹´çªå‡»ç¼´ç¨</li></ul></li><li>åˆ†ç¨åˆ¶æ”¹é©çš„å½±å“<ul><li>ä¸­å¤®å å…¨å›½é¢„ç®—æ€»æ”¶å…¥çš„æ¯”é‡ä»æ”¹é©å‰20% åˆ°äº†55%</li><li>å›½å®¶é¢„ç®—æ”¶å…¥å GDPçš„æ¯”é‡ä»11%å¢åŠ åˆ°äº†20%ä»¥ä¸Š</li></ul></li></ul><h2 id="3-2-åœŸåœ°è´¢æ”¿"><a href="#3-2-åœŸåœ°è´¢æ”¿" class="headerlink" title="3.2 åœŸåœ°è´¢æ”¿"></a>3.2 åœŸåœ°è´¢æ”¿</h2><aside>ğŸ’¡ åˆ†ç¨åˆ¶æ”¹é©å‡å°‘äº†åœ°æ–¹æ”¿åºœçš„å¯æ”¯é…çš„è´¢æ”¿èµ„æºï¼Œä½†æ˜¯æ²¡æœ‰æ”¹å˜ä»¥ç»æµå»ºè®¾ä¸ºä¸­å¿ƒçš„ä»»åŠ¡ï¼›å‘å±•ç»æµæ‰€éœ€çš„è¯¸å¤šé¢å¤–æ”¯å‡ºï¼Œæ¯”å¦‚æ‹›å•†å¼•èµ„ï¼ŒåœŸåœ°å¼€å‘ç­‰ï¼Œéœ€è¦å¦ç­¹èµ„é‡‘äº†</aside><ul><li>è§£å†³æ–¹æ¡ˆ<ul><li>åŠªåŠ›æé«˜ç¨æ”¶è§„æ¨¡</li><li>å¢åŠ é¢„ç®—å¤–æ”¶å…¥<ul><li>å›´ç»•åœŸåœ°å‡ºè®©å’ŒåœŸåœ°å¼€å‘æ‰€äº§ç”Ÿçš„çš„åœŸåœ°è´¢æ”¿</li></ul></li></ul></li><li>åœ°æ–¹æ”¿åºœé’çé‡èµ„äº§çš„åˆ¶é€ ä¸š<ul><li>æŠ•èµ„è§„æ¨¡å¤§ï¼Œå¯¹GDPçš„æ‹‰åŠ¨ä½œç”¨æ˜æ˜¾</li><li>å¢å€¼ç¨åœ¨ç”Ÿäº§ç¯èŠ‚å¢æ”¶ï¼Œè·Ÿç”Ÿäº§è§„æ¨¡ç›´æ¥æŒ‚é’©</li><li>åˆ¶é€ ä¸šä¸ä»…å¯ä»¥å¸çº³ä»å†œä¸šéƒ¨é—¨è½¬ç§»å‡ºæ¥çš„ä½æŠ€èƒ½åŠ³åŠ¨åŠ›ï¼Œä¹Ÿå¯ä»¥å¸¦åŠ¨ç¬¬ä¸‰äº§ä¸šå‘å±•ï¼Œå¢åŠ ç›¸å…³ç¨æ”¶</li></ul></li><li>æ¼”å˜è¿›ç¨‹<ul><li>1998å¹´ å•ä½åœæ­¢ç¦åˆ©åˆ†æˆ¿</li><li>1997 - 2002å¹´ åŸé•‡ä½å®…æ–°å¼€å·¥é¢ç§¯å¹´å‡å¢é•¿26%</li><li>2001å¹´ å›½å®¶æ¨è¡Œæ‹›æ ‡æ‹å–</li><li>2002å¹´ å›½åœŸéƒ¨æ˜ç¡®å››ç±»ç»è¥ç”¨åœ° å•†ä¸šï¼Œæ—…æ¸¸ï¼Œå¨±ä¹ï¼Œæˆ¿åœ°äº§é‡‡ç”¨æ‹›æ‹æŒ‚çš„åˆ¶åº¦</li><li>å›½æœ‰åœŸåœ°è½¬è®©æ”¶å…¥å åœ°æ–¹å…¬å…±é¢„ç®—æ”¶å…¥çš„æ¯”é‡åœ¨60%å·¦å³ ä»1999å¹´ä½äº10% åˆ°ç°åœ¨çš„é«˜åº¦</li></ul></li><li>åœŸåœ°è´¢æ”¿å›Šæ‹¬<ul><li>åœŸåœ°ä½¿ç”¨æƒè½¬è®©æ”¶å…¥</li><li>å’ŒåœŸåœ°ä½¿ç”¨å¼€å‘æœ‰å…³çš„å„ç§ç¨æ”¶æ”¶å…¥<ul><li>å¤§éƒ¨åˆ†ç¨åŸºæ˜¯ä»·å€¼è€Œéé¢ç§¯</li></ul></li></ul></li><li>é—®é¢˜<ul><li>åœŸåœ°èµ„æœ¬åŒ–è¿ä½œï¼Œæ˜¯åœ¨å°†æœªæ¥çš„æ”¶ç›ŠæŠµæŠ¼åˆ°ä»Šå¤©æ¥å€Ÿé’±ï¼Œå› ä¸ºåœ°æ–¹å®˜å‘˜ä»»æœŸæœ‰é™ï¼ŒæŠ•èµ„è´¨é‡æ˜¯éš¾ä»¥ä¿è¯çš„</li></ul></li></ul><h2 id="3-3-æ¨ªå‘çºµå‘çš„ä¸å¹³è¡¡"><a href="#3-3-æ¨ªå‘çºµå‘çš„ä¸å¹³è¡¡" class="headerlink" title="3.3 æ¨ªå‘çºµå‘çš„ä¸å¹³è¡¡"></a>3.3 æ¨ªå‘çºµå‘çš„ä¸å¹³è¡¡</h2><p>åˆ†ç¨åˆ¶æ”¹é©ä»¥åï¼Œä¸­å¤®æ‹¿èµ°äº†å¤§å¤´ï¼Œä½†äº‹æƒ…è¿˜æ˜¯åœ°æ–¹åŠï¼Œåœ°æ–¹æ”¶æ”¯å·®è·éœ€è¦ä¸­å¤®è¿›è¡Œè½¬ç§»æ”¯ä»˜ã€‚å…¨å›½æ€»æ•°ä¸Šæ¥çœ‹ï¼Œèƒ½è¡¥å¾—ä¸Šã€‚ä½†æ€»æ•°ä¸å¾—ä¸Šä¸ä»£è¡¨æ¯ä¸€çº§æ”¿åºœéƒ½èƒ½å¤Ÿè¡¥å¾—ä¸Šã€‚</p><ul><li><p>é—®é¢˜</p><ul><li>è´¢æƒå±‚å±‚ä¸Šæ”¶ï¼Œäº‹æƒå±‚å±‚ä¸‹å‹<ul><li>2000å¹´ æ¹–åŒ—ç›‘åˆ©å¿â€œå†œæ°‘çœŸè‹¦ï¼Œå†œæ‘çœŸç©·ï¼Œå†œä¸šçœŸå±é™©â€ â€” ä¸‰å†œé—®é¢˜<ul><li>å†œæ‘ç¨è´¹æ”¹é©ï¼Œåˆ¶æ­¢åŸºå±‚çš„ä¹±æ‘Šæ´¾ä¹±æ”¶è´¹é—®é¢˜</li><li>åºŸæ­¢å†œä¸šç¨</li></ul></li></ul></li><li>è´¢ç¨ä½“åˆ¶çš„å±‚çº§é—®é¢˜</li></ul></li><li><p>è§£å†³æ–¹æ¡ˆ</p><ul><li>å†œæ‘åŸºæœ¬å…¬å…±æœåŠ¡å¼€å§‹ çº³å…¥å›½å®¶å…¬å…±è´¢æ”¿ä¿éšœèŒƒå›´ï¼Œä¸­å¤®åœ°æ–¹æ”¿åºœå…±åŒæ‰¿æ‹…</li><li>åœ¨è½¬ç§»æ”¯ä»˜ä¸­åŠ å…¥æ¿€åŠ±æœºåˆ¶ï¼Œé¼“åŠ±åŸºå±‚æ”¿åºœè¾¾æˆç‰¹å®šç›®æ ‡ï¼Œå¹¶ç»™äºˆå¥–åŠ±</li><li>å°†åŸºå±‚è´¢æ”¿èµ„æºå‘ä¸Šä¸€çº§æ”¿åºœç»Ÿç­¹<ul><li>ä¹¡è´¢å¿ç®¡</li><li>æ‰©æƒå¼ºå¿</li><li>è´¢æ”¿çœç›´ç®¡å¿</li></ul></li></ul></li><li><p>ä¸­å¤®æ”¿åºœé€šè¿‡å†åˆ†é…  è½¬ç§»æ”¯ä»˜ï¼Œæ”¯æ´ä¸­è¥¿éƒ¨</p></li></ul><h1 id="4-æ”¿åºœæŠ•èèµ„ä¸å€ºåŠ¡"><a href="#4-æ”¿åºœæŠ•èèµ„ä¸å€ºåŠ¡" class="headerlink" title="4. æ”¿åºœæŠ•èèµ„ä¸å€ºåŠ¡"></a>4. æ”¿åºœæŠ•èèµ„ä¸å€ºåŠ¡</h1><aside>ğŸ’¡ åœŸåœ°ä¸ä¼šç§»åŠ¨ä¹Ÿä¸ä¼šæ¶ˆå¤±ï¼Œå¤©ç„¶é€‚åˆä½œæŠµæŠ¼ï¼Œåšå„ç§èµ„æœ¬äº¤æ˜“çš„å‹ä»“æ ‡çš„ï¼Œèº«ä»·è‡ªç„¶é£™å‡ã€‚åœŸåœ°èµ„æœ¬åŒ–çš„é­”åŠ›ï¼Œåœ¨äºå¯ä»¥æŒ£è„±ç‰©ç†å±æ€§ï¼Œåœ¨æŠ½è±¡çš„æ„ä¹‰ä¸Šäº¤æ˜“æ‰¿è¯ºå’Œå¸Œæœ›ï¼Œå°†è¿‡å»çš„å‚¨è“„ï¼Œç°åœ¨çš„æ”¶å…¥ï¼Œæœªæ¥çš„å‰é€”ï¼Œç»Ÿç»Ÿæ±‡èšå’Œå°å­˜åœ¨ä¸€å°ç‰‡åœŸåœ°ä¸Šï¼Œä½¿å…¶ä»·å€¼æš´å¢ã€‚ç»æµå‘å±•çš„å¥¥ç§˜ä¹‹ä¸€ï¼Œå°±æ˜¯å°†æœ‰å½¢èµ„äº§è½¬å˜æˆä¸ºè¿™ç§æŠ½è±¡èµ„æœ¬ï¼Œä»è€Œèšåˆè·¨è¶Šç©ºé—´å’Œæ—¶é—´çš„èµ„æºã€‚</aside><h2 id="4-1-åŸæŠ•å…¬å¸å’ŒåœŸåœ°é‡‘è-â€”-åœŸåœ°å¼€å‘å’ŒåŸºç¡€è®¾æ–½æŠ•èµ„"><a href="#4-1-åŸæŠ•å…¬å¸å’ŒåœŸåœ°é‡‘è-â€”-åœŸåœ°å¼€å‘å’ŒåŸºç¡€è®¾æ–½æŠ•èµ„" class="headerlink" title="4.1 åŸæŠ•å…¬å¸å’ŒåœŸåœ°é‡‘è â€” åœŸåœ°å¼€å‘å’ŒåŸºç¡€è®¾æ–½æŠ•èµ„"></a>4.1 åŸæŠ•å…¬å¸å’ŒåœŸåœ°é‡‘è â€” åœŸåœ°å¼€å‘å’ŒåŸºç¡€è®¾æ–½æŠ•èµ„</h2><ul><li>æ³•å¾‹è§„å®šï¼Œåœ°æ–¹æ”¿åºœä¸å¯ä»¥ä»é“¶è¡Œè´·æ¬¾ï¼Œ2015å¹´å‰ä¹Ÿä¸å…è®¸å‘è¡Œå€ºåˆ¸ â€” å› æ­¤åœ°æ–¹æ”¿åºœéœ€è¦æˆç«‹å…¬å¸<ul><li>å›½æœ‰ç‹¬èµ„ä¼ä¸š â€” åœ°æ–¹æ”¿åºœèèµ„å¹³å° â€” åŸæŠ•å…¬å¸<ul><li>å»ºè®¾æŠ•èµ„ + æŠ•èµ„å¼€å‘ + æ—…æ¸¸å‘å±•</li></ul></li></ul></li><li>åŸæŠ•å…¬å¸çš„ä¸€èˆ¬ç‰¹å¾<ul><li>æŒæœ‰ä»æ”¿åºœå–å¾—çš„å¤§é‡åœŸåœ°ä½¿ç”¨æƒ<ul><li>åœŸåœ°ä½¿ç”¨æƒå¯ä»¥ç”¨æ¥æ’¬åŠ¨é“¶è¡Œè´·æ¬¾ï¼Œä»¥åŠå„ç§å…¶ä»–èµ„é‡‘</li></ul></li><li>ç›ˆåˆ©çŠ¶å†µä¾èµ–æ”¿åºœè¡¥è´´<ul><li>å› ä¸ºæ‰¿æ¥çš„é¡¹ç›®å¾ˆå¤šéƒ½æœ‰åŸºç¡€è®¾æ–½å±æ€§</li><li>é¡¹ç›®æœ¬èº«ç›ˆåˆ©èƒ½åŠ›å¾€å¾€æ¯”è¾ƒå¼±</li></ul></li><li>æ”¿åºœçš„éšæ€§æ‹…ä¿å¯ä»¥è®©ä¼ä¸šå¤§é‡å€Ÿæ¬¾</li></ul></li><li>åœŸåœ°ä¸€çº§å¼€å‘<ul><li>å¹³æ•´æ•´ç†åœŸåœ°</li><li>æŠ•å…¥å¤§ï¼Œåˆ©æ¶¦ä½ï¼Œæ¶‰åŠæ‹†è¿ç­‰é—®é¢˜</li><li>ä¸€èˆ¬ç”±æ”¿åºœèèµ„å¹³å°å…¬å¸å®Œæˆ</li></ul></li><li>åœŸåœ°äºŒçº§å¼€å‘<ul><li>åœŸåœ°çš„å»ºè®¾è¿è¥</li><li>ç”±æˆ¿åœ°äº§å…¬å¸æ¥åš</li></ul></li><li>åå¤å¹¸ç¦çš„æ–¹å¼â€”- æ”¿åºœå’Œç¤¾ä¼šèµ„æœ¬åˆä½œ Public Private Partnership â€” PPP<ul><li>äº§åŸç»“åˆ</li><li>æ”¿åºœå§”æ‰˜åå¤å¹¸ç¦åšä½å®…ç”¨åœ°çš„ä¸€çº§å¼€å‘</li><li>è¿™ç‰‡ç†Ÿåœ°è¦è¿˜ç»™æ”¿åºœçš„</li><li>å†ä»¥æ‹›æ‹æŒ‚ç­‰å…¬å¼€æ–¹å¼å‡ºè®©ç»™ä¸­æ ‡çš„æˆ¿åœ°äº§ä¼ä¸š</li><li>ä»å·¥ä¸šå›­åŒºçš„å‘å±•å½“ä¸­ï¼Œå…¶å¯ä»¥å’Œæ”¿åºœåˆ†äº«ç¨æ”¶æ”¶ç›Š<ul><li>æŒ‰ç…§æ³•å¾‹ï¼Œæ”¿åºœä¸èƒ½å’Œä¼ä¸šç›´æ¥åˆ†äº«ç¨æ”¶ï¼Œä½†æ˜¯å¯ä»¥è´­ä¹°ä¼ä¸šæœåŠ¡ï¼Œç”¨äº§ä¸šå‘å±•æœåŠ¡è´¹çš„åä¹‰æ¥æ”¯ä»˜çº¦å®šçš„åˆ†æˆ</li></ul></li></ul></li></ul><h2 id="4-2-åœ°æ–¹æ”¿åºœå€ºåŠ¡"><a href="#4-2-åœ°æ–¹æ”¿åºœå€ºåŠ¡" class="headerlink" title="4.2 åœ°æ–¹æ”¿åºœå€ºåŠ¡"></a>4.2 åœ°æ–¹æ”¿åºœå€ºåŠ¡</h2><ul><li><p>æ”¿åºœä¾é åœŸåœ°ä½¿ç”¨æƒè½¬è®©æ”¶å…¥æ”¯æ’‘èµ·åœŸåœ°è´¢æ”¿ï¼Œå¹¶å°†æœªæ¥çš„åœŸåœ°æ”¶ç›Šèµ„æœ¬åŒ–ï¼Œä»é“¶è¡Œå’Œå…¶ä»–æ¸ é“å€Ÿå…¥å¤©é‡èµ„é‡‘ï¼Œåˆ©ç”¨åœŸåœ°é‡‘èï¼Œå¿«é€Ÿæ¨åŠ¨å·¥ä¸šåŒ–å’ŒåŸå¸‚åŒ–ï¼Œä½†ä¹ŸåŒæ—¶ç§¯ç´¯äº†å¤§é‡å€ºåŠ¡</p></li><li><p>æ¨¡å¼çš„å…³é”®</p><ul><li>åœŸåœ°ä»·æ ¼<ul><li>åªè¦ä¸æ–­åœ°æŠ•èµ„å’Œå»ºè®¾èƒ½å¸¦æ¥æŒç»­çš„ç»æµå¢é•¿ï¼ŒåŸå¸‚å°±ä¼šæ‰©å¼ ï¼Œåœ°ä»·å°±ä¼šä¸Šæ¶¨</li><li>è¿™æ ·å°±èƒ½å¤Ÿå¿è¿˜è¿æœ¬å¸¦åˆ©è¶Šæ¥è¶Šå¤šçš„å€ºåŠ¡</li><li>ä½†æ˜¯ç»æµå¢é€Ÿä¸€æ—¦æ”¾ç¼“ï¼Œåœ°ä»·ä¸‹è·Œï¼ŒåœŸåœ°å‡ºè®©æ”¶å…¥å‡å°‘ï¼Œç´¯ç§¯çš„å€ºåŠ¡å°±ä¼šæˆä¸ºæ²‰é‡è´Ÿæ‹…ï¼Œå¯èƒ½å‹å®èèµ„å¹³å°ç”šè‡³åœ°æ–¹æ”¿åºœ</li></ul></li></ul></li><li><p>å›½å®¶å¼€å‘é“¶è¡Œå’ŒåŸæŠ•å€º</p><ul><li>ä¸ºä»€ä¹ˆéœ€è¦ä¸Šè¿°äºŒè€…<ul><li>å› ä¸ºåœ°æ–¹æ”¿åºœç©·ï¼Œä½†æ˜¯è¿˜è¦å‘å±•ç»æµï¼ŒåšåŸå¸‚åŒ–</li><li>æƒ³è¦åœ¨åŸå¸‚å»ºè®¾å¼€å‘å½“ä¸­å¼•å…¥é“¶è¡Œèµ„é‡‘ï¼Œéœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜<ul><li>éœ€è¦ä¸€ä¸ªèƒ½å€Ÿæ¬¾çš„å…¬å¸ï¼Œæ”¿åºœä¸èƒ½ç›´æ¥ä»é“¶è¡Œè´·æ¬¾</li><li>åŸå»ºå¼€å‘é¡¹ç›®å¤æ‚ï¼Œæœ‰äº›èµšé’±ï¼Œæœ‰äº›èµ”é’±ï¼Œæ‰€ä»¥éœ€è¦æ‰“åŒ…æ†ç»‘</li><li>ä¾é è´¢æ”¿é¢„ç®—æ”¶å…¥ä¸å¤Ÿè¿˜å€ºçš„ï¼Œè¦èƒ½æŠŠè·ŸåœŸåœ°æœ‰å…³çš„æ”¶ç›Šç”¨èµ·æ¥</li></ul></li></ul></li><li>ä¸ºäº†è§£å†³ä¸Šè¿°å¼•å…¥èµ„é‡‘çš„é—®é¢˜ï¼Œå‡ºç°äº†<strong>åŸæŠ•å…¬å¸</strong><ul><li>å›½å®¶å¼€å‘é“¶è¡Œåˆ›ç«‹çš„è¿™ç§æ¨¡å¼<ul><li>è´·æ¬¾ï¼Œç„¶åå¯ä»¥ç”¨åœŸåœ°å‡ºè®©æ”¶ç›Šä½œä¸ºè´¨æŠ¼è¿›è¡Œè¿˜æ¬¾ä¿è¯</li></ul></li></ul></li><li>åŸå•†è¡Œ<ul><li>ä¸ƒæˆå·¦å³ç¬¬ä¸€è‚¡ä¸œä¸ºåœ°æ–¹æ”¿åºœ</li><li>ä¸ºäº†æ–¹ä¾¿ä¸ºèèµ„å¹³å°å…¬å¸å’ŒåŸºç¡€è®¾æ–½å»ºè®¾æä¾›è´·æ¬¾</li><li>é£é™©<ul><li>åŸºç¡€è®¾æ–½å»ºè®¾é¡¹ç›®å‘¨æœŸé•¿ï¼Œéœ€è¦ä¸­é•¿æœŸè´·æ¬¾<ul><li>å›½å¼€è¡Œæ˜¯æ”¿ç­–æ€§é“¶è¡Œï¼Œæœ‰ç¨³å®šçš„é•¿æœŸèµ„é‡‘æ¥æº</li><li>ä½†æ˜¯å•†ä¸šé“¶è¡Œçš„å­˜æ¬¾å¤§éƒ½æ¥è‡ªçŸ­æœŸå­˜æ¬¾ï¼Œä¸ä¸­é•¿æœŸè´·æ¬¾æœŸé™ä¸åŒ¹é…ï¼Œå®¹æ˜“äº§ç”Ÿé£é™©</li></ul></li><li>å››å¤§è¡Œå­˜æ¬¾æ¥æºåºå¤§ï¼Œå¯ä»¥æ‰¿å—ä¸€å®šç¨‹åº¦æœŸé™é”™é…ï¼Œä½†æ˜¯åŸå•†è¡Œä¸èƒ½ï¼Œç»å¸¸éœ€è¦åœ¨èµ„æœ¬å¸‚åœºèèµ„ï¼Œå®¹æ˜“å‡ºç°é£é™©<ul><li>åŒ…å•†é“¶è¡Œ</li></ul></li></ul></li></ul></li><li>åŸæŠ•å…¬å¸èèµ„æ–¹å¼<ul><li>é“¶è¡Œè´·æ¬¾</li><li>å‘è¡Œå€ºåˆ¸<ul><li>ç†è®ºä¼˜åŠ¿<ul><li>åˆ†æ•£é£é™©</li><li>å€ºåˆ¸å¯äº¤æ˜“ï¼Œä»·æ ¼å’Œåˆ©ç‡å¯å˜ï¼Œé…ç½®æ•ˆç‡é«˜</li></ul></li><li>å®é™…<ul><li>ä¸ƒå…«æˆå•†ä¸šé“¶è¡Œæ‰€æœ‰</li><li>éšæ€§èƒŒä¹¦ï¼Œå°½ç®¡æœ‰é£é™©ï¼Œä½†æ˜¯å¤§å®¶æœ‰ç‚¹ä¸ç®¡ä¸é¡¾</li></ul></li></ul></li></ul></li><li>åœ°æ–¹å€ºåŠ¡<ul><li>éšæ€§è´Ÿå€ºå¾ˆå¤š</li><li>å±€éƒ¨é£é™©å¤§</li><li>å¾ˆå¤šåœ°æ–¹éƒ½é ç€ä¸­å¤®çš„è¡¥è´´ä¿è¯ä¸è¿çº¦ï¼Œä½†æ˜¯å¦‚æœç»æµé‡å†·ï¼Œåœ°ä»·ä¸‹è·Œï¼Œæ”¿åºœä¹Ÿæ— æ³•èƒŒèµ·è¿™æ²‰é‡çš„å€ºåŠ¡äº†</li></ul></li></ul></li><li><p>åœ°æ–¹å€ºçš„æ²»ç†</p><ul><li>å€ºåŠ¡ç½®æ¢<ul><li>ç”¨åœ°æ–¹æ”¿åºœå‘è¡Œçš„å…¬å€ºï¼Œæ›¿æ¢ä¸€éƒ¨åˆ†èèµ„å¹³å°å…¬å¸çš„é“¶è¡Œè´·æ¬¾å’ŒåŸæŠ•å€º<ul><li>å¥½å¤„<ul><li>åˆ©ç‡ä»ä¹‹å‰çš„7% - 8% é™ä½åˆ°4%å·¦å³<ul><li>åŸå…ˆå› ä¸ºæœ‰æ”¿åºœçš„éšæ€§æ‹…ä¿ï¼Œæ‰€ä»¥é“¶è¡Œéƒ½æ„¿æ„è´·ç»™åŸæŠ•ï¼Œè¿™æ ·è¿˜æ‹‰é«˜äº†ä¸€èˆ¬ä¼ä¸šçš„è´·æ¬¾æˆæœ¬å’Œéš¾åº¦</li></ul></li><li>æ”¿åºœå…¬å€ºæœŸé™è¦é•¿å¾ˆå¤š<ul><li>é™ä½äº†æœŸé™é”™é…å’ŒæµåŠ¨æ€§çš„é£é™©</li></ul></li><li>ä¿¡ç”¨çº§åˆ«å‡é«˜</li></ul></li></ul></li><li>å¦‚ä½•ç¡®å®šå€ºåŠ¡ç½®æ¢çš„è§„æ¨¡<ul><li>å›½åŠ¡é™¢ç¡®å®šå¹¶æŠ¥å…¨å›½äººå¤§æˆ–è€…äººå¤§å¸¸å§”ä¼šæ‰¹å‡†</li></ul></li></ul></li><li>æ¨åŠ¨èèµ„å¹³å°è½¬å‹<ul><li>å‰¥ç¦»ä¸ºæ”¿åºœèèµ„çš„åŠŸèƒ½ï¼ŒåŒæ—¶ç ´é™¤æ”¿åºœçš„éšæ€§æ‹…ä¿</li></ul></li><li>çº¦æŸé“¶è¡Œå’Œå„ç±»é‡‘èæœºæ„ï¼Œé¿å…å¤§é‡èµ„é‡‘æµå…¥èèµ„å¹³å°</li><li>é—®è´£å®˜å‘˜ï¼Œå¯¹äºè¿‡åº¦è´Ÿå€ºçš„è¡Œä¸ºç»ˆèº«è¿½è´£</li></ul></li></ul><h2 id="4-3-æ‹›å•†å¼•èµ„å½“ä¸­çš„åœ°æ–¹å®˜å‘˜"><a href="#4-3-æ‹›å•†å¼•èµ„å½“ä¸­çš„åœ°æ–¹å®˜å‘˜" class="headerlink" title="4.3 æ‹›å•†å¼•èµ„å½“ä¸­çš„åœ°æ–¹å®˜å‘˜"></a>4.3 æ‹›å•†å¼•èµ„å½“ä¸­çš„åœ°æ–¹å®˜å‘˜</h2><ul><li>å®˜å‘˜æ”¿ç»©ä¸æ¿€åŠ±æœºåˆ¶<ul><li>åœ°æ–¹ä¸»å®˜å¹³å‡ä»»æœŸä¸‰å››å¹´ï¼Œè€ŒåŸºå»ºé¡¹ç›®ä¸€èˆ¬éƒ½è¦ä¸¤ä¸‰å¹´å®Œæˆ</li><li>æ•…è€Œåˆšä¸Šä»»ä¼šä¸Šé©¬å¤§é‡è¿™ç§é¡¹ç›®</li><li>å„åœ°çš„æŠ•èµ„ æ”¿æ²»æŠ•èµ„å‘¨æœŸæ¯”è¾ƒé¢‘ç¹<ul><li>æ–°å®˜ä¸Šä»»ï¼ŒåœŸåœ°å‡ºè®©æ•°é‡ä¼šå¢åŠ </li><li>æ–°å¢çš„åœŸåœ°ä¾›åº”å¤§å¤šä½äºåŸå¸‚å‘¨è¾¹éƒŠåŒº</li><li>æ‘Šå¤§é¥¼çš„æ€åŠ¿</li></ul></li></ul></li><li>åé‡æŠ•èµ„çš„å¢é•¿æ¨¡å¼å¸¦æ¥çš„é—®é¢˜<ul><li>æ”¿åºœå€ºåŠ¡çš„ä¸æ–­æ”€å‡</li><li>é‡è§†çœ‹å¾—è§çš„ä¸œè¥¿ï¼Œå¿½ç•¥çœ‹ä¸è§çš„</li></ul></li><li>2019è€ƒæ ¸å®˜å‘˜æ ‡å‡†å‘ç”Ÿå˜åŒ–<ul><li>çœ‹å…¨é¢å·¥ä½œï¼Œçœ‹æ¨åŠ¨æœ¬åœ°åŒºç»æµå»ºè®¾ï¼Œæ”¿æ²»å»ºè®¾ï¼Œæ–‡åŒ–å»ºè®¾ï¼Œç¤¾ä¼šå»ºè®¾ï¼Œç”Ÿæ€æ–‡æ˜å»ºè®¾</li><li>è§£å†³å‘å±•ä¸å¹³è¡¡ä¸å……åˆ†çš„é—®é¢˜</li><li>æ»¡è¶³äººæ°‘æ—¥ç›Šå¢é•¿çš„ç¾å¥½ç”Ÿæ´»éœ€è¦çš„æƒ…å†µå’Œå®é™…æˆæ•ˆ</li></ul></li></ul><h1 id="5-å·¥ä¸šåŒ–ä¸­çš„æ”¿åºœè§’è‰²"><a href="#5-å·¥ä¸šåŒ–ä¸­çš„æ”¿åºœè§’è‰²" class="headerlink" title="5. å·¥ä¸šåŒ–ä¸­çš„æ”¿åºœè§’è‰²"></a>5. å·¥ä¸šåŒ–ä¸­çš„æ”¿åºœè§’è‰²</h1><ul><li><p>æ”¿åºœä¸å…·ä½“çš„å·¥ä¸šä¼ä¸šçš„åˆä½œ</p><ul><li>äº¬ä¸œæ–¹<ul><li>ä¸å…¶è¯´æ˜¯ä¸€å®¶å…¬å¸çš„å¥‹æ–—å²ï¼Œä¸å¦‚è¯´æ˜¯æ¶²æ™¶å±äº§ä¸šåœ¨ä¸­å›½çš„å¥‹æ–—å²</li></ul></li></ul></li><li><p>ç°ä»£ç»æµçš„è§„æ¨¡ç»æµæ•ˆåº”éå¸¸å¼ºï¼Œæ–°ä¼ä¸šçš„è¿›å…¥é—¨æ§›éå¸¸é«˜ï¼Œä¸ä»…æŠ•èµ„é¢åº¦å¤§ï¼Œè¿˜è¦é¢å¯¹å…ˆè¿›å…¥è€…å·²ç»ç§¯ç´¯èµ·æ¥çš„å·¨å¤§æˆæœ¬å’ŒæŠ€æœ¯çš„ä¼˜åŠ¿</p></li><li><p>ä¸œäºšç»æµå¥‡è¿¹ï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹ç‚¹</p><ul><li>æ”¿åºœå¸®åŠ©æœ¬åœŸä¼ä¸šè¿›å…¥å¤æ‚åº¦å¾ˆé«˜çš„è¡Œä¸š</li><li>å……åˆ†åˆ©ç”¨å…¶ä¸­çš„å­¦ä¹ æ•ˆåº”ï¼Œè§„æ¨¡æ•ˆåº”ä»¥åŠæŠ€æœ¯å¤–æº¢æ•ˆåº”</li><li>è¿…é€Ÿæå‡æœ¬åœŸåˆ¶é€ ä¸šçš„æŠ€æœ¯èƒ½åŠ›å’Œå›½é™…ç«äº‰åŠ›</li></ul></li><li><p>æ–°å…´åˆ¶é€ ä¸šåœ¨åœ°ç†ä¸Šçš„é›†èšæ•ˆåº”æ˜¯å¾ˆå¼ºçš„ï¼Œå› ä¸ºæ‰å †ç”Ÿäº§å¯ä»¥èŠ‚çº¦åŸææ–™å’Œä¸­é—´æŠ•å…¥çš„è¿è¾“æˆæœ¬</p><ul><li>ä¸”åŒè¡Œèšé›†åœ¨ä¸€èµ·æœ‰åˆ©äºçŸ¥è¯†å’ŒæŠ€æœ¯äº¤æµï¼Œå¤–æº¢æ•ˆåº”å¾ˆå¼º</li><li>å› æ­¤äº§ä¸šé›†ç¾¤ä¸€æ—¦å½¢æˆï¼Œè‡ªèº«å¼•åŠ›å°±ä¼šä¸æ–­å¢å¼ºï¼Œå¾ˆéš¾è¢«å¤–åŠ›æ‰“ç ´</li></ul></li><li><p>å…‰ä¼äº§ä¸š</p><ul><li>æ–°æŠ€æœ¯å¼€å§‹æˆæœ¬ä¼šéå¸¸é«˜ï¼Œå…¶å®éƒ½æ˜¯é æ”¿åºœè¡¥è´´èµšé’±</li><li>æ”¿åºœé€šè¿‡è¡¥è´´é¢åº¦çš„é™ä½æ¥å¼•å¯¼å„ä¸ªä¼ä¸šçš„å‘å±•</li></ul></li><li><p>æ”¿åºœäº§ä¸šå¼•å¯¼åŸºé‡‘ä¸ç§å‹ŸåŸºé‡‘</p><ul><li>LP limited partner  ç»™é’±çš„</li><li>GP general partner æŠ•èµ„çš„</li><li>å¯ä»¥æŠ•ä¸€çº§å¸‚åœºä»¥åŠäºŒçº§å¸‚åœº</li><li>å›½å†…çš„æœ€å¤§ä¸€ç±»LPå°±æ˜¯æ”¿åºœå¼•å¯¼åŸºé‡‘</li></ul></li><li><p>äº§ä¸šå¼•å¯¼åŸºé‡‘çš„ç‰¹ç‚¹</p><ul><li>å¤§å¤šäº§ä¸šå¼•å¯¼åŸºé‡‘ä¸ç›´æ¥æŠ•èµ„ä¼ä¸šï¼Œè€Œæ˜¯åšLPï¼Œå°†é’±äº¤ç»™å¸‚åœºåŒ–çš„ç§å‹ŸåŸºé‡‘çš„GPå»æŠ•èµ„ä¼ä¸š<ul><li>å› ä¸ºä¸€æ”¯ç§å‹Ÿä¸ä»…æœ‰æ”¿åºœèµ„é‡‘ï¼Œè¿˜ä¼šæœ‰å¾ˆå¤šç¤¾ä¼šèµ„æœ¬ï¼Œè¿™æ ·å¯ä»¥åšäº§ä¸šå¼•å¯¼</li></ul></li><li>æ”¿åºœå¼•å¯¼åŸºé‡‘æœ¬èº«å°±æ˜¯ä¸€åªåŸºé‡‘ï¼ŒæŠ•èµ„å¯¹è±¡æ˜¯å„ç§ç§å‹ŸåŸºé‡‘ï¼Œè¢«ç§°ä¸ºæ¯åŸºé‡‘  funds of funds</li><li>å€ŸåŠ©å¸‚åœºåŠ›é‡å»ä½¿ç”¨è´¢æ”¿èµ„é‡‘</li><li>å¤§å¤šæ•°å¼•å¯¼åŸºé‡‘çš„æœ€ç»ˆæŠ•å‘éƒ½æ˜¯æˆ˜ç•¥æ–°å…´äº§ä¸šï¼Œæ¯”å¦‚èŠ¯ç‰‡ï¼Œæ–°èƒ½æºæ±½è½¦ï¼Œè€Œä¸å…è®¸åŸºç¡€è®¾æ–½å’Œæˆ¿åœ°äº§</li></ul></li><li><p>è®¾ç½®äº§ä¸šå¼•å¯¼åŸºé‡‘ä¹‹åï¼Œä¹Ÿéœ€è¦ä¸“é—¨çš„å…¬å¸æ¥è¿è¥å’Œç®¡ç†è¿™åªåŸºé‡‘</p><ul><li>è¿ä½œæ¨¡å¼åˆ†ç±»<ul><li>æ”¿åºœç‹¬èµ„å…¬å¸</li><li>æ··åˆæ‰€æœ‰åˆ¶å…¬å¸</li><li>æ”¿åºœå°†é’±å§”æ‰˜ç»™å¸‚åœºåŒ–çš„æ¯åŸºé‡‘ç®¡ç†äººå»è¿è¥</li></ul></li></ul></li><li><p>æ”¿åºœå¼•å¯¼åŸºé‡‘å‘å±•çš„å¤–éƒ¨æ¡ä»¶</p><ul><li>åˆ¶åº¦æ¡ä»¶<ul><li>åˆ¶åº¦å’Œæ”¿ç­–çš„æŒ‡å¼•</li><li>æä¾›æ”¿ç­–åŸºç¡€ï¼šè®¾ç«‹å¼•å¯¼åŸºé‡‘å‘æŒ¥è´¢æ”¿èµ„é‡‘çš„æ æ†æ”¾å¤§æ•ˆåº”ï¼Œå¢åŠ åˆ›ä¸šæŠ•èµ„èµ„æœ¬çš„ä¾›ç»™ï¼Œå…‹æœå•çº¯é€šè¿‡å¸‚åœºé…ç½®åˆ›ä¸šæŠ•èµ„èµ„æœ¬çš„å¸‚åœºå¤±çµé—®é¢˜</li></ul></li><li>äº§ä¸šæ¡ä»¶<ul><li>ç»æµéœ€è¦å‘å±•åˆ°ä¸€å®šçš„æ°´å¹³ï¼Œä½¿å¾—é«˜æŠ€æœ¯ï¼Œé«˜é£é™©çš„æˆ˜ç•¥æ–°å…´è¡Œä¸šå¾—ä»¥å‡ºç°</li></ul></li><li>èµ„æœ¬å¸‚åœºæˆç†Ÿç¨‹åº¦<ul><li>GP ï¼Œè¶³å¤Ÿå¤§çš„è‚¡æƒäº¤æ˜“å¸‚åœºï¼Œé€€å‡ºæ¸ é“</li></ul></li></ul></li></ul><h1 id="6-åœ°æ–¹æ”¿åºœæ¨åŠ¨ç»æµå‘å±•çš„æ¨¡å¼ä¸ç‰¹ç‚¹"><a href="#6-åœ°æ–¹æ”¿åºœæ¨åŠ¨ç»æµå‘å±•çš„æ¨¡å¼ä¸ç‰¹ç‚¹" class="headerlink" title="6. åœ°æ–¹æ”¿åºœæ¨åŠ¨ç»æµå‘å±•çš„æ¨¡å¼ä¸ç‰¹ç‚¹"></a>6. åœ°æ–¹æ”¿åºœæ¨åŠ¨ç»æµå‘å±•çš„æ¨¡å¼ä¸ç‰¹ç‚¹</h1><h2 id="6-1-é‡åœŸåœ°ï¼Œè½»äºº"><a href="#6-1-é‡åœŸåœ°ï¼Œè½»äºº" class="headerlink" title="6.1 é‡åœŸåœ°ï¼Œè½»äºº"></a>6.1 é‡åœŸåœ°ï¼Œè½»äºº</h2><ul><li>ä¼˜ç‚¹<ul><li>å¯ä»¥å¿«é€Ÿæ¨è¿›åŸå¸‚åŒ–å’ŒåŸºç¡€è®¾æ–½å»ºè®¾</li></ul></li><li>ç¼ºç‚¹<ul><li>å…¬å…±æœåŠ¡ä¾›ç»™ä¸è¶³ï¼Œæé«˜äº†æ”¾å‡å’Œå±…æ°‘å€ºåŠ¡è´Ÿæ‹…</li><li>æ‹‰å¤§äº†åœ°åŒºå·®è·å’Œè´«å¯Œå·®è·</li></ul></li></ul><h2 id="6-2-é‡è§„æ¨¡ï¼Œé‡æ‰©å¼ "><a href="#6-2-é‡è§„æ¨¡ï¼Œé‡æ‰©å¼ " class="headerlink" title="6.2 é‡è§„æ¨¡ï¼Œé‡æ‰©å¼ "></a>6.2 é‡è§„æ¨¡ï¼Œé‡æ‰©å¼ </h2><ul><li>ä¼˜ç‚¹<ul><li>æ¨åŠ¨äº†ä¼ä¸šæˆé•¿å’Œå¿«é€Ÿå·¥ä¸šåŒ–</li></ul></li><li>ç¼ºç‚¹<ul><li>åŠ é‡äº†å€ºåŠ¡è´Ÿæ‹…</li><li>ä¼ä¸šï¼Œåœ°æ–¹æ”¿åºœï¼Œå±…æ°‘ä¸‰éƒ¨é—¨å€ºåŠ¡äº’ç›¸ä½œç”¨ï¼ŒåŠ å¤§äº†ç»æµæ•´ä½“çš„å€ºåŠ¡å’Œé‡‘èé£é™©</li></ul></li></ul><h2 id="6-3-é‡æŠ•èµ„ï¼Œé‡ç”Ÿäº§ï¼Œè½»æ¶ˆè´¹"><a href="#6-3-é‡æŠ•èµ„ï¼Œé‡ç”Ÿäº§ï¼Œè½»æ¶ˆè´¹" class="headerlink" title="6.3 é‡æŠ•èµ„ï¼Œé‡ç”Ÿäº§ï¼Œè½»æ¶ˆè´¹"></a>6.3 é‡æŠ•èµ„ï¼Œé‡ç”Ÿäº§ï¼Œè½»æ¶ˆè´¹</h2><ul><li>ä¼˜ç‚¹<ul><li>æ‹‰åŠ¨äº†ç»æµçš„å¿«é€Ÿå¢é•¿ï¼Œæ‰©å¤§äº†å¯¹å¤–è´¸æ˜“</li><li>ä½¿å¾—æˆ‘å›½è¿…é€Ÿæˆä¸ºäº†åˆ¶é€ ä¸šå¼ºå›½</li></ul></li><li>ç¼ºç‚¹<ul><li>ç»æµç»“æ„çš„ä¸å¹³è¡¡</li><li>å¯¹å†…<ul><li>èµ„æºå‘ä¼ä¸šéƒ¨é—¨è½¬ç§»ï¼Œå±…æ°‘æ”¶å…¥å’Œæ¶ˆè´¹å æ¯”åä½ï¼Œä¸åˆ©äºç»æµé•¿æœŸç¨³å®šå‘å±•</li></ul></li><li>å¯¹å¤–<ul><li>å›½å†…æ— æ³•æ¶ˆçº³çš„äº§èƒ½å‘å›½å¤–è¾“å‡ºï¼ŒåŠ å‰§äº†è´¸æ˜“å†²çª</li></ul></li></ul></li></ul><h1 id="7-åŸå¸‚åŒ–ä¸ä¸å¹³è¡¡"><a href="#7-åŸå¸‚åŒ–ä¸ä¸å¹³è¡¡" class="headerlink" title="7. åŸå¸‚åŒ–ä¸ä¸å¹³è¡¡"></a>7. åŸå¸‚åŒ–ä¸ä¸å¹³è¡¡</h1><aside>ğŸ’¡ ä¸­å›½ç‰¹æœ‰çš„åŸå¸‚åœŸåœ°å›½æœ‰åˆ¶åº¦ï¼Œä¸ºæ”¿åºœå„æ–­åœŸåœ°ä¸€çº§å¸‚åœºåˆ›é€ äº†æ¡ä»¶ï¼Œå°†è¿™ç¬”éšåŒ¿çš„è´¢å¯Œå˜æˆäº†å¯åŠ¨åŸå¸‚åŒ–çš„å·¨å¤§èµ„æœ¬ï¼Œä½†ä¹Ÿè®©åœ°æ–¹è´¢æºé«˜åº¦ä¾èµ–åœŸåœ°ä»·å€¼ï¼Œä¾èµ–æˆ¿åœ°äº§å’Œæˆ¿ä»·ã€‚æˆ¿ä»·è¿ç€åœ°ä»·ï¼Œåœ°ä»·è¿ç€è´¢æ”¿ï¼Œè´¢æ”¿è¿ç€åŸºç¡€è®¾æ–½æŠ•èµ„ï¼Œäºæ˜¯ç»æµå¢é•¿ï¼Œåœ°æ–¹è´¢æ”¿ï¼Œé“¶è¡Œï¼Œæˆ¿åœ°äº§ä¹‹é—´å½¢æˆäº†â€œä¸€è£ä¿±è£ï¼Œä¸€æŸä¿±æŸâ€çš„å¤æ‚å…³ç³»ã€‚</aside><h2 id="7-1-æˆ¿ä»·ä¸å±…æ°‘å€ºåŠ¡"><a href="#7-1-æˆ¿ä»·ä¸å±…æ°‘å€ºåŠ¡" class="headerlink" title="7.1 æˆ¿ä»·ä¸å±…æ°‘å€ºåŠ¡"></a>7.1 æˆ¿ä»·ä¸å±…æ°‘å€ºåŠ¡</h2><ul><li><p>1994å¹´åˆ†ç¨åˆ¶æ”¹é©æ˜¯å¾ˆå¤šé‡å¤§ç»æµç°è±¡çš„åˆ†æ°´å²­</p></li><li><p>åœ°åŒºæˆ¿ä»·å·®å¼‚çš„ä¸»è¦åŸå› æ˜¯ä¾›éœ€å¤±è¡¡</p><ul><li>500ä¸‡äººå’Œ1000ä¸‡äººä»¥ä¸Šçš„å¤§åŸå¸‚åŸåŒºäººå£å¢é‡å å…¨å›½åŸåŒºäººå£å¢é‡çš„è¿‘å››æˆï¼Œä½†å±…ä½ç”¨åœ°å¢é‡æ‰å äº®ç¨‹ï¼Œæˆ¿ä»·äºæ˜¯å°±å¿«é€Ÿä¸Šæ¶¨äº†</li></ul></li><li><p>ä¸­å›½å¯¹å»ºè®¾ç”¨åœ°æŒ‡æ ‡å®è¡Œä¸¥æ ¼çš„ç®¡ç†ï¼Œæ¯å¹´çš„æ–°å¢æŒ‡æ ‡ç”±ä¸­å¤®åˆ†é…åˆ°çœï¼Œå†ç”±çœåˆ†é…åˆ°åœ°æ–¹ã€‚</p><ul><li>è¿™äº›æŒ‡æ ‡æ— æ³•è·¨çœäº¤æ˜“</li><li>ä½†æ˜¯è¿™äº›åœŸåœ°å€¾æ–œæ”¿ç­–æ— æ³•æ”¹å˜äººå£æµå‘ï¼Œäººè¿˜æ˜¯ä¸æ–­å‘ä¸œéƒ¨æ²¿æµ·å’Œå¤§åŸå¸‚èšé›†</li></ul></li><li><p>æˆ¿åœ°äº§</p><ul><li>è¢«ç§°ä¸ºç»æµå‘¨æœŸä¹‹æ¯</li><li>æ ¹æºåœ¨äºå…¶å†…åœ¨çš„ä¾›éœ€çŸ›ç›¾<ul><li>é“¶è¡Œå¯ä»¥é€šè¿‡æŒ‰æ­åˆ›é€ å‡ ä¹æ— é™çš„æ–°è´­ä¹°åŠ›</li><li>ä¸å¯å†ç”Ÿçš„åŸå¸‚åœŸåœ°ä¾›ç»™æ˜¯æœ‰é™çš„</li></ul></li><li>è¿™ç§çŸ›ç›¾ç»å¸¸ä¼šå¯¼è‡´èµ„äº§æ³¡æ²«å’Œç ´è£‚çš„å‘¨æœŸå¾ªç¯ï¼Œæ˜¯é‡‘èå’Œæˆ¿åœ°äº§ä¸ç¨³å®šçš„æ ¸å¿ƒçŸ›ç›¾</li></ul></li><li><p>ä¸­å›½æƒ…å†µ</p><ul><li>ä¸­å›½åŸé•‡å±…æ°‘çš„ä¸»è¦è´¢äº§æ˜¯æˆ¿å­ï¼Œæˆ¿äº§å æ®å®¶åº­èµ„äº§çš„å°†è¿‘ä¸ƒæˆ<ul><li>å…­æˆæ˜¯ä½æˆ¿ï¼Œä¸€æˆæ˜¯å•†é“º</li><li>è€Œç¾å›½72%æ˜¯é‡‘èèµ„äº§ï¼Œ28%æ˜¯æˆ¿äº§</li><li>å³ä¸­ç¾ä¸¤å›½è´¢å¯Œçš„å‹èˆ±çŸ³ä¸ä¸€æ ·ï¼Œä¹Ÿå°±èƒ½çœ‹å‡ºä¸ºä»€ä¹ˆä¸­å›½çœ‹ä¸­æˆ¿å¸‚ï¼Œè€Œç¾å›½çœ‹ä¸­è‚¡å¸‚äº†</li></ul></li><li>æˆ¿ä»·ä¸Šæ¶¨çš„å½±å“<ul><li>å¢åŠ æŒ‰æ­å€ºåŠ¡è´Ÿæ‹…</li><li>æ‹‰å¤§è´«å¯Œå·®è·</li><li>åˆºæ¿€ä½æ”¶å…¥äººç¾¤ä¸¾å€ºæ¶ˆè´¹</li></ul></li><li>ä¹¦é‡Œå¯¹äºæˆ¿äº§ï¼Œå½“å‰æƒ…å†µçš„æè¿°æˆ‘è®¤ä¸ºæ˜¯æµ…å°è¾„æ­¢çš„ï¼Œåªç¨å¾®è¯´äº†ä¸‹ï¼Œå‘å‡ºæ¥ä¸å®¹æ˜“~</li></ul></li></ul><h2 id="7-2-ä¸å¹³è¡¡ä¸è¦ç´ å¸‚åœºæ”¹é©"><a href="#7-2-ä¸å¹³è¡¡ä¸è¦ç´ å¸‚åœºæ”¹é©" class="headerlink" title="7.2 ä¸å¹³è¡¡ä¸è¦ç´ å¸‚åœºæ”¹é©"></a>7.2 ä¸å¹³è¡¡ä¸è¦ç´ å¸‚åœºæ”¹é©</h2><ul><li>äººå£æµåŠ¨å’Œæ”¶å…¥å¹³è¡¡<ul><li>æˆ‘å›½äººå£æµåŠ¨ä¾æ—§å—é™<ul><li>é‡åœŸåœ°è½»äººï¼Œå¯¼è‡´æ°‘ç”Ÿæ”¯å‡ºä¸è¶³ï¼Œä¸åˆ©äºå¤–æ¥äººå£åœ¨åŸå¸‚ä¸­çœŸæ­£å®‰å®¶è½æˆ·</li></ul></li></ul></li><li>è¦å¹³è¡¡çš„æ˜¯äººå‡å·®è·ï¼Œè€Œä¸æ˜¯åœ°åŒºå·®è·</li><li>åœŸåœ°æµè½¬<ul><li>å½“å‰æƒ…å†µæ˜¯å¤§åŸå¸‚ä¸ä»…åœŸåœ°é¢ç§¯æœ‰é™ï¼Œè€Œä¸”æœ‰å¯¹å»ºè®¾ç”¨åœ°æŒ‡æ ‡çš„ç®¡åˆ¶</li><li>å¦‚æœç”¨åœ°æŒ‡æ ‡èƒ½å¤Ÿè·Ÿç€äººå£æµåŠ¨ï¼Œä¼šå¾ˆå¤§ç¨‹åº¦ç¯èŠ‚åœŸåœ°ä¾›éœ€çŸ›ç›¾çš„é—®é¢˜</li><li>è¿˜éœ€è¦è®©å†œæ‘é›†ä½“ç”¨åœ°å‚ä¸æµè½¬ â€” å†œæ‘åœŸåœ°å½’é›†ä½“æ‰€æœ‰</li></ul></li><li>æ”¹é©çš„ç›®æ ‡æ˜¯ä¸ºäº†è®©å„ç§èµ„æºæŒ‰ç…§å¸¸ä½äººå£çš„è§„æ¨¡è¿›è¡Œé…ç½®<ul><li>é‡Œé¢æ¶‰åŠåˆ°<ul><li>å»ºç«‹å¥å…¨åŸä¹¡ç»Ÿä¸€çš„å»ºè®¾ç”¨åœ°å¸‚åœº</li><li>æ·±åŒ–æˆ·ç±åˆ¶åº¦çš„æ”¹é©</li><li>ä»¥ç»å¸¸å±…ä½åœ°ç™»è®°æˆ·å£åˆ¶åº¦</li><li>å»ºç«‹åŸé•‡æ•™è‚²ï¼Œå°±ä¸šåˆ›ä¸šï¼ŒåŒ»ç–—å«ç”Ÿç­‰åŸºæœ¬å…¬å…±æœåŠ¡å’Œå¸¸ä½äººå£æŒ‚é’©çš„æœºåˆ¶</li></ul></li></ul></li></ul><h2 id="7-3-ç»æµå‘å±•ä¸è´«å¯Œå·®è·"><a href="#7-3-ç»æµå‘å±•ä¸è´«å¯Œå·®è·" class="headerlink" title="7.3 ç»æµå‘å±•ä¸è´«å¯Œå·®è·"></a>7.3 ç»æµå‘å±•ä¸è´«å¯Œå·®è·</h2><ul><li>é™ä½äº†å…¨çƒçš„ä¸å¹³ç­‰<ul><li>æ”¹å˜äº†å…¨çƒæ”¶å…¥åˆ†å¸ƒçš„æ ¼å±€</li></ul></li><li>å¤§å®¶éƒ½åœ¨å˜å¯Œ<ul><li>2019å¹´æ”¶å…¥æœ€é«˜çš„20%äººç¾¤å æœ‰å…¨éƒ¨æ”¶å…¥çš„48%ï¼Œè€Œæ”¶å…¥æœ€ä½çš„20%åªå æœ‰å…¨éƒ¨æ”¶å…¥çš„8%</li><li>å¦å¤–ä¸€ä¸ªè§†è§’æ˜¯30å¹´é—´ï¼Œå®é™…æ”¶å…¥æ¶¨äº†8 - 13å€ å¹³å‡ä¸‹æ¥</li></ul></li><li>ç»æµå¢é•¿çš„è¿‡ç¨‹<ul><li>å°½ç®¡ä¸ä¸€å®šå‡å°‘æ”¶å…¥å·®è·ï¼Œä½†æ˜¯å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šéåˆ¶è´«å¯Œå·®è·åœ¨ä»£é™…ä¹‹é—´ä¼ é€’</li><li>å½“å‰æƒ…å†µæ˜¯è´¢äº§æ€§æ”¶å…¥å æ”¶å…¥æ¯”é‡è¶Šæ¥è¶Šå¤§ï¼ŒäººåŠ›èµ„æœ¬æ— æ³•åœ¨ä»£é™…ä¹‹é—´ä¼ æ‰¿çš„ï¼Œä½†æ˜¯æˆ¿äº§ç­‰æœ‰å½¢èµ„äº§æ˜¯å¯ä»¥çš„</li><li>ç»æµå¢é€Ÿä¸‹æ»‘ï¼Œç¤¾ä¼šå¯¹ä¸å¹³ç­‰çš„å®¹å¿ç¨‹åº¦å°±ä¼šä¸‹é™äº†ï¼Œä¸å®‰å®šå› ç´ ä¼šå¢åŠ </li></ul></li><li>å¯¹æ”¶å…¥å·®è·çš„å®¹å¿åº¦<ul><li>éš§é“æ•ˆåº”<ul><li>ä¸€æ¡åœ¨åŠ¨ï¼Œåå‘ä¸åŠ¨çš„æ—¶å€™çš„æåº¦ç„¦èº</li></ul></li><li>ç»æµå½¢åŠ¿ä¸å¥½ï¼Œå¯ŒäººåŠ¨çš„æ…¢ï¼Œç©·äººå¯èƒ½å®Œå…¨æ— æ³•æœ‰è´¢å¯Œå¢é•¿äº†</li></ul></li></ul><h1 id="8-å€ºåŠ¡ä¸é£é™©"><a href="#8-å€ºåŠ¡ä¸é£é™©" class="headerlink" title="8. å€ºåŠ¡ä¸é£é™©"></a>8. å€ºåŠ¡ä¸é£é™©</h1><ul><li>å€ºåŠ¡æœ¬èº«çš„é£é™©<ul><li>äººä»¬åœ¨ä¹è§‚çš„æ—¶å€™å¾€å¾€ä¼šä½ä¼°è´Ÿå€ºçš„é£é™©ï¼Œè¿‡å¤šå€Ÿå€ºã€‚å½“é£é™©å‡ºç°çš„æ—¶å€™ï¼Œåˆä¼šå› ä¸ºå€ºåŠ¡è´Ÿæ‹…æ²‰é‡è€Œç¼ºä¹è…¾æŒªçš„ç©ºé—´ï¼Œæ²¡æœ‰åŠæ³•åº”å¯¹ã€‚</li></ul></li></ul><h2 id="8-1-å€ºåŠ¡ä¸ç»æµè¡°é€€"><a href="#8-1-å€ºåŠ¡ä¸ç»æµè¡°é€€" class="headerlink" title="8.1 å€ºåŠ¡ä¸ç»æµè¡°é€€"></a>8.1 å€ºåŠ¡ä¸ç»æµè¡°é€€</h2><ul><li>è´Ÿå€ºç‡æå¾—ç»æµä¸­ï¼Œèµ„äº§ä»·æ ¼çš„ä¸‹è·Œå¾€å¾€éå¸¸è¿…çŒ›ã€‚è‹¥å€ºåŠ¡å¤ªé‡ï¼Œæ”¶å…¥ä¸å¤Ÿè¿˜æœ¬ï¼Œç”šè‡³ä¸å¤Ÿè¿˜æ¯ï¼Œå°±åªèƒ½å˜å–èµ„äº§ï¼ŒæŠ›å”®çš„äººå¤šäº†ï¼Œèµ„äº§ä»·æ ¼å°±è·³æ°´äº†</li><li>èµ„äº§ä»·æ ¼çš„ä¸‹è·Œä¼šå¼•èµ·ä¿¡è´·æ”¶ç¼©ï¼Œå¯¼è‡´èµ„é‡‘é“¾çš„æ–­è£‚</li><li>ç»æµè¡°é€€ä¼šåŠ å‰§ä¸å¹³ç­‰<ul><li>å› ä¸ºå€ºåŠ¡å±æœºå¯¹ç©·äººå’Œå¯Œäººçš„æ‰“å‡»é«˜åº¦ä¸å¯¹ç§°</li><li>æ³•å¾‹ä¼˜å…ˆä¿æŠ¤å€ºæƒäººçš„ç´¢èµ”æƒï¼Œå³æ¬ å€ºçš„æ— è®ºæ˜¯å…¬å¸è¿˜æ˜¯ä¸ªäººï¼Œå³ä½¿ç ´äº§ä¹Ÿè¦æ¸…ç®—å¿å€º</li></ul></li></ul><h2 id="8-2-å€ºå°ä¸ºä½•é«˜ç­‘"><a href="#8-2-å€ºå°ä¸ºä½•é«˜ç­‘" class="headerlink" title="8.2 å€ºå°ä¸ºä½•é«˜ç­‘"></a>8.2 å€ºå°ä¸ºä½•é«˜ç­‘</h2><ul><li>èµ„é‡‘ä¾›ç»™å’Œé“¶è¡Œç®¡åˆ¶<ul><li>èµ„é‡‘ä¾›ç»™çš„å¢åŠ æºäºé‡‘èç®¡åˆ¶çš„æ”¾æ¾</li><li>é“¶è¡Œè¶Šåšè¶Šå¤§ï¼Œåˆ›é€ çš„ä¿¡è´·è¶Šæ¥è¶Šå¤š</li><li>é‡‘èåˆ›æ–°å’Œè¡ç”Ÿå“ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´é‡‘èéƒ¨é—¨çš„è§„æ¨¡å’Œé£é™©ä¹Ÿåœ¨å¢åŠ </li></ul></li><li>å…¨çƒé“¶è¡Œçš„å±æœºçš„é¢‘ç‡å’Œå›½é™…èµ„æœ¬æµåŠ¨è§„æ¨¡é«˜åº¦ç›¸å…³ï¼Œé‡‘èå±æœºåŸºæœ¬éƒ½ä¼´éšç€é“¶è¡Œçš„å±æœº<ul><li>é“¶è¡Œè§„æ¨¡è¾¾ï¼Œæ æ†é«˜</li><li>é“¶è¡Œå€Ÿæ¥çŸ­æœŸçš„é’±ï¼Œä½†æ˜¯å€Ÿå‡ºå»çš„é’±å´å¤§éƒ½æ˜¯é•¿æœŸçš„<ul><li>è¿™ç§è´Ÿå€ºå’Œèµ„äº§çš„æœŸé™ä¸åŒ¹é…ä¼šå¸¦æ¥æµåŠ¨æ€§é£é™©</li></ul></li><li>é“¶è¡Œä¿¡è´·å¤§éƒ½ä¸æˆ¿åœ°äº§æœ‰å…³ï¼Œå¸¸å¸¸å’ŒåœŸåœ°ï¼Œä»¥åŠæˆ¿äº§ä»·å€¼ä¸€åŒèµ·è½ï¼Œæ”¾å¤§ç»æµæ³¢åŠ¨</li><li>é“¶è¡Œé£é™©ä¼šä¼ å¯¼ç»™å…¶ä»–é‡‘èéƒ¨é—¨<ul><li>æ¯”å¦‚é“¶è¡Œå°†å„ç§æŒ‰æ­è´·æ¬¾æ‰“åŒ…æˆè¯åˆ¸ç»„åˆï¼Œå–ç»™å…¶ä»–é‡‘èæœºæ„</li></ul></li></ul></li><li>è„±å®å‘è™šï¼Œå®é™…ä¸Šä¸€ç›´æ˜¯å¯Œäººçš„é’± è´·ç»™äº†ç©·äººä»¬</li><li>ä¸ºä»€ä¹ˆæŠ•èµ„å˜å°‘äº†ï¼Ÿ<ul><li>åˆ¶é€ ä¸šå¤–è¿ â€” åˆ¶é€ ä¸šæœ¬èº«æ˜¯é‡èµ„äº§ï¼Œé‡æŠ•èµ„çš„è¡Œä¸š</li><li>å½“ä»ŠæŠ€æœ¯æå‡ï¼Œéœ€è¦è¿ç”¨å¤§é‡è½¯ä»¶ä¸æœåŠ¡ï¼Œè€ŒæœåŠ¡ä¸šæ›´ä¾èµ–äºäººçš„é›†èšï¼Œä¹Ÿæ¨å‡äº†å¯¹ç‰¹å®šåœ°æ®µçš„ä½æˆ¿å’Œç¤¾äº¤ç©ºé—´çš„éœ€æ±‚</li></ul></li></ul><aside>ğŸ’¡ åœ¨ç¼ºä¹å¢é•¿ç‚¹çš„æƒ…å†µä¸‹ï¼Œå¤®è¡Œç»™é“¶è¡Œä½“ç³»æä¾›æµåŠ¨æ€§ï¼Œä½†å•†ä¸šé“¶è¡Œèµ„é‡‘è´·ä¸å‡ºå»ï¼Œå®¹æ˜“æµå‘èµ„äº§å¸‚åœºã€‚æ”¾æ¾è´§å¸æ¡ä»¶æ€»ä½“ä¸Šæœ‰åˆ©äºèµ„äº§æŒæœ‰è€…ï¼Œè¶…å®½æ¾çš„è´§å¸æ”¿ç­–å¯èƒ½åŠ å‰§è´¢å¯Œåˆ†åŒ–ï¼Œå›ºåŒ–ç»“æ„æ‰­æ›²ï¼Œä½¿å±æœºè°ƒæ•´çš„è¿‡ç¨‹è¿‡é•¿ã€‚</aside><h2 id="8-3-ä¸­å›½çš„å€ºåŠ¡ä¸é£é™©"><a href="#8-3-ä¸­å›½çš„å€ºåŠ¡ä¸é£é™©" class="headerlink" title="8.3 ä¸­å›½çš„å€ºåŠ¡ä¸é£é™©"></a>8.3 ä¸­å›½çš„å€ºåŠ¡ä¸é£é™©</h2><ul><li>å§‹äº2008å¹´çš„è´¢æ”¿åˆºæ¿€è®¡åˆ’<ul><li>ä¸­å¤®æ”¾æ¾äº†å¯¹åœ°æ–¹èèµ„å¹³å°çš„é™åˆ¶ï¼ŒåŒæ—¶ä¸æ–­é™å‡†é™æ¯ï¼Œæ”¾å®½é“¶è¡Œä¿¡è´·</li><li>è¿™äº›èµ„é‡‘æ‰¾åˆ°äº†åŸºå»ºå’Œæˆ¿åœ°äº§ä¸¤å¤§è½½ä½“</li></ul></li><li>2011 å› ä¸ºç»æµå‡ºç°è¿‡çƒ­ç°è±¡ï¼Œè´§å¸æ”¿ç­–æ”¶ç´§</li><li>ä½†æ˜¯2011å¹´ä¸­ï¼Œæ¬§å€ºå±æœºçˆ†å‘ï¼Œå›½å†…åˆ¶é€ ä¸šé™·å…¥å›°å¢ƒ</li><li>2012å¹´åˆå¼€å§‹é™å‡†é™æ¯</li><li>2015å¹´è‚¡ç¾<ul><li>ç¾å›½é€€å‡ºé‡åŒ–å®½æ¾ï¼Œäººæ°‘å¸æ±‡ç‡è¿…é€Ÿè´¬å€¼</li><li>ä¸­å¤®æ”¾æ¾äº†å¯¹æˆ¿åœ°äº§çš„è°ƒæ§</li><li>å…¨å›½æ£šæˆ·åŒºæ”¹é€ ä»å®ç‰©å®‰ç½®è½¬å˜ä¸ºè´§å¸åŒ–å®‰ç½®ï¼Œå¸¦åŠ¨æˆ¿ä»·è¿›ä¸€æ­¥ä¸Šæ¶¨</li></ul></li><li>æˆ‘å›½ä¼ä¸šå€ºåŠ¡è´Ÿæ‹…éå¸¸é‡ï¼Œåº”å¯¹é£é™©èƒ½åŠ›å¾ˆæœ‰é™</li><li>å½±å­é“¶è¡Œ<ul><li>ç±»ä¼¼é“¶è¡Œçš„ä¿¡è´·ä¸šåŠ¡ï¼Œä½†æ˜¯ä¸åœ¨é“¶è¡Œçš„èµ„äº§è´Ÿå€ºè¡¨å½“ä¸­ï¼Œä¸å—åˆ°é“¶è¡Œç›‘ç®¡è§„åˆ™çš„çº¦æŸ</li><li>æ¯”å¦‚é“¶è¡Œå–ç»™è€ç™¾å§“ä¸€ä¸ªç†è´¢äº§å“ï¼Œåˆ©æ¯5%</li><li>ç„¶åå°†ç­¹æ¥çš„é’±å§”æ‰˜ç»™ä¿¡æ‰˜å…¬å¸</li><li>ä¿¡æ‰˜å…¬å¸å°†é’±å€Ÿç»™å…¬å¸</li><li>è¿™æ ·åšçš„è¯ï¼Œå‘è¡Œçš„ç†è´¢äº§å“ä¸ç®—é“¶è¡Œå‚¨è“„ï¼Œå§”æ‰˜ç»™ä¿¡æ‰˜å…¬å¸çš„æŠ•èµ„ä¸ç®—é“¶è¡Œè´·æ¬¾ï¼Œæ‰€ä»¥å°±ç»•å¼€äº†é“¶è¡Œçš„ç›‘ç®¡</li></ul></li></ul><h2 id="8-4-åŒ–è§£å€ºåŠ¡é£é™©"><a href="#8-4-åŒ–è§£å€ºåŠ¡é£é™©" class="headerlink" title="8.4 åŒ–è§£å€ºåŠ¡é£é™©"></a>8.4 åŒ–è§£å€ºåŠ¡é£é™©</h2><ul><li>è§£å†³æ–¹æ¡ˆ<ul><li>å¿è¿˜å·²æœ‰å€ºåŠ¡<ul><li>å¯èƒ½ä¼šé™·å…¥åˆ°ç»æµè¡°é€€å½“ä¸­ï¼Œå› ä¸ºéƒ½è¦å‹’ç´§è£¤è…°å¸¦è¿‡æ—¥å­</li><li>ä½ çš„æ”¯å‡ºå°±æ˜¯æˆ‘çš„æ”¶å…¥äº†å‘€</li><li>å¢å‘è´§å¸<ul><li>å¢å‘è´§å¸æ¥é™ä½åˆ©ç‡<ul><li>å¯ä»¥åˆºæ¿€æ¶ˆè´¹å’ŒæŠ•èµ„ï¼ŒææŒ¯ç»æµ</li><li>è®¡ç®—å®é™…æ”¶å…¥ä¸å¢åŠ ï¼Œéšç€ç‰©ä»·ä¸Šæ¶¨å’Œæ—¶é—´æ¨ç§»ï¼Œå€ºåŠ¡è´Ÿæ‹…ä¹Ÿä¼šå‡è½»</li></ul></li><li>é‡åŒ–å®½æ¾<ul><li>å¤®è¡Œå¢å‘è´§å¸æ¥ä¹°å…¥å„ç±»èµ„äº§ï¼Œå°†è´§å¸æ³¨å…¥ç»æµ</li><li>æ‰˜ä½èµ„äº§ä»·æ ¼ï¼Œä¸ºç»æµæ³¨å…¥æµåŠ¨æ€§</li><li>é—®é¢˜æ˜¯éš¾ä»¥å°†å¢å‘çš„è´§å¸å‘åˆ°ç©·äººæ‰‹é‡Œï¼Œå› æ­¤éš¾ä»¥åˆºæ¿€æ¶ˆè´¹æ”¯å‡ºï¼Œè¿˜ä¼šæ‹‰å¤§è´«å¯Œå·®è·</li><li>è´­ä¹°å„ç§é‡‘èèµ„äº§å—ç›Šçš„æ˜¯å„ç§èµ„äº§çš„æ‰€æœ‰è€…</li></ul></li><li>å€ºåŠ¡è´§å¸åŒ–<ul><li>æ”¿åºœåŠ å¤§è´¢æ”¿æ”¯å‡ºå»åˆºæ¿€ç»æµ</li><li>ç”±è´¢æ”¿éƒ¨å‘å€ºèèµ„ï¼Œå¤®è¡Œç›´æ¥å°é’±ä¹°è¿‡æ¥ï¼Œæ— éœ€å…¶ä»–é‡‘èæœºæ„å‚ä¸ä¹Ÿæ— éœ€æ”¯ä»˜åˆ©æ¯</li></ul></li></ul></li></ul></li><li>éåˆ¶æ–°å¢å€ºåŠ¡ï¼Œæ”¹é©æ»‹ç”Ÿå€ºåŠ¡çš„æ”¿æ²»ç»æµç¯å¢ƒ<ul><li>æ ¸å¿ƒç‚¹<ul><li>é™åˆ¶æˆ¿ä»·ä¸Šæ¶¨</li><li>é™åˆ¶åœŸåœ°è´¢æ”¿å’ŒåœŸåœ°é‡‘è</li><li>é™åˆ¶æ”¿åºœæ‹…ä¿å’Œå›½æœ‰ä¼ä¸šè¿‡åº¦å€Ÿè´·</li><li>èµ„æœ¬å¸‚åœºæ”¹é©<ul><li>æ”¹å˜ä»¥é“¶è¡Œè´·æ¬¾ä¸ºä¸»çš„é—´æ¥èèµ„ä½“ç³»ï¼Œæ‰©å±•ç›´æ¥èèµ„æ¸ é“<ul><li>èƒ½å¤Ÿé™ä½å€ºåŠ¡è´Ÿæ‹…</li><li>ä¹Ÿèƒ½æé«˜èµ„é‡‘çš„ä½¿ç”¨æ•ˆç‡</li><li>è‚¡æƒçš„çº¦æŸåŠ›è¦æ›´å¼º<ul><li>é£é™©å…±æ‹…</li><li>è‚¡æƒå¯ä»¥è½¬è®©</li></ul></li></ul></li><li>æ”¹é©å¾ˆæ…¢çš„åŸå› å…¶å®æ˜¯æˆ‘å›½é‡‘èèµ„äº§ä¸­72%çš„é£é™©æ˜¯ç”±é‡‘èæœºæ„å’Œæ”¿åºœæ‰¿æ‹…çš„</li></ul></li></ul></li><li>å€ºåŠ¡é—®é¢˜<ul><li>ä»¥å‡ºå£å’ŒæŠ•èµ„é©±åŠ¨çš„ç»æµä½“ç³»çš„äº§ç‰©</li></ul></li></ul></li></ul></li></ul><h1 id="9-å›½å†…å›½é™…çš„å¤±è¡¡"><a href="#9-å›½å†…å›½é™…çš„å¤±è¡¡" class="headerlink" title="9. å›½å†…å›½é™…çš„å¤±è¡¡"></a>9. å›½å†…å›½é™…çš„å¤±è¡¡</h1><ul><li>ä¸­å›½æˆä¸ºåˆ¶é€ ä¸šå¤§å›½èƒŒåçš„ä¸¤ä¸ªé—®é¢˜<ul><li>å†…éƒ¨ç»æµç»“æ„å¤±è¡¡<ul><li>é‡ç”Ÿäº§ï¼Œé‡æŠ•èµ„ï¼Œç›¸å¯¹è½»æ°‘ç”Ÿï¼Œè½»æ¶ˆè´¹</li><li>å¯¼è‡´å’Œå·¨å¤§çš„äº§èƒ½å¯¹æ¯”ï¼Œå›½å†…æ¶ˆè´¹ä¸è¶³ï¼Œæ¶ˆåŒ–ä¸äº†çš„äº§å“åªèƒ½å¯¹å¤–è¾“å‡º</li></ul></li><li>å›½å¤–éœ€æ±‚çš„ä¸ç¨³å®šå’Œè´¸æ˜“å†²çª<ul><li>å®é™…åˆ¶é€ ä¸šä¸­ ä¸­å›½å æ¯”ä»5% åˆ°28%ï¼Œè€Œä¸ƒå›½é›†å›¢ä»72%åˆ°37%ï¼Œå…¶ä»–å›½å®¶åŸºæœ¬æ²¡æœ‰å˜åŒ–</li></ul></li></ul></li></ul><h2 id="9-1-ä½æ¶ˆè´¹å’Œäº§èƒ½è¿‡å‰©"><a href="#9-1-ä½æ¶ˆè´¹å’Œäº§èƒ½è¿‡å‰©" class="headerlink" title="9.1 ä½æ¶ˆè´¹å’Œäº§èƒ½è¿‡å‰©"></a>9.1 ä½æ¶ˆè´¹å’Œäº§èƒ½è¿‡å‰©</h2><ul><li><p>é¢ä¸´æ¶ˆè´¹ä¸è¶³çš„é—®é¢˜</p><ul><li>æˆ‘å›½å±…æ°‘æœ€ç»ˆæ¶ˆè´¹å GDPåªæœ‰44%ï¼Œç¾å›½æœ‰70%ï¼Œæ¬§ç›Ÿå’Œæ—¥æœ¬ä¹Ÿæœ‰55%</li><li>GDPä¸­å¯ä¾›è€ç™¾å§“æ”¯é…çš„æ”¶å…¥ä»½é¢ä¸‹é™äº†ï¼Œæˆ–è€…è€ç™¾å§“æŠŠæ›´å¤§ä¸€éƒ¨åˆ†æ”¶å…¥å­˜äº†èµ·æ¥ï¼Œå‚¨è“„ç±»ä¸Šå‡äº†â€” æˆ‘å›½è¿™ä¸¤ç§æƒ…å†µéƒ½å‡ºç°äº†</li><li>å­©å­æ•°é‡å‡å°‘ä»¥åï¼Œå…»å„¿é˜²è€åŠŸæ•ˆé™ä½ï¼Œçˆ¶æ¯å¼€å§‹å¢åŠ å‚¨è“„æ¥å…»è€äº†</li></ul></li><li><p>å½“å‰çš„é æ”¿åºœ é æŠ•èµ„æ‹‰åŠ¨ç»æµå‘å±•ä¼šå­˜åœ¨å‡ ä¸ªæ–¹é¢çš„é—®é¢˜</p><ul><li>åŸºç¡€è®¾æ–½å’Œå·¥ä¸šä½“ç³»å·²ç»å®Œå–„ï¼ŒæŠ•èµ„éš¾åº¦åŠ å¤§<ul><li>å› æ­¤æŠ•èµ„å†³ç­–å’Œè°ƒé…èµ„æºçš„ä½“åˆ¶éœ€è¦æ”¹å˜</li><li>åœ°æ–¹æ”¿åºœä¸»å¯¼æŠ•èµ„çš„å±€é¢éœ€è¦æ”¹å˜</li></ul></li><li>ç”±äºè€ç™¾å§“æ”¶å…¥å’Œæ¶ˆè´¹éƒ½ä¸è¶³ï¼Œæ— æ³•æ¶ˆåŒ–æŠ•èµ„å½¢æˆçš„äº§èƒ½ï¼Œå¾ˆå¤šæŠ•èµ„ä¸èƒ½å˜æˆæœ‰æ•ˆçš„æ”¶å…¥ï¼Œæ‰€ä»¥å€ºåŠ¡è´Ÿæ‹…è¶Šæ¥è¶Šé‡ï¼Œå¸¦æ¥äº†ä¸€ç³»åˆ—çš„é£é™©</li><li>åŠ³åŠ¨æ”¶å…¥ä»½é¢ä¸‹é™ï¼Œèµ„æœ¬æ”¶å…¥ä»½é¢çš„ä¸Šå‡ï¼Œä¼šæ‰©å¤§è´«å¯Œå·®è·</li><li>ç”±äºæ¶ˆè´¹ä¸è¶³å’ŒæŠ•èµ„è¿‡å‰©ï¼Œè¿‡å‰©äº§èƒ½ä¼šå‘å›½å¤–è¾“å‡ºï¼Œå› ä¸ºæˆ‘å›½ä½“é‡å¾ˆå¤§ï¼Œè¾“å‡ºäº§èƒ½ä¼šå®¶ä¸­å…¨çƒè´¸æ˜“å¤±è¡¡ï¼Œå¼•å‘è´¸æ˜“å†²çª</li></ul></li><li><p>åä¹å¤§æå‡ºäº†</p><ul><li>æé«˜å°±ä¸šè´¨é‡å’Œäººæ°‘æ”¶å…¥æ°´å¹³<ul><li>ç ´é™¤å¦¨ç¢åŠ³åŠ¨åŠ›ï¼Œäººæ‰ç¤¾ä¼šæ€§æµåŠ¨çš„ä½“åˆ¶æœºåˆ¶å¼Šç«¯</li><li>å®Œå–„æ”¿åºœï¼Œå·¥ä¼šï¼Œä¼ä¸šå…±åŒå‚ä¸çš„åå•†åè°ƒæœºåˆ¶</li><li>åšæŒæŒ‰åŠ³åˆ†é…ï¼Œå®Œå–„æŒ‰è¦ç´ åˆ†é…çš„ä½“åˆ¶æœºåˆ¶</li><li>æ‰©å¤§ä¸­ç­‰æ”¶å…¥ç¾¤ä½“ï¼Œå¢åŠ ä½æ”¶å…¥è€…æ”¶å…¥ï¼Œè°ƒèŠ‚è¿‡é«˜æ”¶å…¥ï¼Œå–ç¼”éæ³•æ”¶å…¥</li><li>è¦åŠªåŠ›ä½¿å±…æ°‘æ”¶å…¥å¢é•¿å¿«äºç»æµå¢é•¿</li></ul></li></ul></li><li><p>å‡ºå£å æ¯”é«˜è¿™ç§ç»æµç»“æ„æ¯”è¾ƒè„†å¼±</p><ul><li>å¤–å›½æ”¶åˆ°æ”¿æ²»ç»æµçš„å½±å“å¾ˆå¤§ï¼Œéš¾ä»¥æŒæ§</li></ul></li></ul><h2 id="9-2-ä¸­ç¾è´¸æ˜“å†²çª"><a href="#9-2-ä¸­ç¾è´¸æ˜“å†²çª" class="headerlink" title="9.2 ä¸­ç¾è´¸æ˜“å†²çª"></a>9.2 ä¸­ç¾è´¸æ˜“å†²çª</h2><ul><li><p>åå…¨çƒåŒ–ï¼Œæ°‘ç²¹ä¸»ä¹‰ï¼Œ</p></li><li><p>ä¸­ç¾ä¹‹é—´çš„æŠ€æœ¯å†²å‡»ï¼ŒæŠ€æœ¯ç«äº‰æ‰æ˜¯çœŸæ­£çš„åšå¼ˆ</p></li><li><p>å¯¹äºä¸€ä¸ªç«™åœ¨ç§‘æŠ€å‰æ²¿çš„å›½å®¶æ¥è¯´ï¼Œæ–°æŠ€æœ¯çš„å‘æ˜å’Œåº”ç”¨ä¸€èˆ¬ä»ç§‘å­¦ç ”ç©¶å’Œå®éªŒå®¤å¼€å§‹ï¼Œå†åˆ°æŠ€æœ¯åº”ç”¨å’Œä¸“åˆ©é˜¶æ®µï¼Œç„¶åå†åˆ°å¤§è§„æ¨¡çš„å·¥ä¸šé‡äº§</p></li><li><p>ä½†æ˜¯å¯¹äºä¸€ä¸ªåèµ·çš„å‘å±•ä¸­å›½å®¶æ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™é¡ºåºæ˜¯åçš„</p><ul><li>å…ˆä»åˆ¶é€ ç¯èŠ‚å¼€å§‹ï¼Œè¾¹å¹²è¾¹å­¦ï¼Œç§¯ç´¯æŠ€æœ¯å’Œç»éªŒ</li><li>æ ¹æ®è‡ªèº«éœ€è¦æ”¹è¿›æŠ€æœ¯ï¼Œåˆ›é€ ä¸€äº›ä¸“åˆ©</li><li>äº§å“é”€é‡é€æ­¥æ‰©å¤§ï¼ŒæŠ€æœ¯é€æ­¥å‘å‰æ²¿é æ‹¢ä»¥åï¼Œæ‹¿å‡ºæ›´å¤šèµ„æºæŠ•å…¥ç ”å‘ï¼Œæ¨è¿›æ›´ä¸ºåŸºç¡€ï¼Œåº”ç”¨èŒƒå›´æ›´å¹¿çš„ç§‘ç ”é¡¹ç›®</li></ul></li></ul><h2 id="9-3-å†å¹³è¡¡ä¸å›½å†…å¤§å¾ªç¯"><a href="#9-3-å†å¹³è¡¡ä¸å›½å†…å¤§å¾ªç¯" class="headerlink" title="9.3 å†å¹³è¡¡ä¸å›½å†…å¤§å¾ªç¯"></a>9.3 å†å¹³è¡¡ä¸å›½å†…å¤§å¾ªç¯</h2><ul><li>åŠ å¿«æ„å»ºä»¥å›½å†…å¤§å¾ªç¯ä¸ºä¸»ä½“ï¼Œå›½å†…å›½é™…åŒå¾ªç¯ç›¸äº’ä¿ƒè¿›çš„æ–°å‘å±•æ ¼å±€<ul><li>éœ€è¦æé«˜å±…æ°‘çš„æ”¶å…¥å’Œæ¶ˆè´¹</li><li>éœ€è¦é æœåŠ¡ä¸šçš„å¤§åŠ›å‘å±•äº†ï¼Œè€Œè¿™äº›åªèƒ½å‘å±•åœ¨äººå£å¯†åº¦éå¸¸é«˜çš„åŸå¸‚å½“ä¸­</li><li>éœ€è¦æˆ·ç±åˆ¶åº¦ï¼Œè¿˜æœ‰åœŸåœ°åˆ¶åº¦çš„æ”¹é©</li><li>éœ€è¦æŠŠæ›´å¤šçš„è¥¿è‹‘ä»æ”¿åºœå’Œä¼ä¸šæ‰‹ä¸­è½¬ç§»å‡ºæ¥ï¼Œåˆ†é…ç»™å±…æ°‘</li><li>éœ€è¦æ”¹å˜åœ°æ–¹æ”¿åºœåœ¨ç»æµä¸­æ‰®æ¼”çš„è§’è‰²ï¼Œéåˆ¶å…¶æŠ•èµ„å†²åŠ¨ï¼Œé™ä½å…¶ç”Ÿäº§æ€§æ”¯å‡ºï¼ŒåŠ å¤§æ°‘ç”Ÿæ”¯å‡º</li></ul></li></ul><h1 id="10-æ”¿åºœä¸ç»æµå‘å±•çš„æ€»ç»“"><a href="#10-æ”¿åºœä¸ç»æµå‘å±•çš„æ€»ç»“" class="headerlink" title="10. æ”¿åºœä¸ç»æµå‘å±•çš„æ€»ç»“"></a>10. æ”¿åºœä¸ç»æµå‘å±•çš„æ€»ç»“</h1><ul><li>ä¸€å¥—ä¸¥æ ¼çš„æ¦‚å¿µæ¡†æ¶æ— ç–‘æœ‰åŠ©äºå˜æ¸…é—®é¢˜ï¼Œä½†ä¹Ÿç»å¸¸è®©äººé”™æŠŠé—®é¢˜å½“æˆç­”æ¡ˆ</li><li>éœ€è¦å°†ç«äº‰æœºåˆ¶å¼•å…¥æ”¿åºœ<ul><li>ä»¥ä¸­å¤®æ”¿åºœä¸ºä¸»ï¼Œéƒ¨å§”ä¸ºå•ä½ï¼Œ</li></ul></li><li>ç“¦æ ¼çº³æ³•åˆ™<ul><li>å›½å®¶è¶Šå¯Œè£•ï¼Œæ”¿åºœåœ¨å›½æ°‘ç»æµä¸­æ‰€å çš„æ¯”é‡ä¹Ÿå¾€å¾€ä¼šè¶Šå¤§ï¼Œè€Œä¸æ˜¯è¶Šå°</li><li>å› ä¸ºéšç€æ„ˆå‘å¯Œè£•ï¼Œæ°‘ä¼—å¯¹æ”¿åºœæœåŠ¡çš„éœ€æ±‚ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ”¿åºœåœ¨å…¬ç«‹æ•™è‚²ï¼ŒåŒ»ç–—ï¼Œé€€ä¼‘é‡‘ï¼Œå¤±ä¸šä¿é™©ç­‰æ–¹é¢çš„æ”¯å‡ºä¹Ÿä¼šéšä¹‹å¢åŠ </li></ul></li><li>ç»æµå‘å±•çš„æ ¸å¿ƒæ˜¯æé«˜ç”Ÿäº§ç‡<ul><li>å¯¹äºå¤„äºæŠ€æœ¯å‰æ²¿çš„å‘è¾¾å›½å®¶æ¥è¯´ï¼Œæé«˜ç”Ÿäº§ç‡çš„å…³é”®æ˜¯ä¸æ–­æ¢ç´¢å’Œåˆ›æ–°</li><li>ä½†æ˜¯å¯¹äºå‘å±•ä¸­å›½å®¶æ¥è¯´ï¼Œæé«˜ç”Ÿäº§ç‡çš„å…³é”®ä¸æ˜¯æ¢ç´¢æœªçŸ¥å’Œåˆ›æ–°ï¼Œè€Œæ˜¯å­¦ä¹ å·²çŸ¥çš„æŠ€æœ¯å’Œç®¡ç†æ¨¡å¼ï¼Œå°†æ›´å¤šçš„èµ„æºå°½å¿«ç»„ç»‡å’ŒæŠ•å…¥åˆ°å­¦ä¹ è¿‡ç¨‹å½“ä¸­ï¼Œæ¥æé«˜å­¦ä¹ æ•ˆç‡</li><li>åè¿›å›½å®¶è™½ç„¶æœ‰æ¨¡ä»¿å’Œå­¦ä¹ å…ˆè¿›å›½å®¶æŠ€æœ¯çš„åå‘ä¼˜åŠ¿ï¼Œä½†æ˜¯å…¶ç»„ç»‡å­¦ä¹ æ¨¡å¼ä¸å¯èƒ½ä¸€ç›´æŒç»­ä¸‹å»</li><li>å½“æŠ€æœ¯å’Œç”Ÿäº§ç‡æé«˜åˆ°ä¸€å®šçš„æ°´å¹³ä»¥åï¼Œéœ€è¦æˆåŠŸè½¬å‹æˆæ¢ç´¢åˆ›æ–°æ¨¡å¼ã€‚</li></ul></li><li>åŸå¸‚åŒ– â€” æ˜¯ä¸ªå†œæ°‘è½¬åŒ–ä¸ºå·¥äººçš„è¿‡ç¨‹</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-æ•´ä½“æ¡†æ¶&quot;&gt;&lt;a href=&quot;#1-æ•´ä½“æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;1. æ•´ä½“æ¡†æ¶&quot;&gt;&lt;/a&gt;1. æ•´ä½“æ¡†æ¶&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¾®è§‚æœºåˆ¶&lt;ul&gt;
&lt;li&gt;åœ°æ–¹æ”¿åºœçš„æƒåŠ›å’Œäº‹åŠ¡&lt;/li&gt;
&lt;li&gt;è´¢ç¨ä¸æ”¿åºœè¡Œä¸º&lt;/li&gt;

      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>äººæœˆç¥è¯ç¬”è®°</title>
    <link href="https://www.llchen60.com/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.llchen60.com/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D%E7%AC%94%E8%AE%B0/</id>
    <published>2022-01-31T06:34:42.000Z</published>
    <updated>2022-01-31T06:35:57.437Z</updated>
    
    <content type="html"><![CDATA[<ul><li>è½¯ä»¶æ´»åŠ¨çš„æ ¹æœ¬ä»»åŠ¡<ul><li>æ‰“é€ æ„æˆæŠ½è±¡è½¯ä»¶å®ä½“çš„å¤æ‚æ¦‚å¿µç»“æ„</li></ul></li><li>è½¯ä»¶æ´»åŠ¨çš„æ¬¡è¦ä»»åŠ¡1<ul><li>ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ¥è¡¨è¾¾è¿™äº›æŠ½è±¡å®ä½“ï¼Œåœ¨ç©ºé—´å’Œæ—¶é—´çš„é™åˆ¶ä¸‹å°†ä»–ä»¬æ˜ å°„æˆæœºå™¨è¯­è¨€</li></ul></li></ul><blockquote><p>ä¸€ä¸ªç›¸äº’ç‰µåˆ¶çš„æ¦‚å¿µç»“æ„æ˜¯è½¯ä»¶å®ä½“å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ï¼Œå®ƒåŒ…æ‹¬ï¼šæ•°æ®é›†åˆï¼Œæ•°æ®æ¡ç ä¹‹é—´çš„å…³ç³»ï¼Œç®—æ³•ä»¥åŠåŠŸèƒ½è°ƒç”¨ç­‰ã€‚è¿™äº›è¦ç´ æœ¬èº«æ˜¯æŠ½è±¡çš„ï¼Œä½“ç°åœ¨ä¸åŒçš„è¡¨ç°å½¢å¼ä¸‹çš„æ¦‚å¿µæ„é€ æ˜¯ç›¸åŒçš„ã€‚</p></blockquote><ul><li>è½¯ä»¶ç³»ç»Ÿæ— æ³•è§„é¿çš„å†…åœ¨ç‰¹æ€§<ul><li>å¤æ‚åº¦<ul><li>å…ƒç´ ä¹‹é—´çš„äº¤äº’ï¼Œä½¿å¾—è½¯ä»¶çš„å¤æ‚åº¦æ¯”éçº¿æ€§å¢é•¿è¦é«˜å¾—å¤š</li><li>è½¯ä»¶çš„å¤æ‚åº¦æ˜¯æ ¹æœ¬å±æ€§ï¼ŒæŠ½æ‰å¤æ‚åº¦çš„è½¯ä»¶å®ä½“æè¿°å®é™…ä¸Šä¹Ÿå»æ‰äº†ä¸€äº›æœ¬è´¨å±æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬æ— æ³•åšå¤ªå¤šçš„ç®€åŒ–çš„</li></ul></li><li>ä¸€è‡´æ€§<ul><li>è½¯ä»¶å·¥ç¨‹å½“ä¸­æ²¡æœ‰å¤ªå¤šçš„ä¸€è‡´æ€§ï¼Œæ›´å¤šçš„æ ¸å¿ƒå¼€å‘å·¥ç¨‹å¸ˆæœ¬èº«çš„ç†å¿µ</li></ul></li><li>å¯å˜æ€§<ul><li>è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å±æ€§å¾ˆå®¹æ˜“æ„Ÿå—åˆ°å˜æ›´çš„å‹åŠ›</li></ul></li><li>ä¸å¯è§æ€§<ul><li>è½¯ä»¶æ˜¯ä¸å¯è§ä»¥åŠæ— æ³•å¯è§†åŒ–çš„<ul><li>ä¾‹å¦‚å‡ ä½•æŠ½è±¡æ˜¯å¼ºå¤§çš„å·¥å…·ï¼ŒåŒ…æ‹¬æœºæ¢°åˆ¶å›¾ï¼Œä»¥åŠåŒ–å­¦åˆ†å­æ¨¡å‹ï¼Œä½†æ˜¯è½¯ä½“çš„å®¢è§‚å­˜åœ¨ä¸å…·æœ‰ç©ºé—´çš„å½¢ä½“ç‰¹å¾</li></ul></li></ul></li></ul></li></ul><ul><li><p>ç¼–ç¨‹ç³»ç»Ÿäº§å“(Programming Systems Product) å¼€å‘çš„å·¥ä½œé‡æ˜¯ä¾›ä¸ªäººä½¿ç”¨çš„ï¼Œç‹¬ç«‹å¼€å‘çš„æ„ä»¶ç¨‹åºçš„9å€ã€‚ä¼°è®¡è½¯ä»¶æ„ä»¶äº§å“åŒ–å¼•èµ·äº†3å€å·¥ä½œé‡ï¼Œå°†è½¯ä»¶æ„ä»¶æ•´åˆæˆå®Œæ•´ç³»ç»Ÿæ‰€éœ€è¦çš„è®¾è®¡ã€é›†æˆå’Œæµ‹è¯•åˆåŠ å¼ºäº†3å€çš„å·¥ä½œé‡ï¼Œè¿™äº›é«˜æˆæœ¬çš„æ„ä»¶åœ¨æ ¹æœ¬ä¸Šæ˜¯ç›¸äº’ç‹¬ç«‹çš„</p></li><li><p>ç¼–ç¨‹è¡Œä¸šæ»¡è¶³äº†æˆ‘ä»¬å†…å¿ƒæ·±å¤„çš„åˆ›é€ æ¸´æœ›å’Œæ„‰æ‚¦æ‰€æœ‰äººçš„å…±æœ‰æƒ…æ„Ÿï¼Œæä¾›äº†5ç§ä¹è¶£</p><ul><li>åˆ›å»ºäº‹ç‰©çš„å¿«ä¹</li><li>å¼€å‘å¯¹å…¶ä»–äººæœ‰ç”¨çš„ä¸œè¥¿çš„ä¹è¶£</li><li>å°†å¯ä»¥æ´»åŠ¨ï¼Œç›¸äº’é½¿åˆçš„é›¶éƒ¨ä»¶ç»„è£…æˆç±»ä¼¼è¿·å®«çš„ä¸œè¥¿ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½“ç°å‡ºçš„ä»¤äººç¥é­‚é¢ å€’çš„ç¾ä¸½</li><li>é¢å¯¹ä¸é‡å¤çš„ä»»åŠ¡ï¼Œä¸æ–­å­¦ä¹ çš„ä¹è¶£</li><li>å·¥ä½œåœ¨å¦‚æ­¤æ˜“äºé©¾é©­çš„ä»‹è´¨ä¸Šçš„ä¹è¶£â€”â€” çº¯ç²¹çš„æ€ç»´æ´»åŠ¨ â€”â€” å…¶å­˜åœ¨ï¼Œç§»åŠ¨å’Œè¿è½¬æ–¹å¼å®Œå…¨ä¸åŒäºå®é™…ç‰©ä½“</li></ul></li><li><p>åŒæ ·ï¼Œè¿™ä¸ªè¡Œä¸šæœ‰ä¸€äº›å†…åœ¨å›ºæœ‰çš„çƒ¦æ¼</p><ul><li>å°†åšäº‹æ–¹å¼è°ƒæ•´åˆ°è¿½æ±‚å®Œç¾æ˜¯å­¦ä¹ ç¼–ç¨‹çš„æœ€å›°éš¾éƒ¨åˆ†</li><li>æƒå¨ä¸ç­‰åŒäºè´£ä»»ï¼›çœŸæ­£çš„æƒå¨æ¥è‡ªäºæ¯æ¬¡ä»»åŠ¡çš„å®Œæˆ</li><li>ä»»ä½•åˆ›é€ æ€§æ´»åŠ¨éƒ½ä¼´éšç€æ¯ç‡¥è‰°è‹¦çš„åŠ³åŠ¨ï¼Œç¼–ç¨‹ä¹Ÿä¸ä¾‹å¤–</li><li>äººä»¬é€šå¸¸å¸Œæœ›é¡¹ç›®åœ¨æ¥è¿‘ç»“æŸçš„æ—¶å€™ï¼Œè½¯ä»¶é¡¹ç›®èƒ½æ”¶æ•›å¾—å¿«ä¸€äº›ï¼Œç„¶è€Œï¼Œæƒ…å†µå´æ˜¯è¶Šæ¥è¿‘å®Œæˆï¼Œæ”¶æ•›å¾—è¶Šæ…¢</li><li>äº§å“åœ¨å®Œæˆå‰æ€»é¢ä¸´ç€é™ˆæ—§è¿‡æ—¶çš„å¨èƒï¼Œåªæœ‰å®é™…éœ€è¦çš„æ—¶å€™ï¼Œæ‰ä¼šç”¨åˆ°æœ€æ–°çš„è®¾æƒ³</li></ul></li><li><p>ç¼ºä¹åˆç†çš„æ—¶é—´è¿›åº¦æ˜¯é€ æˆé¡¹ç›®æ»åçš„æœ€ä¸»è¦åŸå› ï¼Œå®ƒæ¯”å…¶ä»–æ‰€æœ‰å› ç´ çš„æ€»å’Œå½±å“è¿˜å¤§</p></li><li><p>æ‰€æœ‰ç¼–ç¨‹äººå‘˜éƒ½æ˜¯ä¹è§‚ä¸»ä¹‰è€…ï¼Œä¸€åˆ‡éƒ½å°†è¿ä½œè‰¯å¥½</p></li><li><p>ç”±äºç¼–ç¨‹äººå‘˜é€šè¿‡çº¯ç²¹çš„æ€ç»´æ´»åŠ¨æ¥å¼€å‘ï¼Œæˆ‘ä»¬æœŸå¾…åœ¨å®ç°è¿‡ç¨‹å½“ä¸­ä¸ä¼šç¢°åˆ°å›°éš¾ã€‚ä½†æ˜¯æˆ‘ä»¬æœ¬èº«çš„æ„æ€æ˜¯ä¼šæœ‰ç¼ºé™·çš„ï¼Œå› æ­¤æ€»ä¼šæœ‰bug</p></li><li><p>å›´ç»•ç€æˆæœ¬æ ¸ç®—çš„ä¼°è®¡æŠ€æœ¯ï¼Œæ··æ·†äº†å·¥ä½œé‡å’Œé¡¹ç›®è¿›å±•ã€‚äººæœˆæ˜¯å±é™©çš„ï¼Œå› ä¸ºå®ƒæš—ç¤ºç€äººå‘˜æ•°é‡å’Œæ—¶é—´æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„ã€‚</p></li><li><p>åœ¨è‹¥å¹²äººå‘˜ä¸­åˆ†è§£ä»»åŠ¡ä¼šå¼•å‘é¢å¤–çš„æ²Ÿé€šå·¥ä½œé‡ â€” åŸ¹è®­å’Œç›¸äº’æ²Ÿé€šã€‚</p></li><li><p>Brooksæ³•åˆ™ï¼š ä¸ºè¿›åº¦è½åçš„é¡¹ç›®å¢åŠ äººæ‰‹ï¼Œåªä¼šä½¿å¾—è¿›åº¦æ›´åŠ è½å</p><ul><li>å¢æ´¾äººæ‰‹å¯èƒ½å¢åŠ çš„å·¥ä½œé‡<ul><li>ä»»åŠ¡é‡æ–°åˆ†é…æœ¬èº«å’Œæ‰€é€ æˆçš„å·¥ä½œä¸­æ–­</li><li>åŸ¹è®­æ–°äººå‘˜</li><li>é¢å¤–çš„ç›¸äº’æ²Ÿé€š</li></ul></li></ul></li><li><p>åŒæ ·æœ‰ä¸¤å¹´ç»éªŒè€Œä¸”åœ¨å—åˆ°åŒæ ·åŸ¹è®­çš„æƒ…å†µä¸‹ï¼Œä¼˜ç§€çš„ä¸“ä¸šç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›æ˜¯è¾ƒå·®çš„ç¨‹åºå‘˜çš„10å€ã€‚</p></li><li><p>ä¸€ä½é¦–å¸­ç¨‹åºå‘˜ï¼Œç±»ä¼¼äºå¤–ç§‘æ‰‹æœ¯é˜Ÿä¼çš„å›¢é˜Ÿæ¶æ„æä¾›äº†ä¸€ç§æ–¹æ³•â€”â€” æ—¢èƒ½è·å¾—ç”±å°‘æ•°å¤´è„‘äº§ç”Ÿçš„äº§å“å®Œæ•´æ€§ï¼Œåˆèƒ½å¤Ÿå¾—åˆ°å¤šä½ååŠ©äººå‘˜çš„æ€»ä½“ç”Ÿäº§ç‡ï¼Œè¿˜å½»åº•å‡å°‘äº†æ²Ÿé€šçš„å·¥ä½œé‡ã€‚</p></li><li><p>æ¦‚å¿µå®Œæ•´æ€§æ˜¯ç³»ç»Ÿè®¾è®¡ä¸­æœ€é‡è¦çš„è€ƒè™‘å› ç´ </p><ul><li>ä¸ºäº†è·å¾—æ¦‚å¿µçš„å®Œæ•´æ€§ï¼Œè®¾è®¡å¿…é¡»ç”±ä¸€ä¸ªäººæˆ–è€…å…·æœ‰å…±è¯†çš„å°å‹å›¢é˜Ÿæ¥å®Œæˆ</li><li>ä¸ºäº†è·å¾—æ¦‚å¿µçš„å®Œæ•´æ€§ï¼Œå°±å¿…é¡»æœ‰äººæ§åˆ¶è¿™äº›æ¦‚å¿µï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§æ— éœ€ä»»ä½•æ­‰æ„çš„è´µæ—ä¸“åˆ¶ç»Ÿæ²»</li></ul></li><li><p>åŠŸèƒ½å’Œç†è§£ä¸Šçš„å¤æ‚ç¨‹åº¦çš„æ¯”å€¼æ‰æ˜¯ç³»ç»Ÿè®¾è®¡çš„æœ€ç»ˆæµ‹è¯•æ ‡å‡†ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸°å¯Œçš„åŠŸèƒ½</p></li><li><p>å°½æ—©äº¤æµå’ŒæŒç»­æ²Ÿé€šèƒ½å¤Ÿä½¿å¾—ç»“æ„å¸ˆæœ‰è¾ƒå¥½çš„æˆæœ¬æ„è¯†ï¼Œä½¿å¼€å‘äººå‘˜è·å¾—å¯¹è®¾è®¡çš„ä¿¡å¿ƒï¼Œå¹¶ä¸”ä¸ä¼šæ··æ·†å„è‡ªçš„è´£ä»»åˆ†å·¥</p></li><li><p>äº¤æµ</p><ul><li>å·´æ¯”ä¼¦é¡¹ç›®çš„å¤±è´¥æ˜¯å› ä¸ºç¼ºä¹äº¤æµä»¥åŠäº¤æµçš„ç»“æœ â€”â€” ç»„ç»‡</li><li>å› ä¸ºå·¦æ‰‹ä¸çŸ¥é“å³æ‰‹åœ¨åšä»€ä¹ˆï¼Œä»è€Œè¿›åº¦ç¾éš¾ï¼ŒåŠŸèƒ½çš„ä¸åˆç†ï¼Œä»¥åŠç³»ç»Ÿçš„ç¼ºé™·çº·çº·å‡ºç°ã€‚ç”±äºå­˜åœ¨å¯¹å…¶ä»–äººçš„å„ç§å‡è®¾ï¼Œå›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„ç†è§£å¼€å§‹å‡ºç°åå·®äº†ã€‚</li></ul></li><li><p>é¡¹ç›®å·¥ä½œæ‰‹å†Œ</p><ul><li>é¡¹ç›®å·¥ä½œæ‰‹å†Œæ˜¯å¯¹é¡¹ç›®å¿…é¡»äº§ç”Ÿçš„ä¸€äº›åˆ—æ–‡æ¡£è¿›è¡Œç»„ç»‡çš„ä¸€ç§ç»“æ„</li><li>æ¯ä¸€ä¸ªå›¢é˜Ÿæˆå‘˜åº”è¯¥äº†è§£æ‰€æœ‰çš„ææ–™</li><li>å®æ—¶æ›´æ–°å¾ˆé‡è¦</li><li>å·¥ä½œæ‰‹å†Œçš„ä½¿ç”¨è€…åº”è¯¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä¸Šæ¬¡é˜…è¯»ä¹‹åçš„å˜æ›´ä»¥åŠå…³äºè¿™äº›å˜æ›´é‡è¦æ€§çš„è¯„è¿°ä¸Š</li><li>æ¯ä¸ªéƒ¨åˆ†åº”è¯¥è¢«å°è£…ï¼Œä»è€Œæ²¡æœ‰äººéœ€è¦æˆ–è€…è¢«å…è®¸çœ‹åˆ°å…¶ä»–éƒ¨åˆ†çš„å†…éƒ¨ç»“æ„ï¼Œåªéœ€è¦äº†è§£æ¥å£</li></ul></li><li><p>ç»„ç»‡æ¶æ„</p><ul><li>å›¢é˜Ÿç»„ç»‡çš„ç›®æ ‡æ˜¯ä¸ºäº†å‡å°‘å¿…è¦çš„äº¤æµå’Œåä½œé‡</li><li>ä¸ºäº†å‡å°‘äº¤æµï¼Œç»„ç»‡ç»“æ„åŒ…æ‹¬äº†äººåŠ›åˆ’åˆ†(Division of labor) å’Œé™å®šèŒè´£èŒƒå›´(Specialization of function)</li><li>ç»„ç»‡å†…çš„äº¤æµæ˜¯ç½‘çŠ¶çš„ï¼Œè€Œä¸æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œå› æ­¤æ‰€æœ‰çš„ç‰¹æ®Šç»„ç»‡æœºåˆ¶éƒ½æ˜¯ä¸ºäº†è¿›è¡Œè°ƒæ•´ï¼Œæ¥å…‹æœæ ‘çŠ¶ç»„ç»‡ç»“æ„ä¸­äº¤æµç¼ºä¹çš„å›°éš¾</li></ul></li><li><p>åœ¨å¤§å‹å›¢é˜Ÿå½“ä¸­ï¼Œå„ä¸ªå°ç»„å€¾å‘äºä¸æ–­çš„å»åšå±€éƒ¨ä¼˜åŒ–ï¼Œæ¥æ»¡è¶³è‡ªå·±çš„ç›®æ ‡ï¼Œè€Œæ¯”è¾ƒå°‘çš„è€ƒè™‘å¯¹ç”¨æˆ·çš„æ•´ä½“å½±å“ã€‚è¿™ç§æ–¹å‘æ€§çš„é—®é¢˜æ˜¯å¤§å‹é¡¹ç›®çš„ä¸»è¦å±é™©</p></li><li><p>ä»ç³»ç»Ÿæ•´ä½“å‡ºå‘å’Œé¢å‘ç”¨æˆ·çš„æ€åº¦æ˜¯è½¯ä½“ç¼–ç¨‹ç®¡ç†äººå‘˜æœ€é‡è¦çš„èŒèƒ½</p></li><li><p>æ–‡æ¡£çš„è§„èŒƒï¼Œç›®æ ‡ï¼Œç”¨æˆ·æ‰‹å†Œï¼Œå†…éƒ¨æ–‡æ¡£ï¼Œè¿›åº¦ï¼Œé¢„ç®—ï¼Œç»„ç»‡æœºæ„å›¾ï¼Œå’Œå·¥ä½œç©ºé—´åˆ†é…</p><ul><li>æ¯ä¸ªæ–‡æ¡£æœ¬èº«å°±å¯ä»¥ä½œä¸ºæ£€æŸ¥åˆ—è¡¨æˆ–è€…æ•°æ®åº“</li></ul></li><li><p>é¡¹ç›®ç»ç†çš„åŸºæœ¬èŒè´£æ˜¯ä½¿æ¯ä¸ªäººéƒ½å‘ç€ç›¸åŒçš„æ–¹å‘å‰è¿›</p></li><li><p>é¡¹ç›®ç»ç†çš„ä¸»è¦æ—¥å¸¸å·¥ä½œæ˜¯æ²Ÿé€šï¼Œè€Œä¸æ˜¯åšå‡ºå†³å®šï¼›æ–‡æ¡£ä½¿å¾—å„é¡¹è®¡åˆ’å’Œå†³ç­–åœ¨æ•´ä¸ªå›¢é˜ŸèŒƒå›´å†…å¾—åˆ°äº¤æµ</p></li><li><p>ç”¨æˆ·çš„å®é™…éœ€è¦å’Œç”¨æˆ·æ„Ÿè§‰ä¼šéšç€ç¨‹åºæ„å»ºï¼Œæµ‹è¯•å’Œä½¿ç”¨è€Œå‘ç”Ÿå˜åŒ–ã€‚</p></li><li><p>å¯¹äºæ–‡æ¡£ï¼Œéœ€è¦é‡‡ç”¨å®šä¹‰è‰¯å¥½çš„æ•°å­—åŒ–ç‰ˆæœ¬å°†å˜æ›´é‡å­åŒ–</p></li><li><p>ç¨‹åºå‘˜ä¸æ„¿æ„ä¸ºè®¾è®¡ä¹¦å†™æ–‡æ¡£ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºæƒ°æ€§ï¼Œæ›´å¤šçš„æ˜¯æºäºè®¾è®¡äººå‘˜çš„è¸Œèº‡ â€”â€” è¦ä¸ºè‡ªå·±å°è¯•æ€§çš„è®¾è®¡å†³ç­–è¿›è¡Œè¾©è§£ã€‚</p></li><li><p>åªè¦ç®¡ç†äººå‘˜å’ŒæŠ€æœ¯äººå‘˜çš„å¤©èµ‹å…è®¸ï¼Œè€æ¿å¿…é¡»å¯¹ä»–ä»¬çš„èƒ½åŠ›åŸ¹å…»ç»™äºˆæå¤§çš„å…³æ³¨ï¼Œä½¿å¾—ç®¡ç†äººå‘˜å’ŒæŠ€æœ¯äººå‘˜å…·æœ‰äº’æ¢æ€§ï¼›ç‰¹åˆ«æ˜¯å¸Œæœ›åœ¨æŠ€æœ¯å’Œç®¡ç†è§’è‰²ä¹‹é—´è‡ªç”±çš„åˆ†é…äººæ‰‹çš„æ—¶å€™</p></li><li><p>å…·æœ‰ä¸¤æ¡æ™‹å‡çº¿çš„é«˜æ•ˆç»„ç»‡æœºæ„å­˜åœ¨ç€ä¸€äº›ç¤¾ä¼šæ€§çš„éšœç¢ï¼Œäººä»¬å¿…é¡»è­¦æƒ•å¹¶ç§¯æçš„åŒå®ƒåšæŒç»­çš„æ–—äº‰</p></li><li><p>ç¨‹åºç»´æŠ¤åŸºæœ¬ä¸Šä¸åŒäºç¡¬ä»¶çš„ç»´æŠ¤ï¼šä¸»è¦ç”±å„ç§å˜æ›´ç»„æˆï¼Œå…¥ä¿®å¤è®¾è®¡ç¼ºé™·ï¼Œæ–°å¢åŠŸèƒ½ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ç¯å¢ƒæˆ–è€…é…ç½®å˜æ¢å¼•èµ·çš„è°ƒæ•´</p></li><li><p>å¯¹äºä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ç¨‹åºï¼Œå…¶ç»´æŠ¤æ€»æˆæœ¬é€šå¸¸æ˜¯å¼€å‘æˆæœ¬çš„40%æˆ–è€…æ›´å¤š</p></li><li><p>CampbellæŒ‡å‡ºäº†ä¸€ä¸ªæ˜¾ç¤ºäº§å“ç”Ÿå‘½æœŸä¸­æ¯æœˆbugæ•°çš„æœ‰è¶£æ›²çº¿ï¼Œå…¶å…ˆæ˜¯ä¸‹é™ï¼Œåé¢æ˜¯ä¸Šå‡</p></li><li><p>æ¯æ¬¡ä¿®å¤ä¹‹åï¼Œå¿…é¡»é‡æ–°è¿è¡Œå…ˆå‰æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿ç³»ç»Ÿä¸ä¼šä»¥æ›´éšè”½çš„æ–¹å¼è¢«ç ´å</p></li><li><p>æ‰€æœ‰çš„ä¿®æ”¹éƒ½å€¾å‘äºç ´åç³»ç»Ÿçš„æ¶æ„ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„æ··ä¹±ç¨‹åº¦(ç†µ)ã€‚å³ä½¿æ˜¯æœ€ç†Ÿç»ƒçš„è½¯ä»¶ç»´æŠ¤å·¥ä½œï¼Œä¹Ÿåªæ˜¯å»¶ç¼“äº†ç³»ç»Ÿé€€åŒ–åˆ°ä¸å¯ä¿®å¤çš„æ··ä¹±çŠ¶æ€çš„è¿›ç¨‹ï¼Œä»¥è‡´å¿…é¡»é‡æ–°è¿›è¡Œè®¾è®¡ã€‚</p></li><li><p>é¡¹ç›®ç»ç†åº”è¯¥åˆ¶å®šä¸€å¥—ç­–ç•¥ï¼Œå¹¶ä¸ºé€šç”¨å·¥å…·çš„å¼€å‘åˆ†é…èµ„æºï¼Œä¸æ­¤åŒæ—¶ï¼Œè¿˜å¿…é¡»æ„è¯†åˆ°ä¸“ä¸šå·¥å…·çš„éœ€æ±‚</p></li><li><p>è°ƒè¯•æ˜¯ç³»ç»Ÿç¼–ç¨‹ä¸­è¾ƒæ…¢å’Œè¾ƒå›°éš¾çš„éƒ¨åˆ†ï¼Œè€Œæ¼«é•¿çš„è°ƒè¯•å‘¨è½¬æ—¶é—´æ˜¯è°ƒè¯•çš„ç¥¸æ ¹</p></li><li><p>åœ¨ç¼–å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œè§„æ ¼è¯´æ˜å¿…é¡»æäº¤ç»™å¤–éƒ¨çš„æµ‹è¯•äººå‘˜ï¼Œæ¥è¯¦ç»†çš„æ£€æŸ¥è¯´æ˜çš„å®Œæ•´æ€§å’Œæ˜ç¡®æ€§ã€‚å¼€å‘äººå‘˜è‡ªå·±æ— æ³•å®Œæˆè¿™é¡¹å·¥ä½œã€‚</p></li><li><p>å¼€å‘å¤§é‡çš„è¾…åŠ©æµ‹è¯•å¹³å°å’Œæµ‹è¯•ä»£ç æ˜¯å¾ˆå€¼å¾—çš„ï¼Œä»£ç é‡ç”šè‡³å¯èƒ½æœ‰æµ‹è¯•å¯¹è±¡çš„ä¸€åŠ</p></li><li><p>é¡¹ç›®æ˜¯æ€ä¹ˆæ ·è¢«å»¶è¿Ÿäº†æ•´æ•´ä¸€å¹´çš„æ—¶é—´çš„â€¦.. ä¸€æ¬¡ä¸€å¤©ã€‚ä¸€æ¬¡ä¸€å¤©çš„è¿›åº¦è½åæ¯”é‡å¤§ç¾éš¾æ›´éš¾ä»¥è¯†åˆ«ï¼Œæ›´ä¸å®¹æ˜“é˜²èŒƒå’Œæ›´åŠ éš¾ä»¥å¼¥è¡¥ã€‚</p></li><li><p>æ ¹æ®ä¸€ä¸ªä¸¥æ ¼çš„è¿›åº¦è¡¨æ¥æ§åˆ¶å¤§å‹é¡¹ç›®çš„ç¬¬ä¸€ä¸ªæ­¥éª¤æ˜¯åˆ¶å®šè¿›åº¦è¡¨ï¼Œè¿›åº¦è¡¨ç”±é‡Œç¨‹ç¢‘å’Œæ—¥æœŸç»„æˆ</p><ul><li>é‡Œç¨‹ç¢‘å¿…é¡»æ˜¯å…·ä½“çš„ï¼Œç‰¹å®šçš„ï¼Œå¯åº¦é‡çš„äº‹ä»¶ï¼Œéœ€è¦èƒ½å¤Ÿè¿›è¡Œæ¸…æ™°çš„å®šä¹‰</li></ul></li><li><p>æ…¢æ€§è¿›åº¦åç¦»æ˜¯å£«æ°”æ€æ‰‹ã€‚</p></li><li><p>çŠ¶æ€çš„è·å–æ˜¯å›°éš¾çš„ï¼Œå› ä¸ºä¸‹å±ç»ç†æœ‰å……åˆ†çš„ç†ç”±ä¸æä¾›ä¿¡æ¯å…±äº«</p></li><li><p>è€æ¿çš„ä¸è‰¯ååº”è‚¯å®šä¼šå¯¹ä¿¡æ¯çš„å®Œå…¨å…¬å¼€é€ æˆå‹åˆ¶ï¼›ç›¸åï¼Œä»”ç»†åŒºåˆ†çŠ¶æ€æŠ¥å‘Šï¼Œæ¯«æ— æƒŠæ…Œåœ°æ¥æ”¶æŠ¥å‘Šï¼Œå†³ä¸è¶Šä¿ä»£åº–ï¼Œå°†èƒ½å¤Ÿé¼“åŠ±è¯šå®çš„æ±‡æŠ¥ã€‚</p></li><li><p>å¿…é¡»æœ‰è¯„å®¡æœºåˆ¶ï¼Œä½¿å¾—æ‰€æœ‰æˆå‘˜å¯ä»¥é€šè¿‡å®ƒäº†è§£çœŸæ­£çš„çŠ¶æ€ã€‚å‡ºäºè¿™ä¸ªç›®çš„ï¼Œé‡Œç¨‹ç¢‘çš„è¿›åº¦å’Œå®Œæˆæ–‡æ¡£æ˜¯å…³é”®ã€‚</p></li><li><p>ç¨‹åºä¿®æ”¹äººå‘˜æ‰€ä½¿ç”¨çš„æ–‡æ¡£ä¸­ï¼Œé™¤äº†æè¿°äº‹æƒ…å¦‚ä½•ï¼Œè¿˜åº”å½“é˜è¿°å®ƒä¸ºä»€ä¹ˆé‚£æ ·ã€‚å¯¹äºåŠ æ·±ç†è§£ï¼Œç›®çš„æ˜¯éå¸¸å…³é”®çš„ï¼Œå³ä½¿æ˜¯é«˜çº§è¯­è¨€çš„è¯­æ³•ï¼Œä¹Ÿä¸èƒ½è¡¨è¾¾ç›®çš„</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;è½¯ä»¶æ´»åŠ¨çš„æ ¹æœ¬ä»»åŠ¡&lt;ul&gt;
&lt;li&gt;æ‰“é€ æ„æˆæŠ½è±¡è½¯ä»¶å®ä½“çš„å¤æ‚æ¦‚å¿µç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è½¯ä»¶æ´»åŠ¨çš„æ¬¡è¦ä»»åŠ¡1&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ¥è¡¨è¾¾è¿™äº›æŠ½è±¡å®ä½“ï¼Œåœ¨ç©ºé—´å’Œæ—¶é—´çš„é™åˆ¶ä¸‹å°†ä»–ä»¬æ˜ å°„æˆæœºå™¨è¯­è¨€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;
      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
      <category term="äººæœˆç¥è¯" scheme="https://www.llchen60.com/tags/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/"/>
    
      <category term="Project Management" scheme="https://www.llchen60.com/tags/Project-Management/"/>
    
  </entry>
  
  <entry>
    <title>Real time dataâ€™s unifying abstraction</title>
    <link href="https://www.llchen60.com/Real-time-data%E2%80%99s-unifying-abstraction/"/>
    <id>https://www.llchen60.com/Real-time-data%E2%80%99s-unifying-abstraction/</id>
    <published>2022-01-29T02:14:20.000Z</published>
    <updated>2022-01-29T02:20:03.851Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Real-time-dataâ€™s-unifying-abstraction"><a href="#Real-time-dataâ€™s-unifying-abstraction" class="headerlink" title="Real time dataâ€™s unifying abstraction"></a>Real time dataâ€™s unifying abstraction</h1><h1 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h1><ul><li>Logs play a key role in distributed data systems and real time application architectures.<ul><li>write ahead log</li><li>commit log</li><li>transaction logs</li></ul></li></ul><h1 id="2-What-is-a-log"><a href="#2-What-is-a-log" class="headerlink" title="2. What is a log?"></a>2. What is a log?</h1><h2 id="2-1-Some-Concepts"><a href="#2-1-Some-Concepts" class="headerlink" title="2.1 Some Concepts"></a>2.1 Some Concepts</h2><ul><li>Storage abstraction<ul><li>append only</li><li>totally ordered sequence of records ordered by time</li></ul></li><li>Records<ul><li>appended to the end of the log</li><li>read from left to right</li><li>each entry has a unique sequential log entry number</li></ul></li><li>Log<ul><li>record what happened and when</li><li>for distributed system, thatâ€™s the very heart of the problem</li><li>types<ul><li>text logs<ul><li>meant primarily for humans to read</li></ul></li><li>journal/ data logs<ul><li>built for programmatic access</li></ul></li></ul></li></ul></li></ul><h2 id="2-2-Log-in-different-scenario"><a href="#2-2-Log-in-different-scenario" class="headerlink" title="2.2 Log in different scenario"></a>2.2 Log in different scenario</h2><h3 id="2-2-1-Logs-in-DB"><a href="#2-2-1-Logs-in-DB" class="headerlink" title="2.2.1 Logs in DB"></a>2.2.1 Logs in DB</h3><ul><li>Function 1: Authoritative source for restoring data<ul><li>DB need to keep in sync the variety of data structures and indexes in the presense of crashes</li><li>To make this atomic and durable, a db uses a log to <strong>write out information about the records</strong> they will be modifying, <strong>before applying the changes</strong> to all the various data structures it maintains</li><li>Since the log is <strong>immediately persisted</strong> it is used as the <strong>authoritative source</strong> in restoring all other persistent structures in the event of a crash.</li></ul></li><li>Function 2: Replicating data between DBs<ul><li>Oracle, MySQL and Postgres SQL include <strong>log shipping protocols</strong> to <strong>transmit portions of log to replica databases</strong> which act as slaves</li></ul></li></ul><h3 id="2-2-2-Logs-in-distributed-systems"><a href="#2-2-2-Logs-in-distributed-systems" class="headerlink" title="2.2.2 Logs in distributed systems"></a>2.2.2 Logs in distributed systems</h3><ul><li>Log Centric Approach</li></ul><aside>ğŸ’¡ State Machine Replication Principle: If two identical, deterministic processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.</aside><ul><li>we could reduce the problem of making multiple machines all do the same thing to the problem of <strong>implementing a distributed consistent log to feed these processes input</strong><ul><li>squeeze all the non-determinism out of the input stream to ensure that each replica processing this input stays in sync.</li><li>time stamps that index the log now act as <strong>the clock for the state of the replicas</strong>â€”you can describe each replica by a single number, the timestamp for the maximum log entry it has processed.</li></ul></li></ul><h1 id="3-Log-Types"><a href="#3-Log-Types" class="headerlink" title="3. Log Types"></a>3. Log Types</h1><ul><li>What we could put in log<ul><li>log the incoming requests to a service</li><li>the state changes the service undergoes in response to request</li><li>the transformation commands it executes.</li></ul></li><li>For DB usage<ul><li>physical logging<ul><li>log the contents of each row that is changed</li></ul></li><li>logical logging<ul><li>log not the changed rows but the SQL commands that lead to the row chagnes</li></ul></li></ul></li><li>For Distributed Systems to process and replicate<ul><li>Primary Backup<ul><li>elect one replica as the leader</li><li>allow this leader to process requests in the order they arrive</li><li>log out the changes to its state from processing the requests.</li><li>The other replicas apply in order the state changes the leader makes so that they will be in sync and ready to take over as leader should the leader fail.</li><li><strong>backup will copy the result from the primary, no logical action to walk through all action primary did</strong></li></ul></li></ul></li></ul><pre><code>- State Machine Replication    - active-active model where we keep a log of the incoming requests and each replica processes each request    - **each machine will do real execution, do the logical stuff**    ![State Machine Replication](https://s2.loli.net/2022/01/29/6JtLFNpmXBYW9wO.png)</code></pre><aside>ğŸ’¡ Below 3 sections has a centric idea:  Log as a stand-alone service. The usefulness of the log comes from simple function that the log provides: **producing a persistent, re-playable record of history**. At the core of these problems is the ability to **have many machines playback history at their own rate in a deterministic manner**</aside><h1 id="4-Changelog-in-Database"><a href="#4-Changelog-in-Database" class="headerlink" title="4. Changelog in Database"></a>4. Changelog in Database</h1><ul><li>duality between a log of changes and a table<ul><li>The log is similar to the list of all credits and debits and bank processes;</li><li>a table is all the current account balances.</li><li>If you have a log of changes, you can apply these changes in order to create the table capturing the current state.</li></ul></li><li>if you have a table taking updates, you can record these changes and publish a â€œchangelogâ€ of all the updates to the state of the table. This changelog is exactly what you need to <strong>support near-real-time replicas</strong>.</li><li>Table support data at rest and logs capture changes</li></ul><aside>ğŸ’¡ The magic of the log is that if itâ€™s complete log of changes, it holds not only the contents of the final version of the table, but also allows recreating all other versions that might have existed. Thatâ€™s a backup of every previous state of the table</aside><h1 id="5-Data-Integration"><a href="#5-Data-Integration" class="headerlink" title="5. Data Integration"></a>5. Data Integration</h1><blockquote><p>Make all of an organizationâ€™s data easily available in all its storage and processing systems</p></blockquote><h2 id="5-1-Expected-workflow-for-data-integration"><a href="#5-1-Expected-workflow-for-data-integration" class="headerlink" title="5.1 Expected workflow for data integration"></a>5.1 Expected workflow for data integration</h2><ul><li>Definition in authorâ€™s scope: Making all the data an organization has available in all its services and systems.</li><li>Effective Use of Data<ul><li>Capture all relevant data</li><li>Put it together in an applicable processing env<ul><li>real time query system</li><li>text files</li><li>python scripts, etc.</li></ul></li><li>Infra to process data<ul><li>mapReduce</li><li>Real time query systems</li></ul></li><li>Good data models and consistent well understood semantics</li><li>Sophisticated processing<ul><li>visualization</li><li>reporting</li><li>algorithmic processing and prediction</li></ul></li></ul></li></ul><h2 id="5-2-Problem1-The-event-data-firehose"><a href="#5-2-Problem1-The-event-data-firehose" class="headerlink" title="5.2 Problem1: The event data firehose"></a>5.2 Problem1: The event data firehose</h2><ul><li>Event data rising</li><li>googleâ€™s fortune is actually generated by a relevance pipeline built on clicks and impressions â€” events</li><li>that would be huge amount of data,</li></ul><h2 id="5-3-Problem-2-The-explosion-of-specialized-data-systems"><a href="#5-3-Problem-2-The-explosion-of-specialized-data-systems" class="headerlink" title="5.3 Problem 2: The explosion of specialized data systems"></a>5.3 Problem 2: The explosion of specialized data systems</h2><ul><li>Explosion of specialized data systems</li><li>The combination of more data of more varieties and a desire to get this data into more systems leads to a huge data integration problem.</li></ul><h2 id="5-4-Log-Structured-Data-Flow"><a href="#5-4-Log-Structured-Data-Flow" class="headerlink" title="5.4 Log Structured Data Flow"></a>5.4 Log Structured Data Flow</h2><h3 id="5-4-1-How-the-flow-work"><a href="#5-4-1-How-the-flow-work" class="headerlink" title="5.4.1 How the flow work"></a>5.4.1 How the flow work</h3><ul><li>Recipe: Take all the organizationâ€™s data and put it into a central log for <strong>real time subscription</strong></li><li>How the flow works<ul><li>Each logical data source can be modeled as its own log</li><li>A data source could be an application that logs out events, or a db table that accepts modifications</li><li>each subscribing system reads from this log <strong>as quickly as it can</strong>, <strong>applied each new record to its own store</strong>, and <strong>advances its position</strong> in the log</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/29/ykIEs4XwnBD3LUF.png" alt="How the flow work"></p><ul><li><p>Log gives a <strong>logical clock</strong> for each change against which all subscriber can be measured</p><ul><li>Consider a case where there is a database and a collection of caching servers</li><li>log provides a way to synchronize the updates to all these systems and reason about the point of time of each of these systems</li><li>Letâ€™s say we <strong>write a record with log entry X</strong> and then need to do a read from the cache. If we want to guarantee we donâ€™t see stale data, we just need to ensure we <strong>donâ€™t read from any cache which has not replicated up to X.</strong></li></ul></li><li><p>Log also acts as a <strong>buffer</strong> that makes <strong>data production asynchronous from data consumption</strong></p><ul><li>satisfy different requirements like<ul><li>A batch system such as Hadoop or a data warehouse may consume only hourly or daily,</li><li>A real-time query system may need to be up-to-the-second.</li></ul></li></ul></li><li><p>Consumer only need to know about the log and not any details of the system of origin</p></li><li><p>What values most from author perspective</p><ul><li>The pipeline they built for process data, though a bit of a mess, were actually extremely valuable . Just the process of makeing data available in a new processing system (Hadoop) unblocked a lot of possibilities<ul><li>Many new products and analysis just came from putting together multiple pieces of data that had previously been locked up in specialized systems</li></ul></li></ul></li><li><p>LinkedIn Went Through from O(N^2) to O(2N)</p></li></ul><p><img src="https://s2.loli.net/2022/01/29/fXnmrpYFLSVGoR9.png" alt="Pre Architecture LinkedIn"><br><img src="https://s2.loli.net/2022/01/29/9dZa67tYEl1yc8e.png" alt="Cur Architecture LinkedIn"></p><ul><li>Actions for the migration<ul><li>Isolate each consumer from the source of the data</li><li>Create a new data system to be both a data source and a data destination</li><li>Here LinkedIn create Kafka</li><li>Kinesis is similar to Kafka as AWS use it to connects all different distributed systems as a piping</li></ul></li></ul><h3 id="5-4-2-Relationship-to-ETL-and-the-Data-Warehouse"><a href="#5-4-2-Relationship-to-ETL-and-the-Data-Warehouse" class="headerlink" title="5.4.2  Relationship to ETL and the Data Warehouse"></a>5.4.2  Relationship to ETL and the Data Warehouse</h3><ul><li><p>Data Warehouse</p><ul><li>target<ul><li>A repository of the clean, integrated data structured to support analysis</li></ul></li><li>what be involved<ul><li>periodically extracting data from source databases</li><li>munging it into some kind of understandable form</li><li>loading it into a central data warehouse</li></ul></li><li>Problems<ul><li>coupling the clean integrated data to the data warehouse.<ul><li>cannot get real time feed</li></ul></li><li>organization perspective<ul><li>The incentives are not aligned: data producers are often not very aware of the use of the data in the data warehouse and end up creating data that is hard to extract or requires heavy, hard to scale transformation to get into usable form.</li><li>the central team never quite manages to scale to match the pace of the rest of the organization, so data coverage is always spotty, data flow is fragile, and changes are slow.</li></ul></li></ul></li></ul></li><li><p>ETL</p><ul><li>tasks<ul><li>extraction and data cleanup process, liberating data locked up in a variety of systems in the organization and removing an system-specific non-sense</li><li>data is restructured for data warehousing queries (i.e. made to fit the type system of a relational DB, forced into a star or snowflake schema, perhaps broken up into a high performance <a href="http://parquet.io/">column</a> <a href="http://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.0.0.2/ds_Hive/orcfile.html">format</a>,</li></ul></li><li>problems<ul><li>still, we need such data in real time as well for low latency processing as well as indexing in real time storage systems</li></ul></li></ul></li><li><p>A better approach as ETL and Data Warehouse substitution</p><ul><li><p>Have a central pipeline, the log, with a well defined API for adding data</p></li><li><p>Responsibility Classification</p><ul><li><p>Producer of the data feed: integrating with this pipeline and providing a clean, well-structured data feed</p></li><li><p>Datawarehouse team now <strong>only care about loading structured feeds</strong> of data from the <strong>central log</strong> and <strong>carrying out transformation specific to their system</strong></p><p>  <img src="https://s2.loli.net/2022/01/29/fMl9IQwDGk8TL4o.png" alt="Workflow and ownership classification">            </p></li></ul></li></ul></li></ul><h3 id="5-4-3-Log-Files-and-Events"><a href="#5-4-3-Log-Files-and-Events" class="headerlink" title="5.4.3 Log Files and Events"></a>5.4.3 Log Files and Events</h3><ul><li>Current structure also enables decoupled and event driven systems</li></ul><h3 id="5-4-4-How-to-build-scalable-logs"><a href="#5-4-4-How-to-build-scalable-logs" class="headerlink" title="5.4.4 How to build scalable logs"></a>5.4.4 How to build scalable logs</h3><ul><li>Need a log system thatâ€™s fast, cheap, scalable enough to make this practical at scale</li><li>LinkedIn in 2013 actually has already support 60 billion unique message writes through Kafka per day</li><li>Kafka achieve such high throughput via<ul><li>Partitioning the log<ul><li>each partition is a <strong>totally ordered log</strong>, but there is <strong>no global ordering between partitions</strong></li><li>Assignment of the messages to a particular partition is controllable by the writer, with most users choosing to partition by some kind of key</li><li>Replication<ul><li>Each partition is replicated across a configurable number of replicas</li><li>At any time, a single one of them will act as the leader, if the leader fails, one of the replicas will take over as leader</li></ul></li><li>Order Guarantee<ul><li>each partition is order preserving, and Kafka guarantees that appends to a particular partition from a single sender will be delivered in the order they are sent.</li></ul></li></ul></li><li>Optimizing throughput by batching reads and writes<ul><li>occurs when<ul><li>sending data</li><li>writes to disk</li><li>replication between servers</li><li>data transfer to consumers</li><li>acknowledging committed data</li></ul></li></ul></li><li>Avoiding needless data copies<ul><li>Use a simple binary format that is maintained between in memory log, on disk log and in network data transfers</li><li>Thus we could make use of numerous optimizations including zero copy data transfer <a href="https://en.wikipedia.org/wiki/Zero-copy">https://en.wikipedia.org/wiki/Zero-copy</a></li></ul></li></ul></li></ul><h1 id="6-Real-Time-Data-Processing"><a href="#6-Real-Time-Data-Processing" class="headerlink" title="6. Real Time Data Processing"></a>6. Real Time Data Processing</h1><blockquote><p>Computing derived data streams</p></blockquote><h2 id="6-1-Definition-of-Stream-Processing"><a href="#6-1-Definition-of-Stream-Processing" class="headerlink" title="6.1 Definition of Stream Processing"></a>6.1 Definition of Stream Processing</h2><ul><li>Infrastructure for continuous data processing<ul><li>computational model can be general like MapReduce or other distributed processing frameworks,</li><li>need the ability to produce low latency results</li></ul></li><li>Instead of batch get and process, we could do continuous changes</li><li>it is just processing which includes a notion of time in the underlying data being processed and does not require a static snapshot of the data so it can produce output at a user-controlled frequency instead of waiting for the â€œendâ€ of the data set to be reached. In this sense, stream processing is a generalization of batch processing, and, given the prevalence of real-time data, a very important generalization</li><li>Log role<ul><li>making data available in real-time multi-subscriber data feeds.</li></ul></li></ul><h2 id="6-2-Stateful-Real-Time-Processing"><a href="#6-2-Stateful-Real-Time-Processing" class="headerlink" title="6.2 Stateful Real Time Processing"></a>6.2 Stateful Real Time Processing</h2><ul><li>Stateful real time processing means some more sophisticated operations, like counts, aggregations, or joins over windows in the stream</li><li>We need to maintain certain state in such case</li><li>Strategies for that<ul><li>Keep state in memory<ul><li>cons<ul><li>if the process crash, it would lose its intermediate state</li><li>if the state is only maintained over a window, the process could fall back to the point where the window began</li></ul></li></ul></li><li>Store all state in a remote storage system, and join over the network to that store<ul><li>cons<ul><li>no locality of data and lots of network round trips</li></ul></li></ul></li><li>Duality of tables and logs<ul><li>a stream processor can keep its state in a local table or index â€” a bdb, leveldb</li><li>the contents of this store is fed from its input streams</li><li>it could journal out a changelog for this local index it keeps to allow it to restore its state in the event of a crash and restart</li><li>This mechanism allows a generic mechanism for keeping co-partitioned state in arbitrary index types local with the incoming stream data.</li><li>when facing process fails<ul><li>recover its index from the changelog</li><li>changelog itself is the transformation of the local state into a sort of incremental record at a time backup</li></ul></li></ul></li></ul></li></ul><h2 id="6-3-Log-Compaction"><a href="#6-3-Log-Compaction" class="headerlink" title="6.3 Log Compaction"></a>6.3 Log Compaction</h2><ul><li>Log need to be cleaned up someway to save the space</li><li>In Kafka, clean up has two options depending on whether the data contains keyed updates or event data<ul><li>for event data, supports just retain a window of data<ul><li>configured to be few days</li><li>also could be configured as space</li></ul></li><li>for keyed data<ul><li>as the complete log give you ability to replay it to recreate the state of the source system</li><li>but we could do log compaction by removing obsolete records â€” records whose primary key has a more recent update</li></ul></li></ul></li></ul><h1 id="7-Distributed-System-Design"><a href="#7-Distributed-System-Design" class="headerlink" title="7. Distributed System Design"></a>7. Distributed System Design</h1><blockquote><p>How practical systems can be simplified with a log centric design</p></blockquote><h2 id="7-1-Distributed-system-design-thought"><a href="#7-1-Distributed-system-design-thought" class="headerlink" title="7.1 Distributed system design thought"></a>7.1 Distributed system design thought</h2><p>Log here is responsible for data flow, consistency and recovery </p><ul><li><p>Directions</p><ul><li>Coalescing lots of little instances of each system into a few big clusters</li></ul></li><li><p>Possibility 1</p><ul><li>separation of systems remains more or less as it is for a good deal longer.</li><li>an external log that integrates data will be very important.</li></ul></li><li><p>Possibility 2</p><ul><li>re-consolidation in which a single system with enough generality starts to merge back in all the different functions into a single uber-system.</li><li>extremely hard</li></ul></li><li><p>Possibility 3</p><ul><li>data infrastructure could be unbundled into a collection of services and application-facing system apis</li><li>use open source, like in Java stacks<ul><li>zookeeper<ul><li>handle system coordination</li></ul></li><li>mesos and yarn<ul><li>process virtualization</li><li>resource management</li></ul></li><li>netty, jetty<ul><li>handle remote communication</li></ul></li><li>protobuf<ul><li>handle serialization</li></ul></li><li>kafka and bookeeper<ul><li>provide a backing log</li></ul></li></ul></li><li>path towards getting the simplicity of the single system in a more diverse and modular world that continues to evolve. If the implementation time for a distributed system goes from years to weeks because reliable, flexible building blocks emerge, then the pressure to coalesce into a single monolithic system disappears.</li></ul></li></ul><h2 id="7-2-Usage-of-log-in-system-architecture"><a href="#7-2-Usage-of-log-in-system-architecture" class="headerlink" title="7.2 Usage of log in system architecture"></a>7.2 Usage of log in system architecture</h2><ul><li><p>Usage of log in system architecture</p><ul><li>Handle data consistency (whether eventual or immediate) by sequencing concurrent updates to nodes</li><li>Provide data replication between nodes</li><li>Provide â€œcommitâ€ semantics to the writer (i.e. acknowledging only when your write guaranteed not to be lost)</li><li>Provide the external data subscription feed from the system</li><li>Provide the capability to restore failed replicas that lost their data or bootstrap new replicas</li><li>Handle rebalancing of data between nodes.</li></ul></li><li><p>What mentioned above is actually a large portion of what a distributed data system does. left over is mainly related with client facing query API and indexing strategy</p></li><li><p>System Look</p><ul><li>System is divided into two logical pieces<ul><li>log<ul><li>capture the state changes in sequential order</li></ul></li><li>serving layer<ul><li>store whatever index is required to serve queries</li></ul></li></ul></li><li>writes could go directly to the log or may be proxied by the serving layer</li><li>writes to the log yields a logical timestamp, if the system is partitioned, then the log and serving nodes will have the same number of partitions, though they may have very different numbers of machines</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/29/EXfRmnKxbGs8kHT.png" alt="Log and serving layer">    </p><ul><li><p>The client can get <strong>read-your-write semantics</strong> from any node by providing the <strong>timestamp of a write</strong> as part of its queryâ€”a serving node receiving such a query will <strong>compare the desired timestamp</strong> to <strong>its own index point</strong> and if necessary delay the request until it has indexed up to at least that time to avoid serving stale data.</p></li><li><p>For handling restoring failed nodes or moving partitions from node to node</p><ul><li>have the log retain only a fixed window of data and combine this with a snapshot of the data stored in the partition</li><li>itâ€™s possible for the log to retain a complete copy of data and garbage collect the log itself</li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying</a> </li><li><a href="https://kafka.apache.org/documentation.html#design">https://kafka.apache.org/documentation.html#design</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Real-time-dataâ€™s-unifying-abstraction&quot;&gt;&lt;a href=&quot;#Real-time-dataâ€™s-unifying-abstraction&quot; class=&quot;headerlink&quot; title=&quot;Real time dataâ€™s u
      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
      <category term="log" scheme="https://www.llchen60.com/tags/log/"/>
    
      <category term="distributed system" scheme="https://www.llchen60.com/tags/distributed-system/"/>
    
  </entry>
  
  <entry>
    <title>Flyway</title>
    <link href="https://www.llchen60.com/Flyway/"/>
    <id>https://www.llchen60.com/Flyway/</id>
    <published>2022-01-01T13:57:09.000Z</published>
    <updated>2022-01-01T13:57:52.879Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h1><ul><li>An open source database migration tool</li><li>Favors simplicity and convention over configuration</li><li>has 7 basic commands<ul><li>migrate</li><li>clean</li><li>info</li><li>validate</li><li>undo</li><li>baseline</li><li>repair</li></ul></li></ul><h2 id="1-1-Why-DB-migrations"><a href="#1-1-Why-DB-migrations" class="headerlink" title="1.1 Why DB migrations?"></a>1.1 Why DB migrations?</h2><ul><li>we need a way to version the table</li><li>we need to know what state is the db on this machine</li><li>database migration help us<ul><li>recreate a database from scratch</li><li>make it clear at all times what state a database is in</li><li>migrate in a deterministic way from your current version of the database to a newer one</li></ul></li></ul><h2 id="1-2-How-Flyway-works"><a href="#1-2-How-Flyway-works" class="headerlink" title="1.2 How Flyway works?"></a>1.2 How Flyway works?</h2><ul><li><p>Flyway first try to locate its schema history table</p><ul><li>if db empty, then flyway will create it instead</li><li>this default db named as <code>flyway_schema_history</code></li></ul></li><li><p>Then flyway will begin scanning the filesystem or the classpath of the application for migrations</p></li><li><p>The migrations are then sorted based on the version number and applied in order</p></li><li><p>The schema history table will be updated accordingly as each migration gets applied</p></li><li><p>we use <code>flyway migrate</code> to execute the migration</p></li></ul><h1 id="2-Flyway-Commands"><a href="#2-Flyway-Commands" class="headerlink" title="2. Flyway Commands"></a>2. Flyway Commands</h1><h2 id="2-1-migrate"><a href="#2-1-migrate" class="headerlink" title="2.1 migrate"></a>2.1 <code>migrate</code></h2><ul><li>help migrate the db</li></ul><h2 id="2-2-clean"><a href="#2-2-clean" class="headerlink" title="2.2 clean"></a>2.2 <code>clean</code></h2><ul><li>drop all objects in the confgured schemas</li></ul><h2 id="2-3-info"><a href="#2-3-info" class="headerlink" title="2.3 info"></a>2.3 <code>info</code></h2><ul><li>print the details and status information about all migrations</li></ul><h2 id="2-4-validate"><a href="#2-4-validate" class="headerlink" title="2.4 validate"></a>2.4 <code>validate</code></h2><ul><li>validates the applied migrations against the ones available on the classpath</li></ul><h2 id="2-5-undo"><a href="#2-5-undo" class="headerlink" title="2.5 undo"></a>2.5 <code>undo</code></h2><ul><li>undoes the most recently applied versioned migration</li></ul><h2 id="2-6-baseline"><a href="#2-6-baseline" class="headerlink" title="2.6 baseline"></a>2.6 <code>baseline</code></h2><ul><li>baselines an existing database, excluding all migrations up and including baseline version</li></ul><h2 id="2-7-repair"><a href="#2-7-repair" class="headerlink" title="2.7 repair"></a>2.7 <code>repair</code></h2><ul><li>repair the schema history table</li></ul><h1 id="3-Concepts"><a href="#3-Concepts" class="headerlink" title="3. Concepts"></a>3. Concepts</h1><h2 id="3-1-Migrations"><a href="#3-1-Migrations" class="headerlink" title="3.1 Migrations"></a>3.1 Migrations</h2><ul><li>all changes to the db are called migrations</li><li>migrations can be<ul><li>versioned<ul><li>types<ul><li>regular</li><li>undo<ul><li>the effect can be undone by supplying an undo migration</li></ul></li></ul></li><li>contains<ul><li><strong>version</strong><ul><li>must be unique</li></ul></li><li><strong>description</strong><ul><li>purely informative for you to be able to remember what each migration does</li></ul></li><li><strong>checksum</strong><ul><li>detect accidental changes</li></ul></li></ul></li></ul></li><li>repeatable<ul><li>contains<ul><li><strong>description</strong></li><li><strong>checksum</strong></li></ul></li><li>instead of being run just once, they are re-applied every time their checksum changes</li><li>Within a single migration run, repeatable migrations are always <strong>applied last</strong>, after all pending versioned migrations have been executed. Repeatable migrations are applied in the order of their description</li></ul></li></ul></li></ul><h3 id="3-1-1-Versioned-Migrations"><a href="#3-1-1-Versioned-Migrations" class="headerlink" title="3.1.1 Versioned Migrations"></a>3.1.1 Versioned Migrations</h3><ul><li>contains<ul><li>version<ul><li><strong>must be unique</strong></li><li>applied in order exactly once</li></ul></li><li>description<ul><li>purely informative for you to be able to remember what each migration does</li></ul></li><li>checksum<ul><li>detect accidental changes</li></ul></li></ul></li><li>used for<ul><li>creating/ altering/ dropping tables/ indexes/ foreign keys/ enums</li><li>reference data updates</li><li>user data corrections</li></ul></li></ul><h3 id="3-1-2-Undo-Migrations"><a href="#3-1-2-Undo-Migrations" class="headerlink" title="3.1.2 Undo Migrations"></a>3.1.2 Undo Migrations</h3><ul><li>A migration can fail at any point. If you have 10 statements, it is possible for the 1st, the 5th, the 7th or the 10th to fail. There is simply no way to know in advance. In contrast, undo migrations are written to undo an entire versioned migration and will not help under such conditions.</li><li>we should <strong>maintain backwards compatibility</strong> between the <strong>DB and all versions of the code</strong> currently deployed in production</li></ul><h3 id="3-1-3-Repeatable-Migrations"><a href="#3-1-3-Repeatable-Migrations" class="headerlink" title="3.1.3 Repeatable Migrations"></a>3.1.3 Repeatable Migrations</h3><ul><li><p>contains</p><ul><li>description and a checksum, but no version</li></ul></li><li><p>repeatable migrations are re-applied every time their checksum changes</p></li><li><p>Very useful for managing database objects whose definition can then simply be maintained in a single file in version control</p></li><li><p>Repeatable migrations are always applied last, after all pending versioned migrations have been executed; always applied in the order of their description</p></li></ul><h3 id="3-1-4-SQL-Based-Migrations"><a href="#3-1-4-SQL-Based-Migrations" class="headerlink" title="3.1.4 SQL Based Migrations"></a>3.1.4 SQL Based Migrations</h3><ul><li>used for<ul><li>DDL change â€” CREATE/ALTER/DROP statements for TABLES,VIEWS,TRIGGERS,SEQUENCES,â€¦</li><li>Simple reference data changes</li><li>simple bulk data changes</li></ul></li><li>Naming  Patterns<ul><li>Prefix<ul><li>v for versioned</li><li>u for undo</li><li>r for repeatable migrations</li></ul></li><li>version<ul><li>with dots or underscores separate as many parts as you like</li></ul></li><li>Separator<ul><li>__ two underscores</li></ul></li><li>Suffix<ul><li><code>.sql</code></li></ul></li></ul></li><li>Discovery<ul><li>Flyway discover sql migrations from directories <strong>referenced by the location property</strong></li></ul></li></ul><h3 id="3-1-5-Script-Based-Migrations"><a href="#3-1-5-Script-Based-Migrations" class="headerlink" title="3.1.5 Script Based Migrations"></a>3.1.5 Script Based Migrations</h3><ul><li>name patten<ul><li>``V1__execute_batch_tool.sh`</li></ul></li><li>could be used for<ul><li>triggering execution of a 3rd party application as part of the migrations</li><li>cleaning up local files</li></ul></li></ul><h3 id="3-1-6-Transactions"><a href="#3-1-6-Transactions" class="headerlink" title="3.1.6 Transactions"></a>3.1.6 Transactions</h3><ul><li>By default, Flyway <strong>wraps the execution of an entire migration within a single transaction</strong></li></ul><h2 id="3-2-Callbacks"><a href="#3-2-Callbacks" class="headerlink" title="3.2 Callbacks"></a>3.2 Callbacks</h2><ul><li><p>For the case we need to execute same action over and over again</p></li><li><p>we could hook into its lifecycle</p></li><li><p>there are certain keywords we could use, and invoke them during the process</p></li></ul><p><a href="https://flywaydb.org/documentation/concepts/callbacks">https://flywaydb.org/documentation/concepts/callbacks</a> </p><h2 id="3-3-Error-Overrides"><a href="#3-3-Error-Overrides" class="headerlink" title="3.3 Error Overrides"></a>3.3 Error Overrides</h2><ul><li>By default, in case an error is returned, flyway displays it with all necessary details, marks the migration as failed and automatically rolls it back if possible</li><li>But we could change the behavior like<ul><li>treat an error as a waring</li><li>treat a waring as an error</li><li>perform an additional action</li></ul></li></ul><h2 id="3-4-Dry-Runs"><a href="#3-4-Dry-Runs" class="headerlink" title="3.4 Dry Runs"></a>3.4 Dry Runs</h2><ul><li>Used for<ul><li>preview changes Flyway will make to the db</li><li>submit the SQL statements for review</li><li>use Flyway to determine what needs updating,</li></ul></li><li>how it works<ul><li>flyway sets up a read only connection to the db,</li><li>assesses what migrations need to run and generates a single SQL file containing all statements it would have executed in case of a regular migration run</li></ul></li></ul><h2 id="3-5-Baseline-Migrations"><a href="#3-5-Baseline-Migrations" class="headerlink" title="3.5 Baseline Migrations"></a>3.5 Baseline Migrations</h2><ul><li><p>Over the lifetime of a project, there would be tons of db objects be created/ destroyed across many migrations</p><ul><li>we want to simplify with a single, cumulative migration that represents the state of db after all of those migrations have been applied without disrupting existing env</li></ul></li><li><p>How it works?</p><ul><li>Prefixed with B followed by the version of your db they represent</li><li>Only used when deploying to new env</li><li>If used in an env where some Flyway migrations have already been applied, <strong>baseline migrations will be ignored,</strong> <strong>new env will choose the latest baseline migration as the starting point</strong><ul><li>every migration with a version below the latest baseline migrationâ€™s version is marked as ignored</li></ul></li><li>baseline migration are executed during the migrate process</li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://flywaydb.org/documentation/">https://flywaydb.org/documentation/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Overview&quot;&gt;&lt;a href=&quot;#1-Overview&quot; class=&quot;headerlink&quot; title=&quot;1. Overview&quot;&gt;&lt;/a&gt;1. Overview&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;An open source database migrat
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="database" scheme="https://www.llchen60.com/tags/database/"/>
    
      <category term="migration" scheme="https://www.llchen60.com/tags/migration/"/>
    
  </entry>
  
  <entry>
    <title>Protobuf Rampup</title>
    <link href="https://www.llchen60.com/Protobuf-Rampup/"/>
    <id>https://www.llchen60.com/Protobuf-Rampup/</id>
    <published>2021-12-25T02:09:49.000Z</published>
    <updated>2021-12-25T02:11:09.003Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Protobuf-Learning"><a href="#Protobuf-Learning" class="headerlink" title="Protobuf Learning"></a>Protobuf Learning</h1><h1 id="1-What-are-Protocol-Buffers"><a href="#1-What-are-Protocol-Buffers" class="headerlink" title="1. What are Protocol Buffers?"></a>1. What are Protocol Buffers?</h1><ul><li>Googleâ€™s language-neutral, platform-neutral, extensible mechanism for serializing structured data â€“ think XML, but smaller, faster, and simpler.</li><li>You <strong>define how you want your data to be structured</strong> once, then you <strong>use special generated source code to easily write and read your structured data</strong></li></ul><h1 id="2-Why-use-Protocol-Buffers"><a href="#2-Why-use-Protocol-Buffers" class="headerlink" title="2. Why use Protocol Buffers?"></a>2. Why use Protocol Buffers?</h1><ul><li>XML is human readable and wide language supports<ul><li>but is notoriously space intensive</li><li>encoding/ decoding can impose a huge performance penalty on applications</li></ul></li><li>With protocol buffers<ul><li>write a <code>.proto</code> description of the data structure</li><li>the <strong>protocol buffer compiler</strong> then <strong>creates a class</strong> that implements <strong>automatic encoding and parsing</strong> of the protocol buffer data with an <strong>efficient binary format</strong></li><li>the generated class <strong>provides getters and setters</strong> for the fields</li><li>take care of the details of reading and writing the protocol buffer <strong>as a unit</strong></li></ul></li></ul><h1 id="3-Java-Tutorial-In-Proto2"><a href="#3-Java-Tutorial-In-Proto2" class="headerlink" title="3. Java Tutorial (In Proto2)"></a>3. Java Tutorial (In Proto2)</h1><h2 id="3-1-Define-Protocol-Format"><a href="#3-1-Define-Protocol-Format" class="headerlink" title="3.1 Define Protocol Format"></a>3.1 Define Protocol Format</h2><pre><code class="protobuf">syntax = &quot;proto2&quot;;// starts with package delcaration // we should define this to get rid of name conflict package tutorial;// enable generating a separate .java file for each generated class option java_multiple_files = true;// specify in what java package name your generated classes should live// if not set here, it will simply match the pkg name given by the package declaration option java_package = &quot;com.example.tutorial.protos&quot;;// define the class name of the wrapper class which will represent this file // if not given, it will be auto generated by converting the file name to upper camel case option java_outer_classname = &quot;AddressBookProtos&quot;;/**Message Definition: An aggregate containing a set of typed fields Contain certain standard types    + boo1    + int32     + float     + double     + string we could also add further structure to msgs by using other msg types as field types + marker     + identify the unique tag field use in binary encoding     + try to use 1 - 15 as it neeeds one less byte+ modifier     + optional         + field may or may not be set         + if not, a default value will be used             + we could set our own default values             + or system will provide defaults                 + numeric types -- zero                 + strings -- empty string                 + bools -- false                 + embedded messages -- default instance or prototype of the message, which has none of its fields set     + repeated         + the field may be repeated any number of times [0, xxx)         + order will be preserved in the protocol buffer         + act like a dynamic sized array     + required         + a value for the field must be provided        + try to build an uninitialized msg will throw runtime exception         + parse an uninitialzied msg will throw IOException         + required is not favored as it cannot be backward compatible */message Person &#123;    // =1 marker identify the unique tag that field uses in the binary encoding   optional string name = 1;  optional int32 id = 2;  optional string email = 3;  enum PhoneType &#123;    MOBILE = 0;    HOME = 1;    WORK = 2;  &#125;  message PhoneNumber &#123;    optional string number = 1;    optional PhoneType type = 2 [default = HOME];  &#125;  repeated PhoneNumber phones = 4;&#125;message AddressBook &#123;  repeated Person people = 1;&#125;</code></pre><h2 id="3-2-Compiling-Protocol-Buffers"><a href="#3-2-Compiling-Protocol-Buffers" class="headerlink" title="3.2 Compiling Protocol Buffers"></a>3.2 Compiling Protocol Buffers</h2><ul><li>To generate the classes, we need to run the protocol buffer compiler</li><li>specify the source directory, the destination directory and the path to our <code>.proto</code></li></ul><pre><code class="protobuf">protoc -I=$SRC_DIR --java_out=$DST_DIR $SRC_DIR/addressbook.proto </code></pre><h2 id="3-3-Protocol-Buffer-API"><a href="#3-3-Protocol-Buffer-API" class="headerlink" title="3.3 Protocol Buffer API"></a>3.3 Protocol Buffer API</h2><ul><li>compiler helps auto generate source file<ul><li>getters and setters</li><li>each field also has <code>clear</code> method to set the field back to its empty state</li></ul></li><li>Builders vs Messages<ul><li>message classes are immutable</li><li>builder is used when you first construct a builder, then we could call the builderâ€™s build() method</li></ul></li><li>standard message methods<ul><li><code>isInitialized</code> check if all the required fields have been set</li><li><code>toString</code> returns a human readable representation of the msg</li><li><code>mergeFrom(Message other)</code> merge the contents of other into this msg, overwrite singular scalar fields</li><li><code>clear</code> clear all the fields back to the empty state</li></ul></li><li>Parsing and Serialization<ul><li><code>byte[] toByteArray();</code><ul><li>serializes the msg and returns a byte array containing its raw bytes</li></ul></li><li><code>static xxx parseFrom(byte[] data);</code><ul><li>parse a msg from the given byte array</li></ul></li><li><code>void writeTo(OutputStream output);</code><ul><li>serialize the msg and writes to an OutputStream</li></ul></li><li><code>static xxx parseFrom(InputStream input);</code><ul><li>reads and parses a msg from an InputStream</li></ul></li></ul></li></ul><h2 id="3-4-How-to-extend-a-Protocol-Buffer"><a href="#3-4-How-to-extend-a-Protocol-Buffer" class="headerlink" title="3.4 How to extend a Protocol Buffer"></a>3.4 How to extend a Protocol Buffer</h2><ul><li>In the new version of the protocol buffer<ul><li>must not change the tag numbers of any existing fields</li><li>must not add or delete any required fields</li><li>may delete optional or repeated fields</li><li>may add new optional or repeated fields but must use fresh tag numbers</li></ul></li></ul><h1 id="4-Overall-Guide-In-Proto3"><a href="#4-Overall-Guide-In-Proto3" class="headerlink" title="4. Overall Guide (In Proto3)"></a>4. Overall Guide (In Proto3)</h1><h2 id="4-1-Define-message-type"><a href="#4-1-Define-message-type" class="headerlink" title="4.1 Define message type"></a>4.1 Define message type</h2><ul><li>Each field in the msg definition need to have a <strong>unique number</strong><ul><li>those numbers are used to identify fields in the message binary format</li><li>the number should never be changed</li></ul></li><li>specify field rules<ul><li>singular<ul><li>default field rule for proto3 syntax</li><li>can have <strong>zero or one of this field</strong></li></ul></li><li>repeated<ul><li>can be repeated any number of times (including zero)</li></ul></li></ul></li><li>reserved fields<ul><li>if you update a msg type by entirely removing a field or commenting it out, future users can reuse the field number but it would bring severe issues,</li><li>thus we could reserved the number for deleted fields and tag number</li></ul></li></ul><pre><code class="protobuf">message Foo &#123;  reserved 2, 15, 9 to 11;  reserved &quot;foo&quot;, &quot;bar&quot;;&#125;</code></pre><ul><li>Post compiler running<ul><li>Compiler generates a <code>.java</code> file with a class for each message type, as well as Builder classes for creating message class instances</li></ul></li><li>For enum values<ul><li>every enum definition must contain a constant that maps to zero as its first element</li><li>we can allow alias thus we could assign the same value to different enum constants</li></ul></li><li>import<ul><li>we could do import thus we could use definitions from other <code>.proto</code> file</li></ul></li></ul><h2 id="4-2-Scalar-Value-Types"><a href="#4-2-Scalar-Value-Types" class="headerlink" title="4.2 Scalar Value Types"></a>4.2 Scalar Value Types</h2><p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar">Language Guide (proto3) | Protocol Buffers | Google Developers</a></p><h2 id="4-3-Nested-Types"><a href="#4-3-Nested-Types" class="headerlink" title="4.3 Nested Types"></a>4.3 Nested Types</h2><ul><li>we could define and use msg types inside other msg types</li></ul><pre><code class="protobuf">message SearchResponse &#123;  message Result &#123;    string url = 1;    string title = 2;    repeated string snippets = 3;  &#125;  repeated Result results = 1;&#125;// to use the msg type outside its parent message type message SomeOtherMessage &#123;  SearchResponse.Result result = 1;&#125;</code></pre><h2 id="4-4-Updating-a-Message-Type"><a href="#4-4-Updating-a-Message-Type" class="headerlink" title="4.4 Updating a Message Type"></a>4.4 Updating a Message Type</h2><ul><li>donâ€™t change the field numbers for any existing fields</li><li>if you add new fields, any msg serialized by code using your old msg format can still be parsed by your new generated code<ul><li>keep in mind the default values for these elements so that new code can properly interact with msgs generated by old code</li></ul></li><li>to remove a field<ul><li>rename the field with prefix like <code>OBSOLETE_</code></li><li>or make the filed number reserved,</li></ul></li><li>int32, uint32, int64, uint64 and bool are all compatible</li><li>string and bytes are compatible as long as the bytes are valid UTF-8</li></ul><h2 id="4-5-Special-Keywords"><a href="#4-5-Special-Keywords" class="headerlink" title="4.5 Special Keywords"></a>4.5 Special Keywords</h2><h3 id="4-5-1-Any"><a href="#4-5-1-Any" class="headerlink" title="4.5.1 Any"></a>4.5.1 <code>Any</code></h3><ul><li>let you use messages as embedded types without having their .proto definition</li><li>it contains an aribitrary serialized messages as bytes</li></ul><h3 id="4-5-2-Oneof"><a href="#4-5-2-Oneof" class="headerlink" title="4.5.2 Oneof"></a>4.5.2 Oneof</h3><ul><li>if we have a msg with many fields and where at most one field will be set at the same time, we can enforce the behavior and save memory by using the oneof feature</li><li>at most one field can be set at the same time</li><li>setting any member of the oneof automatically clears all the other members</li></ul><h2 id="4-6-Maps"><a href="#4-6-Maps" class="headerlink" title="4.6 Maps"></a>4.6 Maps</h2><ul><li><code>map&lt;key_type, value_type&gt; map_field = N;</code></li></ul><h2 id="4-7-Define-Service"><a href="#4-7-Define-Service" class="headerlink" title="4.7 Define Service"></a>4.7 Define Service</h2><ul><li>If you want to use message types with an RPC system, we can define an RPC service interface in a <code>.proto</code> file</li><li>then the protocol buffer compiler will <strong>generate service interface code and stubs</strong> in chosen language</li></ul><h2 id="4-8-Options"><a href="#4-8-Options" class="headerlink" title="4.8 Options"></a>4.8 Options</h2><ul><li><p>Options do not change the overall meaning of a declaration, but may affect the way it is handled in a particular context.</p></li><li><p>java_package</p><ul><li>pkg you want to use for your generated Java classes</li></ul></li><li><p>java_outer_classname</p><ul><li>class name for the wrapper java class you want to generate</li></ul></li><li><p>java_multiple_files</p></li><li><p><code>optimize_for</code></p><ul><li><code>SPEED</code><ul><li>Compiler will generate code for serializing, parsing and performing other common operations on your msg types.</li><li>Code is highly optimized</li></ul></li><li><code>CODE_SIZE</code><ul><li>generate minimal classes</li><li>operations will be slower</li></ul></li><li><code>LITE_RUNTIME</code><ul><li>only depend on the lite runtime library</li><li>usefyl for apps running on constrained platform like mobile phones</li></ul></li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li>Overview <a href="https://developers.google.com/protocol-buffers">https://developers.google.com/protocol-buffers</a> </li><li>Language Guide <a href="https://developers.google.com/protocol-buffers/docs/overview">https://developers.google.com/protocol-buffers/docs/overview</a> </li><li>Java Tutorial <a href="https://developers.google.com/protocol-buffers/docs/javatutorial">https://developers.google.com/protocol-buffers/docs/javatutorial</a> </li><li>Java Generated Code <a href="https://developers.google.com/protocol-buffers/docs/reference/java-generated">https://developers.google.com/protocol-buffers/docs/reference/java-generated</a> </li><li>Java Encoding <a href="https://developers.google.com/protocol-buffers/docs/encoding">https://developers.google.com/protocol-buffers/docs/encoding</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Protobuf-Learning&quot;&gt;&lt;a href=&quot;#Protobuf-Learning&quot; class=&quot;headerlink&quot; title=&quot;Protobuf Learning&quot;&gt;&lt;/a&gt;Protobuf Learning&lt;/h1&gt;&lt;h1 id=&quot;1-Wha
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="Protobuf" scheme="https://www.llchen60.com/tags/Protobuf/"/>
    
  </entry>
  
  <entry>
    <title>Bazel Intro</title>
    <link href="https://www.llchen60.com/Bazel-Intro/"/>
    <id>https://www.llchen60.com/Bazel-Intro/</id>
    <published>2021-12-22T02:05:15.000Z</published>
    <updated>2021-12-22T02:07:14.224Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-What-is-Bazel"><a href="#1-What-is-Bazel" class="headerlink" title="1. What is Bazel?"></a>1. What is Bazel?</h1><ul><li><p>Bazel is a build and test tool built that supports building and testing multiple projects for multiple languages and build outputs</p></li><li><p>What</p><ul><li>Build and Test tool similar to Make, Maven, Gradle</li><li>Caches all the previously done work, tests or builds faster everytime</li><li>Support multi languages, multi platforms,</li><li>Support large code base across multi repos</li><li>build, test, and query to trace dependencies in the code</li></ul></li><li><p>Why</p><ul><li>scales</li><li>multi platform</li></ul></li><li><p>How</p><ul><li>Need a BUILD file</li></ul></li></ul><h1 id="2-Concepts"><a href="#2-Concepts" class="headerlink" title="2. Concepts"></a>2. Concepts</h1><ul><li>Workspace - With WORKSPACE<ul><li>dir contains the source file</li><li>considered as root</li></ul></li><li>WORKSPACE<ul><li>a blank text file, which identifies the directory and its content as a Bazel workspace</li><li>at the root of the projectâ€™s directory structure</li></ul></li><li>Repos - With WORKSPACE<ul><li>External repos are defined in the WORKSPACE file using workspace rules</li></ul></li><li>Packages - With BUILD<ul><li>A package is defined as a directory containing a file named BUILD or BUILD.bazel</li><li>which reside beneath top level directory in the ws</li><li>This file has instructions on how to <strong>run or build or test</strong> the project</li></ul></li><li>Rules<ul><li>written using a DSL named Starlark</li><li>thus are built for certain language already like rules_java, etc.</li></ul></li><li>Targets<ul><li>Pkg is container, element of pkg â€”- target</li><li>Most targets are files or rules<ul><li>File<ul><li>source files - written by people</li><li>generated files â€” generated by build tool</li></ul></li><li>rule<ul><li>specify relationship between set of inputs and output</li><li>output are always generated files</li></ul></li></ul></li></ul></li></ul><h1 id="3-Best-Practices"><a href="#3-Best-Practices" class="headerlink" title="3. Best Practices"></a>3. Best Practices</h1><ul><li>A project should always be able to run <code>bazel build //...</code> and <code>bazel test //...</code></li><li>You may declare third party dependencies<ul><li>either declare them as remote repositories in the WORKSPACE file</li><li>or put them in a directory called third_party under workspace directory</li></ul></li><li>everything should be built from source whenever possible, instead of depending on a library so file, we should create a BUILD file and build so from its sources, then depend on that target</li><li>for project specific options, use the configuration file under <code>workspace/.bazelrc</code></li><li>every directory that contains buildable files should be a package</li></ul><h1 id="4-Build-a-Java-Project"><a href="#4-Build-a-Java-Project" class="headerlink" title="4. Build a Java Project"></a>4. Build a Java Project</h1><h2 id="4-1-Bazel-Jave-Basic"><a href="#4-1-Bazel-Jave-Basic" class="headerlink" title="4.1 Bazel Jave Basic"></a>4.1 Bazel Jave Basic</h2><ul><li><p>Refer <a href="https://docs.bazel.build/versions/1.2.0/tutorial/java.html">https://docs.bazel.build/versions/1.2.0/tutorial/java.html</a></p></li><li><p>build rule tells bazel how to build the desired outputs, executable binaries or libraries</p><ul><li>the java binary rule tells bazel to build a jar file and a wrapper shell script</li></ul></li><li><p><code>bazel build //:ProjectRunner</code></p><ul><li>the <code>//</code> part is the location of our BUILD file relative to the root of the workspace</li><li><code>ProjectRunner</code> is the target name we define in the BUILD file</li></ul></li><li><p>we could review our dependency graph by using</p><ul><li><code>bazel query --notool_deps --noimplicit_deps &quot;deps(//:ProjectRunner)&quot; --output graph</code></li></ul></li></ul><pre><code class="ruby">// generate graph for class in use, and output as a svg file bazel query  --notool_deps --noimplicit_deps &quot;deps(//booking)&quot; --output graph &gt; /Users/lchen1/Documents/bookingGraph.in dot -Tsvg &lt; bookingGraph.in &gt; graph.svg</code></pre><h2 id="4-2-Specify-multiple-build-targets"><a href="#4-2-Specify-multiple-build-targets" class="headerlink" title="4.2 Specify multiple build targets"></a>4.2 Specify multiple build targets</h2><ul><li><p>Package Splits</p><ul><li><p>for larger project, we may want to split into multiple targets and packages to allow for fast incremental builds, this could also speed up builds by building multiple parts of a project at once</p><pre><code class="json">java_binary(  name = &quot;ProjectRunner&quot;,  srcs = [&quot;src/main/java/com/example/ProjectRunner.java&quot;],  main_class = &quot;com.example.ProjectRunner&quot;,  deps = [&quot;:greeter&quot;],)java_library(  name = &quot;greeter&quot;,  srcs = [&quot;src/main/java/com/example/Greeting.java&quot;],)</code></pre></li></ul></li></ul><ul><li>with this configuration, bazel will first build greeter library, then the projectRunner binary<ul><li>deps attribute tells bazel the greeter library is required to build the projectRunner binary</li></ul></li></ul><h2 id="4-3-Use-multiple-packages"><a href="#4-3-Use-multiple-packages" class="headerlink" title="4.3 Use multiple packages"></a>4.3 Use multiple packages</h2><pre><code class="json">java_binary(    name = &quot;runner&quot;,    srcs = [&quot;Runner.java&quot;],    main_class = &quot;com.example.cmdline.Runner&quot;,    deps = [&quot;//:greeter&quot;])</code></pre><ul><li>To make sure above works, we need to let greeter be visible to cmdline.Runner<ul><li>Let the resource owner set the visibility attribute</li><li>we need to do this cause Bazel by default makes target only visible to other targets in the same BUILD file</li><li>bazel uses target visibility to prevent issues such as libraries containing implementation details leaking into public APIs</li></ul></li></ul><pre><code class="json">java_library(    name = &quot;greeter&quot;,    srcs = [&quot;src/main/java/com/example/Greeting.java&quot;],    visibility = [&quot;//src/main/java/com/example/cmdline:__pkg__&quot;],    )</code></pre><h2 id="4-4-Use-labels-to-reference-targets"><a href="#4-4-Use-labels-to-reference-targets" class="headerlink" title="4.4 Use labels to reference targets"></a>4.4 Use labels to reference targets</h2><ul><li>Bazel uses target labels to reference targets<ul><li><code>//:ProjectRunner</code></li><li>sync as follow:<ul><li><code>//path/to/package:target-name</code></li></ul></li></ul></li><li>when referencing targets within the same BUILD file, we can skip the <code>//</code> workspace root identifier and just use <code>:target_name</code></li></ul><h1 id="5-E-G"><a href="#5-E-G" class="headerlink" title="5. E.G"></a>5. E.G</h1><ul><li>java_binary<ul><li>pre defined rule telling bazel to create a binary when a target is invoked</li></ul></li></ul><pre><code class="json">java_binary(        // target name     name = &quot;mymain&quot;,        // all source files, passed as glob, inside the fully qualified directory names on classpath     srcs = glob([&quot;src/main/java/com/abhi/*.java&quot;]),        // main runner class     main_class = &quot;com.abhi.MyMain&quot;,        // dependent classes/ interfaces to be included, not part of srcs     deps = [&quot;//another-dir:animal&quot;])</code></pre><ul><li>java_library<ul><li>pre-defined to create library as the name suggests</li></ul></li></ul><pre><code class="json">java_library(    name = &quot;animal&quot;,    srcs = [&quot;src/main/java/com/abhi/Animal.java&quot;],        // if other class is implemented in a different pkg, it has to be visible to main-dir     visibility = [&quot;//main-dir:__pkg__&quot;])</code></pre><ul><li>CLI Reference<ul><li><code>bazel build //main-dir:mymain</code><ul><li>// means a valid package name</li><li>mymain is the target name</li></ul></li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li>Bazel best practice <a href="https://docs.bazel.build/versions/main/best-practices.html">https://docs.bazel.build/versions/main/best-practices.html</a> </li><li>Bazel Overview  <a href="https://docs.bazel.build/versions/1.2.0/bazel-overview.html">https://docs.bazel.build/versions/1.2.0/bazel-overview.html</a> </li><li>Java Tutorial <a href="https://docs.bazel.build/versions/1.2.0/tutorial/java.html">https://docs.bazel.build/versions/1.2.0/tutorial/java.html</a> </li><li>How to specify targets to build <a href="https://docs.bazel.build/versions/main/guide.html#target-patterns">https://docs.bazel.build/versions/main/guide.html#target-patterns</a> </li></ol><p><a href="https://docs.bazel.build/versions/4.2.1/command-line-reference.html">Command-Line Reference</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-What-is-Bazel&quot;&gt;&lt;a href=&quot;#1-What-is-Bazel&quot; class=&quot;headerlink&quot; title=&quot;1. What is Bazel?&quot;&gt;&lt;/a&gt;1. What is Bazel?&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Bazel
      
    
    </summary>
    
    
      <category term="BackEnd" scheme="https://www.llchen60.com/categories/BackEnd/"/>
    
    
      <category term="Bazel" scheme="https://www.llchen60.com/tags/Bazel/"/>
    
      <category term="Package Management" scheme="https://www.llchen60.com/tags/Package-Management/"/>
    
  </entry>
  
  <entry>
    <title>GraphQL Read</title>
    <link href="https://www.llchen60.com/GraphQL-Read/"/>
    <id>https://www.llchen60.com/GraphQL-Read/</id>
    <published>2021-12-04T09:29:50.000Z</published>
    <updated>2021-12-04T09:31:23.613Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GraphQL-Read"><a href="#GraphQL-Read" class="headerlink" title="GraphQL Read"></a>GraphQL Read</h1><h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><ul><li>QraphQL is<ul><li>a query language</li><li>a server side runtime for executing queries using a type system you define</li></ul></li></ul><h1 id="2-Queries-and-Mutations"><a href="#2-Queries-and-Mutations" class="headerlink" title="2. Queries and Mutations"></a>2. Queries and Mutations</h1><ul><li>Fields<ul><li>GraphQL is about asking specific fields on objects</li><li>Query has the same shape as result<ul><li>server knows exactly what fields the client is asking for</li></ul></li></ul></li></ul><pre><code class="ruby">&#123;    hero &#123;        name    &#125;&#125;&#123;    &quot;data&quot;: &#123;        &quot;hero&quot;: &#123;            &quot;name&quot;: &quot;12test&quot;        &#125;    &#125;&#125;</code></pre><ul><li><p>Arguments</p><ul><li>we could pass arguments to fields</li><li>comparing with Restful, in GraphQL every field and nested object can get its own set of arguments, making GraphQL a complete replacement for making multiple APU fetches</li></ul></li><li><p>Fragments</p><ul><li>Thatâ€™s the reusable units in GraphQL</li><li>Fragments let you construct sets of fields, and then include them in queries where you need to</li><li>Itâ€™s commonly used to split complicated application data requirements into smaller chunks</li></ul></li><li><p>Operation Name</p><ul><li>Operation Type<ul><li>Query</li><li>Mutation</li><li>Subscription</li></ul></li><li>Operation Name</li></ul></li><li><p>Variables</p><ul><li>It want to give dynamic power to graphql, as in most applications, the arguments to fields will be dynamic</li><li>Graphql supports this use case via variables</li><li>we could do:<ul><li>replace the static value in the query with <code>$variable</code></li><li>declare <code>$variable</code> as one of the variables accepted by the query</li><li>pass <code>variable: value</code> in the separate transport specific variables dictionary</li></ul></li><li>using variable could help us denote which arguments are expected to be dynamic</li><li>we should never do string interpolation to construct queries from user supplied values</li></ul></li></ul><pre><code class="ruby">query HeroNameAndFriends($episode: Episode) &#123;  hero(episode: $episode) &#123;    name    friends &#123;      name    &#125;  &#125;&#125;&#123;  &quot;episode&quot;: &quot;JEDI&quot;&#125; </code></pre><ul><li>Default variables</li></ul><pre><code class="ruby">query HeroNameAndFriends($episode: Episode = &quot;defaultOne&quot;) &#123;  hero(episode: $episode) &#123;    name    friends &#123;      name    &#125;  &#125;&#125;&#123;  &quot;episode&quot;: &quot;JEDI&quot;&#125; </code></pre><ul><li><p>Directives</p><ul><li>use this variable to dynamically change the structure and shape of our queries using variables</li><li><code>@include(if: Boolean)</code> only includes this field in the result if the argument is true</li><li><code>@skip(if: Boolean)</code> skip this field if the argument is true</li></ul></li><li><p>Mutations</p><ul><li>A way to modify server side data</li><li>A convention that any operations that cause writes should be sent explicitly via a mutation</li><li>!!! While query fields are executed in parallel, mutation fields run in series, one after the other<ul><li>means if we send two incrementCredits mutations in one request, the first is guranteed to finish before the second begins, ensuring that we donâ€™t end up with a race condition with ourselves</li></ul></li></ul></li><li><p>Inline Fragments</p><ul><li><p>GraphQL schemas include the ability to define interfaces and union types</p></li><li><p>EG below, we need to return different attributes based on hero character</p><pre><code class="ruby">query HeroForEpisode($ep: Episode!) &#123;hero(episode: $ep) &#123;  name  ... on Droid &#123;    primaryFunction  &#125;  ... on Human &#123;    height  &#125;&#125;&#125;</code></pre></li></ul></li><li><p>Meta fields</p><ul><li>there are situations where you donâ€™t know what type youâ€™ll get back from the service</li><li>we need to determine how to handle that data on the client</li><li>we could use <code>__typename</code></li></ul></li></ul><h1 id="3-Schemas-and-Types"><a href="#3-Schemas-and-Types" class="headerlink" title="3. Schemas and Types"></a>3. Schemas and Types</h1><h2 id="3-1-how-the-schema-work"><a href="#3-1-how-the-schema-work" class="headerlink" title="3.1 how the schema work"></a>3.1 how the schema work</h2><ul><li><p>How does GraphQL work</p><ul><li><p>start with a <code>root</code> object</p></li><li><p>select the hero field on that</p></li><li><p>for the object returned by hero, we select the name and appearsIn fields</p><pre><code class="ruby">&#123;hero &#123;  name  appearsIn&#125;&#125;</code></pre></li></ul></li><li><p>we should know what we could query for</p><ul><li>an exact description of the data we can ask for</li><li>what kind of objects might they return</li><li>what fields are available on those sub objects</li></ul></li><li><p>Schema</p><ul><li>Each graphQL services defines a set of types which completely describe the set of possible data you can query on the service</li></ul></li></ul><h2 id="3-2-Type-Language"><a href="#3-2-Type-Language" class="headerlink" title="3.2 Type Language"></a>3.2 Type Language</h2><ul><li>GraphQL use its won Schema Language</li></ul><h3 id="3-2-1-Object-Types-and-Fields"><a href="#3-2-1-Object-Types-and-Fields" class="headerlink" title="3.2.1 Object Types and Fields"></a>3.2.1 Object Types and Fields</h3><ul><li>Object types<ul><li>represent a kind of object you can fetch from your service, and what fields it has</li></ul></li></ul><pre><code class="ruby">type Character &#123;  name: String!// means an array of Episode objects, notnull, 0 or more items, and each item would be an episode object   appearsIn: [Episode!]!&#125;</code></pre><h3 id="3-2-2-Query-and-Mutation-types"><a href="#3-2-2-Query-and-Mutation-types" class="headerlink" title="3.2.2 Query and Mutation types"></a>3.2.2 Query and Mutation types</h3><ul><li>Entry points into the schema</li></ul><h3 id="3-2-3-Scalar-Types"><a href="#3-2-3-Scalar-Types" class="headerlink" title="3.2.3 Scalar Types"></a>3.2.3 Scalar Types</h3><ul><li>Scalar types represent the leaves of the query</li><li>default scalar types<ul><li>Int</li><li>Float</li><li>String</li><li>Boolean</li><li>ID<ul><li>it represents a unique identifier</li><li>The ID type is serialized in the same way as a String, but it means itâ€™s not intended to be human readable</li></ul></li></ul></li><li>We could also define our own Scalar type in this way<ul><li><code>scalar Date</code></li></ul></li></ul><h3 id="3-2-4-Enumeration-Types"><a href="#3-2-4-Enumeration-Types" class="headerlink" title="3.2.4 Enumeration Types"></a>3.2.4 Enumeration Types</h3><ul><li>Restricted to a particular set of allowed values</li><li>Allow you to<ul><li>validate that any arguments of this type are one of the allowed values</li><li>communicate through the type system that a field will always be one of a finite set of values</li></ul></li></ul><h3 id="3-2-5-Lists-and-Non-Null"><a href="#3-2-5-Lists-and-Non-Null" class="headerlink" title="3.2.5 Lists and Non-Null"></a>3.2.5 Lists and Non-Null</h3><pre><code>type Character &#123;  name: String!  appearsIn: [Episode]!&#125;</code></pre><ul><li>We could use <code>!</code> to indicate it should never return null</li><li>We could use <code>[]</code> to indicate that should be an array</li></ul><h3 id="3-2-6-Interfaces"><a href="#3-2-6-Interfaces" class="headerlink" title="3.2.6 Interfaces"></a>3.2.6 Interfaces</h3><ul><li>An abstract type that includes a certain set of fields that a type must include to implement the interface</li></ul><pre><code class="ruby">interface Character &#123;    id: ID!  name: String!  friends: [Character]  appearsIn: [Episode]!&#125;type Human implements Character &#123;  id: ID!  name: String!  friends: [Character]  appearsIn: [Episode]!  starships: [Starship]  totalCredits: Int&#125;type Droid implements Character &#123;  id: ID!  name: String!  friends: [Character]  appearsIn: [Episode]!  primaryFunction: String&#125;</code></pre><ul><li>Type implement the interface need to have all those fields, but they could also have their own fields</li></ul><h3 id="3-2-7-Union-Types"><a href="#3-2-7-Union-Types" class="headerlink" title="3.2.7 Union Types"></a>3.2.7 Union Types</h3><p><code>union SearchResult = Human | Droid | Starship</code></p><h3 id="3-2-8-Input-Types"><a href="#3-2-8-Input-Types" class="headerlink" title="3.2.8 Input Types"></a>3.2.8 Input Types</h3><ul><li>we need to pass complex objects especially when we are using mutations, where we want to pass in a whole object to be created</li></ul><pre><code class="ruby">input ReviewInput &#123;  stars: Int!  commentary: String&#125;mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;  createReview(episode: $ep, review: $review) &#123;    stars    commentary  &#125;&#125;</code></pre><h1 id="4-Validation"><a href="#4-Validation" class="headerlink" title="4. Validation"></a>4. Validation</h1><ul><li>Graph ql has validation module to fulfill the validation phase of fulfilling a graphQL result</li></ul><h1 id="5-Execution"><a href="#5-Execution" class="headerlink" title="5. Execution"></a>5. Execution</h1><h2 id="5-1-Resolvers"><a href="#5-1-Resolvers" class="headerlink" title="5.1 Resolvers"></a>5.1 Resolvers</h2><ul><li>Each field in a GraphQL query is a function or method of the previous type which returns the next type</li><li>Each field is backed by a function called the resolver. When a field is executed, the corresponding resolver is called to produce the next value</li><li>The resolver continue to work until reach scalar values</li></ul><h2 id="5-2-Root-fields"><a href="#5-2-Root-fields" class="headerlink" title="5.2 Root fields"></a>5.2 Root fields</h2><pre><code class="ruby">Query: &#123;  human(obj, args, context, info) &#123;    return context.db.loadHumanByID(args.id).then(      userData =&gt; new Human(userData)    )  &#125;&#125;</code></pre><ul><li>obj<ul><li>previous object</li></ul></li><li>args<ul><li>arguments provided to the field in the graphQL query</li></ul></li><li>context<ul><li>a value which is provided to every resolver and holds important contextual information like the currently logged in user, or access to a database</li></ul></li><li>info<ul><li>a value which holds field specific information relevant to the current query as well as the schema details</li></ul></li></ul><h1 id="6-Best-Practices"><a href="#6-Best-Practices" class="headerlink" title="6. Best Practices"></a>6. Best Practices</h1><h2 id="6-1-HTTP"><a href="#6-1-HTTP" class="headerlink" title="6.1 HTTP"></a>6.1 HTTP</h2><ul><li><p>Mostly use HTTP with graphQL</p></li><li><p>Normally web frameworks use a pipeline model where requests are passed through a stack of middle ware</p></li><li><p>Requests could be inspected, transformed, modified or terminated with a response</p></li><li><p>GraphQL should be placed after all authentication middlewareâ€” thus you have access to the same session and user info you would in your HTTP endpoints handler</p></li><li><p>GraphQL server operates on a single URL/ endpoint, usually <code>graphql</code> , and all graphql requests for a given service should be directed at this endpoint</p></li></ul><h2 id="6-2-JSON-with-GZIP"><a href="#6-2-JSON-with-GZIP" class="headerlink" title="6.2 JSON with GZIP"></a>6.2 JSON with GZIP</h2><ul><li>typically respond using JSON, and we compress it with GZIP</li></ul><h2 id="6-3-Versioning"><a href="#6-3-Versioning" class="headerlink" title="6.3 Versioning"></a>6.3 Versioning</h2><ul><li>No need to do versioning for graphql api</li><li>Why do most APIs version? When thereâ€™s limited control over the data thatâ€™s returned from an API endpoint, <em>any change</em> can be considered a breaking change, and breaking changes require a new version. If adding new features to an API requires a new version, then a tradeoff emerges between releasing often and having many incremental versions versus the understandability and maintainability of the API.</li><li>In contrast, GraphQL only returns the data thatâ€™s explicitly requested, so new capabilities can be added via new types and new fields on those types without creating a breaking change. This has led to a common practice of always avoiding breaking changes and serving a versionless API.</li></ul><h2 id="6-4-Nullability"><a href="#6-4-Nullability" class="headerlink" title="6.4 Nullability"></a>6.4 Nullability</h2><ul><li>GraphQL default to nullable unless you specifically declare nonnull</li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://www.graphql-java-kickstart.com/">https://www.graphql-java-kickstart.com/</a>  </li><li><a href="https://graphql.org/learn/">https://graphql.org/learn/</a>  </li><li><a href="https://www.apollographql.com/docs/federation/">https://www.apollographql.com/docs/federation/</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;GraphQL-Read&quot;&gt;&lt;a href=&quot;#GraphQL-Read&quot; class=&quot;headerlink&quot; title=&quot;GraphQL Read&quot;&gt;&lt;/a&gt;GraphQL Read&lt;/h1&gt;&lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="Web" scheme="https://www.llchen60.com/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç¼“è§£ç–²åŠ³</title>
    <link href="https://www.llchen60.com/%E5%A6%82%E4%BD%95%E7%BC%93%E8%A7%A3%E7%96%B2%E5%8A%B3/"/>
    <id>https://www.llchen60.com/%E5%A6%82%E4%BD%95%E7%BC%93%E8%A7%A3%E7%96%B2%E5%8A%B3/</id>
    <published>2021-11-02T13:31:04.000Z</published>
    <updated>2021-11-02T13:34:58.934Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/11/02/zEvGV8uDnJxoITr.png" alt="å¦‚ä½•æŠµæŠ—ç¼“è§£ç–²åŠ³.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2021/11/02/zEvGV8uDnJxoITr.png&quot; alt=&quot;å¦‚ä½•æŠµæŠ—ç¼“è§£ç–²åŠ³.png&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¢³è¾¾å³°ä¸ç¢³ä¸­å’Œ</title>
    <link href="https://www.llchen60.com/%E7%A2%B3%E8%BE%BE%E5%B3%B0%E4%B8%8E%E7%A2%B3%E4%B8%AD%E5%92%8C/"/>
    <id>https://www.llchen60.com/%E7%A2%B3%E8%BE%BE%E5%B3%B0%E4%B8%8E%E7%A2%B3%E4%B8%AD%E5%92%8C/</id>
    <published>2021-09-30T02:21:14.000Z</published>
    <updated>2021-09-30T02:22:44.858Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/09/30/XGS6Qey4qHki2FC.png" alt="ç¢³è¾¾å³°ä¸ç¢³ä¸­å’Œ"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2021/09/30/XGS6Qey4qHki2FC.png&quot; alt=&quot;ç¢³è¾¾å³°ä¸ç¢³ä¸­å’Œ&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Cassandra</title>
    <link href="https://www.llchen60.com/Cassandra/"/>
    <id>https://www.llchen60.com/Cassandra/</id>
    <published>2021-09-17T13:05:55.000Z</published>
    <updated>2021-09-17T13:41:43.051Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/09/17/IGdzKBJwD9TbZ6f.png" alt="Cassandra MindMap.png"></p><h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><h2 id="1-1-Background"><a href="#1-1-Background" class="headerlink" title="1.1 Background"></a>1.1 Background</h2><ul><li>We wanna have a distributed and scalable system that can store a <strong>huge amount of structured data</strong>, which is indexed by a row key where each row can have an <strong>unbounded</strong> number of columns.</li><li>Cassandra was originally developed at Facebook in 2007 for index search feature. Itâ€™s designed to provide scalability, availability, and reliability to store large amounts of data.</li><li>It combines nature of Dynamo which is a <strong>key value store</strong> and the data model of Bigtable which is a <strong>column based</strong> data store</li><li>Cassandra is in favor of availability and partition tolerance, it could be tuned with <strong>replication factor</strong> and <strong>consistency levels</strong> to meet <strong>strong consistency</strong> requirements, and of course with a performance cost.</li><li>It uses peer to peer architecture, with each node connected to all other nodes</li><li>Each Cassandra node performs all database operations and can serve client requests without the need for any leader node.</li></ul><h2 id="1-2-Use-cases"><a href="#1-2-Use-cases" class="headerlink" title="1.2 Use cases"></a>1.2 Use cases</h2><ul><li>Store key value data with high availability</li><li>Time series data model<ul><li>Due to its data model and log structured storage engine, cassandra benefits from high performing write operations, This also make it well suited for storing and analyzing sequentially captured metrics</li></ul></li><li>Write Heavy Applications<ul><li>Suited for write intensive applications such as time series streaming services, sensor logs, and IoT applications</li></ul></li></ul><h1 id="2-High-Level-Architecture"><a href="#2-High-Level-Architecture" class="headerlink" title="2. High Level Architecture"></a>2. High Level Architecture</h1><h2 id="2-1-Common-Terms"><a href="#2-1-Common-Terms" class="headerlink" title="2.1 Common Terms"></a>2.1 Common Terms</h2><p><img src="https://i.loli.net/2021/09/17/IrfBD5HFqAX76NJ.png" alt="Primary and Clustering Keys"></p><ul><li>Column<ul><li>A key value pair and is the most basic unit of data structure</li><li>Column Key: Uniquely identifies a column in a row</li><li>Column Value: Store a value or a collection of values</li></ul></li><li>Row<ul><li>A container for columns referenced by primary key. Cassandra does not store a column that has a null value, this saves a lot of space</li></ul></li><li>Table<ul><li>A container of rows</li></ul></li><li>Keyspace<ul><li>A container for tables that span over one or more Cassandra nodes</li></ul></li><li>Cluster<ul><li>Container of Keyspace</li></ul></li><li>Node<ul><li>A computer system running an instance of Cassandra,</li><li>Can be a physical host, a machine instance in the cloud or even a docker container</li></ul></li></ul><h2 id="2-2-Data-Partitioning"><a href="#2-2-Data-Partitioning" class="headerlink" title="2.2 Data Partitioning"></a>2.2 Data Partitioning</h2><ul><li>Cassandra use consistent hashing as DynamoDB does</li></ul><h2 id="2-3-Primary-Key"><a href="#2-3-Primary-Key" class="headerlink" title="2.3 Primary Key"></a>2.3 Primary Key</h2><ul><li>The primary key consists of two parts:  E.G Primary Key as (city_id, employee_id)<ul><li>Partition Key<ul><li>Decides how data is distributed across nodes</li><li>city_id is the primary key, means the data will be partitioned by the city_id field, all rows with the same city_id will reside on the same node</li></ul></li><li>Clustering Key<ul><li>Decides how data is stored within a node</li><li>We could have multiple clustering keys, clustering columns specify the order that the data is arranged on a node.</li><li>employee_id is the clustering key. Within each node, the data is stored in sorted order according to the employee_id column.</li></ul></li></ul></li></ul><h2 id="2-4-Partitioner"><a href="#2-4-Partitioner" class="headerlink" title="2.4 Partitioner"></a>2.4 Partitioner</h2><p><img src="https://i.loli.net/2021/09/17/3NdkOaXUpbgnWq9.png" alt="Partitioner Flow"></p><ul><li>Responsible for determining how data is distributed on the consistent hash ring.</li><li>Cassandra use <strong>Murmur3 hashing function</strong> â€” which will always produce the same hash for a given partition key</li><li>All Cassandra nodes learn about the <strong>token assignments of other nodes</strong> through gossip. This means any node can handle a request for any other nodeâ€™s range. The node receiving the request is called the <strong>coordinator</strong>, and any node can act in this role. If a key does not belong to the coordinatorâ€™s range, it <strong>forwards the request</strong> to the replicas responsible for that range.</li></ul><h2 id="2-5-Coordinator-Node"><a href="#2-5-Coordinator-Node" class="headerlink" title="2.5 Coordinator Node"></a>2.5 Coordinator Node</h2><ul><li>A client may connect to any node in the cluster to initiate a read or write query. This node is known as the coordinator node, the coordinator identifies the nodes responsible for the data that is being written or read    and forwards the queries to them</li></ul><h1 id="3-Low-Level-Architecture"><a href="#3-Low-Level-Architecture" class="headerlink" title="3. Low Level Architecture"></a>3. Low Level Architecture</h1><h2 id="3-1-Replication-Strategy"><a href="#3-1-Replication-Strategy" class="headerlink" title="3.1 Replication Strategy"></a>3.1 Replication Strategy</h2><ul><li><p>Each node in Cassandra serves as a replica for a different range of data.</p></li><li><p>It stores <strong>multiple copies of data</strong> and <strong>spreads them across various replicas</strong>.</p></li><li><p>The replication behavior is controlled by two factors</p><ul><li><p>Replication Factor</p><ul><li>Decides how many replicas the system will have</li><li>This represents the <strong>number of nodes that will receive the copy of the same data</strong></li><li>Each keyspace in cassandra can have a different replication factor</li></ul></li><li><p>Replication Strategy</p><ul><li><p>Decides which nodes will be responsible for the replicas</p></li><li><p>The node that owns the range in which the hash of the partition key falls will be the first replica</p></li><li><p>All the additional replicas are placed on the <strong>consecutive nodes</strong></p></li><li><p>Cassandra places the subsequent replicas on the next nodes in a clockwise manner</p></li><li><p>Two kinds of replication strategies</p><ul><li><p>Simple Replication Strategy</p><p>  <img src="https://i.loli.net/2021/09/17/cnz12lGFWEPw4fS.png" alt="Simple Replication Strategy"></p><ul><li>Used for a <strong>single data center cluster</strong></li><li>Cassandra places the first replica on a node determined by the partitioner and the subsequent replicas on the next node in a clockwise manner</li></ul></li><li><p>Network Topology Strategy</p><p>  <img src="https://i.loli.net/2021/09/17/TSAZbXKCYf9IsoN.png" alt="Network Topology Strategy"></p><ul><li>Used for multiple data centers</li><li>We can specify different replication factors for different data centers. We could then specify how many replicas will be placed in each data center</li><li>Additional replicas, in the same data center, are placed by <strong>walking the ring clockwise until reaching the 1st node in another rack</strong>. This is done to guard against a complete rack failure, as nodes in the same rack(or similar physical grouping) tend to fail together due to power, cooling or network issues.</li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="3-2-Consistency-Levels"><a href="#3-2-Consistency-Levels" class="headerlink" title="3.2 Consistency Levels"></a>3.2 Consistency Levels</h2><ul><li>Definition<ul><li><strong>Minimum number of nodes</strong> that must fulfill a read or write operation before the operation can be considered successful</li><li>It allows use to <strong>specify different consistency levels</strong> for read and write</li><li>It also has <strong>tunable consistency level</strong></li><li>Tradeoff between consistency and response time<ul><li>As a higher consistency level means more nodes need to respond to a read or write query, giving user more assurance that the values present on each replica are the same</li></ul></li></ul></li></ul><h3 id="3-2-1-Write-Consistency-Levels"><a href="#3-2-1-Write-Consistency-Levels" class="headerlink" title="3.2.1 Write Consistency Levels"></a>3.2.1 Write Consistency Levels</h3><ul><li>Consistency Levels specify how many replica nodes must respond for the write to be reported as successful to the client</li><li>Level is specified <strong>per query by the client</strong></li><li>Cassandra is eventually consistent, updates to other replica nodes may continue in the background</li><li>How does Cassandra perform a write operation?<ul><li>Coordinator node contacts all replicas, as determined by the <strong>replication factor</strong> , and consider the write successful when a number of replicas equal to the consistency level acknowledge the write</li></ul></li><li>Write Consistency Levels List:<ul><li>One/ Two/ Three<ul><li>The data must be written to at least the specified number of replica nodes before a write is considered successful</li></ul></li><li>Quorum<ul><li>Data must be written to at least a quorum of replica nodes</li><li>Quorum is defined as <code>floor(RF/2 + 1)</code>  RF represents replication factor</li></ul></li><li>All<ul><li>ensures the data is written to all replica nodes</li><li>provides the highest consistency but lowest availability as writes will fail if any replica is down</li></ul></li><li>Local Quorum<ul><li>Ensure that data is written to a quorum of nodes in the same datacenter as the coordinator</li><li>Does not wait for the response from the other data centers</li></ul></li><li>Each Quorum<ul><li>Ensures that the data is written to a quorum of nodes in each datacenter</li></ul></li><li>Any<ul><li>The data must be written to at least one node</li><li>In the extreme case, when all replica nodes for the given partition key are down, the write can still succeed after a hinted handoff (see 3.2.4 section) has been written.<ul><li>In this case, an any write could succeed with hinted handoff, but it will not be readable until the replica nodes for that partition has recovered and the latest data is written on them</li></ul></li></ul></li></ul></li></ul><h3 id="3-2-2-Read-Consistency-Levels"><a href="#3-2-2-Read-Consistency-Levels" class="headerlink" title="3.2.2 Read Consistency Levels"></a>3.2.2 Read Consistency Levels</h3><ul><li><p>Read Query Consistency Level specify how many replica nodes must respond to a read request before returning the data</p></li><li><p>It has the same consistency levels for read operations as that of write operations exception Each_Quorum cause itâ€™s too expensive</p></li><li><p>To achieve strong consistency, we need to do <code>R + W &gt; RF</code> R represents read replica count, W represents write replication count, RF represents replication factor</p><ul><li>All client reads will see the most recent write in this scenario, and we will have strong consistency</li></ul></li><li><p>How does Cassandra perform a read operation?</p><ul><li><p>Coordinator always sends the read request to the fastest node</p><ul><li>E.G  for quorum=2, the coordinator sends the requests to the fastest node and the <strong>digest of the data</strong> from the second fastest node<ul><li>digest is the checksum of the data, we use this to save network bandwidth</li></ul></li></ul></li><li><p>if the digest doesnâ€™t match, means some replica do not have the latest version of data</p><ul><li><p>Coordinator then <strong>reads the data from all the replicas</strong> to determine the latest data</p></li><li><p>Then coordinator <strong>returns the latest data to the client and initiates a read repair request</strong></p></li><li><p>The read repair request will help push the newer version of data to nodes with the older version</p><p>  <img src="https://i.loli.net/2021/09/17/sPM6HnKthBpT945.png" alt="Read Operation with Snitch"></p></li></ul></li><li><p>latest write timestamp is used as a mark for the correct version of data, read repair operation is performed only in a portion of the total reads to avoid performance degradation</p></li></ul></li></ul><h3 id="3-2-3-Snitch"><a href="#3-2-3-Snitch" class="headerlink" title="3.2.3 Snitch"></a>3.2.3 Snitch</h3><ul><li><p>Functions</p><ul><li>Application that determines the proximity of nodes within the ring, also tells which nodes are faster â€” monitor the read latencies</li><li>It keeps track of the network topology of Cassandra nodes, determines which <strong>data centers and racks</strong> nodes belong to</li><li>Replication strategy use this information provided by the Snitch to spread the replicas across the cluster intelligently. It could do its best by not having more than one replica on the same rack</li></ul></li><li><p>Cassandra nodes use this info to route read/ write requests efficiently</p><p>  <img src="https://i.loli.net/2021/09/17/ZnaOJqIvgdcMmAW.png" alt="Request when set consistency to one"></p></li></ul><h3 id="3-2-4-Hinted-Handoff"><a href="#3-2-4-Hinted-Handoff" class="headerlink" title="3.2.4 Hinted Handoff"></a>3.2.4 Hinted Handoff</h3><p><img src="https://i.loli.net/2021/09/17/QvSmb5wntE2AHJd.png" alt="Hinted Handoff"></p><ul><li>To let Cassandra still serve write requests even when nodes are down</li><li>When a node is down, the coordinator nodes <strong>writes a hint in a text file on local disk</strong><ul><li>Hint contains the data itself along with information about which node the data belongs to</li><li>Recover from gossiper â€” When the coordinator node discovers from the gossiper that a node for which it holds hints has recovered, it forwards the write request for each hint to the target</li><li>Recover from routine call â€” each node every ten minutes checks to see if the failing node, for which it is holding any hints, has recovered</li></ul></li><li>With consistency level â€˜Any,â€™<ul><li>if all the replica nodes are down, the coordinator node will <strong>write the hints for all the nodes and report success to the client.</strong></li><li>However, this data will <strong>not reappear in any subsequent reads</strong> until one of the replica nodes comes back online, and the coordinator node successfully forwards the write requests to it.</li><li>This is assuming that the coordinator node is up when the replica node comes back.</li><li>This also means that we can lose our data if the coordinator node dies and never comes back. For this reason, we should avoid using the â€˜Anyâ€™ consistency level</li></ul></li><li>For node offline for quite long<ul><li>Hints can build up considerably on other nodes</li><li>When it back online, other nodes tend to flood that node with write requests</li><li>It would cause issues on the node, as it is already trying to come back after a failure</li><li>To address this, Cassandra <strong>limits the storage of hints to a configurable time window</strong></li><li>By default, set the time window to 3 hours. Post that, older hints will be removed  â€” now the recovered nodes will have stale data<ul><li>The stale data would be fixed during the read path, it will issue a read repair when it sees the stale data</li></ul></li></ul></li><li>When the cluster cannot meet the consistency level specified by the client, Cassandra fails the write request and does not store a hint .</li></ul><h2 id="3-3-Gossiper"><a href="#3-3-Gossiper" class="headerlink" title="3.3 Gossiper"></a>3.3 Gossiper</h2><h3 id="3-3-1-How-does-Cassandra-use-Gossip-Protocol"><a href="#3-3-1-How-does-Cassandra-use-Gossip-Protocol" class="headerlink" title="3.3.1 How does Cassandra use Gossip Protocol?"></a>3.3.1 How does Cassandra use Gossip Protocol?</h3><ul><li>Whatâ€™s for?<ul><li>Cassandra uses gossip protocol that allows each node to keep track of state information about the other nodes in the cluster.</li><li>Itâ€™s a Peer to Peer communication mechanism in which nodes <strong>periodically exchange state information about themselves and other nodes they know about</strong></li></ul></li><li>How it works?<ul><li>Each node initiates a gossip round every second to exchange state info about themselves with one to three other random nodes</li><li>Each gossip message has a version associated with it, so during a gossip exchange, older info is overwritten with the most current state for a particular node</li></ul></li><li>Generation number<ul><li>Each node stores a generation number which will be incremented every time a node restart</li><li>Node receiving the gossip message can compare the generation number it knows and the gossip messageâ€™s generation number</li><li>If the generation number in the gossip message is higher, it knows the node was restarted</li></ul></li><li>Seed nodes<ul><li>For node starting up for the first time</li><li>Assist in gossip convergence, thus guarantee schema/ state changes propagate regularly</li></ul></li></ul><h3 id="3-3-2-Node-Failure-Detection"><a href="#3-3-2-Node-Failure-Detection" class="headerlink" title="3.3.2 Node Failure Detection"></a>3.3.2 Node Failure Detection</h3><ul><li>Disadvantages for heartbeat<ul><li>outputs a boolean value telling us if the system is alive or not;</li><li>there is no middle ground.</li><li>Heartbeating uses a fixed timeout, and if there is no heartbeat from a server, the system, after the timeout, assumes that the server has crashed.</li><li>If we keep the timeout short, the system will be able to detect failures quickly but with many false positives due to slow machines or faulty networks.</li><li>On the other hand, if we keep the timeout long, the false positives will be reduced, but the system will not perform efficiently for being slow in detecting failures.</li></ul></li><li>Use adaptive failure detection mechanism  â€”â€” Phi Accrual Failure Detector<ul><li>Use historical heartbeat information to make the threshold adaptive</li><li>It outputs the suspicion level about a server</li><li>As a nodeâ€™s suspicion level increases, the system can gradually decide to stop sending new requests to it</li><li>It makes the distributed system efficient as it takes into account fluctuations in the network env and other intermittent server issues before declaring a system completely dead</li></ul></li></ul><h2 id="3-4-Anatomy-of-Cassandraâ€™s-Write-Operation"><a href="#3-4-Anatomy-of-Cassandraâ€™s-Write-Operation" class="headerlink" title="3.4 Anatomy of Cassandraâ€™s Write Operation"></a>3.4 Anatomy of Cassandraâ€™s Write Operation</h2><p>Cassandra stores data both <strong>in memory and on disk</strong> to provide both high performance and durability. Every write includes a timestamp, write path involves a lot of components: </p><p><img src="https://i.loli.net/2021/09/17/LrMK7ckIS2zEsU1.png" alt="Write Path"></p><ul><li>Each write is appended to a commit log, which is stored on disk</li><li>It is then written to Memtable in memory</li><li>Periodically, MemTables are flushed to SSTables on the disk</li><li>Periodically, compaction runs to merge SSTables</li></ul><h3 id="3-4-1-Commit-Log"><a href="#3-4-1-Commit-Log" class="headerlink" title="3.4.1 Commit Log"></a>3.4.1 Commit Log</h3><ul><li>When a node receives a write request, it immediately writes data to a commit log</li><li>Commit log is a <strong>write ahead log</strong> stored on disk</li><li>Used as a crash recovery mechanism to support Cassandraâ€™s durability goals</li><li>A write will not be considered successful on the node until itâ€™s <strong>written to the commit log</strong><ul><li>This ensures if a write operation does not make it to the in-memory store, it will still be possible to recover the data</li></ul></li><li>If we shut down the node or it crashes unexpectedly, the commit log can ensure that data is not lost; thatâ€™s because if the node restart, the commit log gets replayed</li></ul><h3 id="3-4-2-MemTable"><a href="#3-4-2-MemTable" class="headerlink" title="3.4.2 MemTable"></a>3.4.2 MemTable</h3><ul><li>After written to the commit log, the data is written to a memory resident data structure called memTable<ul><li>Each node has a MemTable in memory for each Cassandra table</li><li>Each MemTable contains data for a specific Cassandra table, and it resembles that table in memory</li><li>Each MemTable accrues writes and <strong>provides reads for data not yet flushed to disk</strong></li><li>Commit log stores all the writes in sequential order, with each new write appended to the end; whereas MemTable stores data in the sorted order of partition key and clustering columns</li><li>After writing data to the commit log and MemTable, the node <strong>sends an acknowledgement to the coordinator</strong> that the data has been successfully written</li></ul></li></ul><h3 id="3-4-3-SStable"><a href="#3-4-3-SStable" class="headerlink" title="3.4.3 SStable"></a>3.4.3 SStable</h3><ul><li>When the number of objects stored in the MemTable reaches a threshold, the contents of the MemTable are <strong>flushed to disk</strong> in a file called <strong>SSTable</strong><ul><li>At this point, a new MemTable is created to store subsequent data</li><li>The flush is non blocking operation</li><li>Multiple Memtables may exist for a single table<ul><li>One current, and the rest waiting to be flushed</li></ul></li><li>When the MemTable is flushed to SStables, <strong>corresponding entries in the commit log</strong> are removed</li></ul></li><li>SStable â€”Sorted String Table<ul><li>Once a MemTable is flushed to disk as an SStable, it is immutable and cannot be changed later</li><li>Each delete or update is considered as a new write operation</li></ul></li><li>The current data state of a Cassandra table consists of its MemTables in memory and SSTables on the disk.<ul><li>Therefore, on reads, Cassandra will read both SSTables and MemTables to find data values, as the MemTable may contain values that have not yet been flushed to the disk.</li><li>The MemTable works like a write-back cache that Cassandra looks up by key</li></ul></li></ul><p><img src="https://i.loli.net/2021/09/17/Qd7x4M6HRrtuAoZ.png" alt="Whole Write Path"></p><h2 id="3-5-Anatomy-of-Cassandraâ€™s-Read-Operation"><a href="#3-5-Anatomy-of-Cassandraâ€™s-Read-Operation" class="headerlink" title="3.5 Anatomy of Cassandraâ€™s Read Operation"></a>3.5 Anatomy of Cassandraâ€™s Read Operation</h2><p><img src="https://i.loli.net/2021/09/17/wIZKE97YqVNAsrP.png" alt="Whole Read Path"></p><h3 id="3-5-1-Caching"><a href="#3-5-1-Caching" class="headerlink" title="3.5.1 Caching"></a>3.5.1 Caching</h3><ul><li>Row Cache<ul><li>Cache frequently read/ hot rows</li><li>Stores a complete data row, which can be returned directly to the client if requested by a read operation</li><li>Could significantly speed up read access for frequently accessed rows, at the cost of more memory usage</li></ul></li><li>Key Cache<ul><li>Stores a map of recently read partition keys to their <strong>SSTable offsets</strong></li><li>This facilitates faster read access into SSTables and improves the read performance</li><li>Use less memory comparing with row cache and provides a considerable improvement for read operations</li></ul></li><li>Chunk Cache<ul><li>Chunk Cache is used to store umcompressed chunks of data read from SSTable files that are accessed frequently</li></ul></li></ul><h3 id="3-5-2-Read-From-MemTable"><a href="#3-5-2-Read-From-MemTable" class="headerlink" title="3.5.2 Read From MemTable"></a>3.5.2 Read From MemTable</h3><ul><li>When a read request come in, node performs a binary search on the partition key to find the required partition and then return the row</li></ul><h3 id="3-5-3-Read-From-SSTable"><a href="#3-5-3-Read-From-SSTable" class="headerlink" title="3.5.3 Read From SSTable"></a>3.5.3 Read From SSTable</h3><ul><li><p>Bloom Filters</p><ul><li>Each SSTable has a Bloom Filter associated with it, which tells if a particular key is present in it or not</li><li>Used to boost performance of read operations</li><li>Itâ€™s a very fast, non deterministic algorithms for testing whether an element is a member of a set</li><li>Itâ€™s possible to get a false positive but never a false negative</li><li>Theory<ul><li>It works by <strong>mapping the values in a data set into a bit array</strong> and <strong>condensing a larger data set into a digest string</strong> with a hash function</li><li>Filters are stored in memory and are used to improve performance by reducing the need for disk access on key lookups</li></ul></li></ul></li><li><p>How are SSTables stored on the disk?</p><ul><li><p>Consists of two files</p><ul><li><p>Data File</p><ul><li>Actual data is stored here</li><li>It has partitions and rows associated with those partitions</li><li>Partitions are in sorted order</li></ul></li><li><p>Partition Index File</p><ul><li><p>Stored on disk, partition index file stores the sorted partition keys mapped to their SSTable offsets</p></li><li><p>Enable locating a partition exactly in an SSTable rather than scanning data</p><p><img src="https://i.loli.net/2021/09/17/9gUpTXZyLSksDdK.png" alt="Read via Partition Index File"></p></li></ul></li></ul></li></ul></li><li><p>Partition Index Summary File</p><ul><li><p>Itâ€™s stored in memory, stores the summary of the partition index file for performance improvement</p><ul><li><p>Two level index, e.g, search for key=19</p></li><li><p>in partition index summary file, it lays to key range 10 - 21</p></li><li><p>then we could go to byte offset 32,</p></li><li><p>in partition index file , we start from 32, to find partition key 19, and then we could go to 5450</p><p><img src="https://i.loli.net/2021/09/17/efsVEmvGAkIldF6.png" alt="Read via Partition Index Summary File"></p></li></ul></li></ul></li><li><p>Read from KeyCache</p><ul><li><p>As the Key Cache stores a map of recently read partition keys to their SSTable offset, itâ€™s the fastest way to find the required row in the SSTable</p><p>  <img src="https://i.loli.net/2021/09/17/5KPTohGmWpecr1a.png" alt="Read From KeyCache"></p></li></ul></li><li><p>Overall workflow</p><p>  <img src="https://i.loli.net/2021/09/17/2zKlRtS48NQYkud.png" alt="Overall Workflow"></p></li></ul><h2 id="3-6-Compaction"><a href="#3-6-Compaction" class="headerlink" title="3.6 Compaction"></a>3.6 Compaction</h2><h3 id="3-6-1-Why-we-need-compaction-And-How-it-Works"><a href="#3-6-1-Why-we-need-compaction-And-How-it-Works" class="headerlink" title="3.6.1 Why we need compaction? And How it Works?"></a>3.6.1 Why we need compaction? And How it Works?</h3><p><img src="https://i.loli.net/2021/09/17/2DgirVjkeq6AI4T.png" alt="Compaction"></p><ul><li>SSTables are immutable, which helps Cassandra achieve high write speeds</li><li>And flushing from MemTable to SSTable is a continuous process, which means we could have a large number of SSTables lying on the disk</li><li>Itâ€™s tedious to scan all these SSTables while reading</li><li>We need compaction thus we could merge multiple related SSTables into a single one to improve reading speed</li><li>During compaction, the data in SSTables is merged, keys are merged, columns are combined, obsolete values are discarded, and a new index is created</li></ul><h3 id="3-6-2-Compaction-Strategies"><a href="#3-6-2-Compaction-Strategies" class="headerlink" title="3.6.2 Compaction Strategies"></a>3.6.2 Compaction Strategies</h3><ul><li>SizeTiered Compaction Strategy<ul><li>Suitable for insert-heavy and general workloads</li><li>Triggered when multiple SSTables of a similar size are present</li></ul></li><li>Leveled Compaction Strategy<ul><li>Optimize read performance</li><li>Groups SSTables into levels, each of which has a fixed size limit which is ten times larger than the previous level</li></ul></li><li>Time Window Compaction Strategy<ul><li>Work on time series data</li><li>Compact SSTables within a configured time window</li><li>Ideal for time series data which is immutable after a fixed time interval</li></ul></li></ul><h3 id="3-6-3-Sequential-Writes"><a href="#3-6-3-Sequential-Writes" class="headerlink" title="3.6.3 Sequential Writes"></a>3.6.3 Sequential Writes</h3><ul><li>Main reason that writes perform so well in Cassandra</li><li>No reads or seeks of any kind are required for writing a value to Cassandra because all writes are append operations</li><li>Compaction is intended to amortize the reorganization of data, but it uses sequential I/O to do so, which makes it efficient</li></ul><h2 id="3-7-Tombstones"><a href="#3-7-Tombstones" class="headerlink" title="3.7 Tombstones"></a>3.7 Tombstones</h2><h3 id="3-7-1-What-are-Tombstones"><a href="#3-7-1-What-are-Tombstones" class="headerlink" title="3.7.1 What are Tombstones?"></a>3.7.1 What are Tombstones?</h3><ul><li>Scenario<ul><li>We delete some data for a node that is down or unreachable, it would miss a delete</li><li>When the node com back online later and a repair occurs, the node could resurrect the data due to re-sharing it with other nodes</li><li>To prevent deleted data from being reintroduced, Cassandra used a concept of a Tombstone</li></ul></li><li>Tombstone<ul><li>Similar to the idea of soft delete from the relational database</li><li>When we delete, Cassandra does not delete it right away, instead, it associated a tombstone with it, with Time to Expiry</li><li>Itâ€™s a marker to indicate data that has been deleted</li><li>When we execute a delete operation, data is not immediately deleted</li><li>Instead, itâ€™s treated as an update operation that places a tombstone on the value</li><li>Default Time to Expiry is set to 10 days<ul><li>If the node is down longer than this value, it should be treated as failed and replaced</li></ul></li><li>Tombstones are removed as part of compaction</li></ul></li></ul><h3 id="3-7-2-Common-problems-associated-with-Tombstones"><a href="#3-7-2-Common-problems-associated-with-Tombstones" class="headerlink" title="3.7.2 Common problems associated with Tombstones"></a>3.7.2 Common problems associated with Tombstones</h3><ul><li>Takes storage space</li><li>When a table accumulates many tombstones, read queries on that table could become slow and can cause serious performance problems like timeouts.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2021/09/17/IGdzKBJwD9TbZ6f.png&quot; alt=&quot;Cassandra MindMap.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introdu
      
    
    </summary>
    
    
      <category term="SystemDesign" scheme="https://www.llchen60.com/categories/SystemDesign/"/>
    
    
      <category term="Cassandra" scheme="https://www.llchen60.com/tags/Cassandra/"/>
    
  </entry>
  
  <entry>
    <title>Logical Fallacies</title>
    <link href="https://www.llchen60.com/Logical-Fallacies/"/>
    <id>https://www.llchen60.com/Logical-Fallacies/</id>
    <published>2021-09-12T01:23:39.000Z</published>
    <updated>2021-09-12T01:50:35.560Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Logical-Fallacies"><a href="#Logical-Fallacies" class="headerlink" title="Logical Fallacies"></a>Logical Fallacies</h1><h2 id="Overconfidence"><a href="#Overconfidence" class="headerlink" title="Overconfidence"></a>Overconfidence</h2><ul><li>Overconfidence â€” wishful thinking bias<ul><li>most people think they are above avg</li><li>overestimate possibilities that they want to happen</li><li><strong>this could explain the trade in financial market</strong></li><li>overconfidence in friends and leaders</li></ul></li></ul><h2 id="Cognitive-Dissonance"><a href="#Cognitive-Dissonance" class="headerlink" title="Cognitive Dissonance"></a>Cognitive Dissonance</h2><ul><li>Cognitive Dissonance  è®¤çŸ¥å¤±è°ƒ<ul><li>this concept used to describe the mental discomfort that results from holding two conflicting beliefs, values or attitudes</li><li>People tend to seek consistency in their attitudes and perceptions, so this conflict causes feelings of unease or discomfort</li><li>This inconsistency between <strong>what people believe and how they behave</strong> motivates people to <strong>engage in actions</strong> that will help minimize feelings of discomfort</li><li>when we made decision, most people will still look for info about it, to self prove hisself rightâ€¦ in a lot different aspectsâ€¦ to make themselves happy, and to prove they are make right decision</li><li>disposition effect â€” gonna avoid that</li><li>whatâ€™s the causes for that?<ul><li>Forced Compliance<ul><li>Engaging in behaviors that are opposed to your own beliefs due to external expectations, often for work, school, or a social situation</li></ul></li><li>New Information</li><li>Decisions<ul><li>People make decisions both large and small, on a daily basis</li><li>When faced with two similar choices, people often are left with feelings of dissonance because both options are equally appealing</li><li>Once they make decisions, people need to find a way to <strong>reduce feelings of discomfort</strong></li><li>Accomplish by justifying why their choice was the best option so that they can believe they made the right decision</li></ul></li></ul></li></ul></li></ul><h2 id="Mental-Compartments"><a href="#Mental-Compartments" class="headerlink" title="Mental Compartments"></a>Mental Compartments</h2><ul><li>Mental compartments<ul><li>people donâ€™t look at whole portfolio, in fact, people has two or more portfolio<ul><li>usually they have a safe part and a risky part</li></ul></li></ul></li></ul><h2 id="Attention-Anomalies"><a href="#Attention-Anomalies" class="headerlink" title="Attention Anomalies"></a>Attention Anomalies</h2><ul><li>Attention Anomalies<ul><li>We cannot pay attention to anything</li><li>Attention is fundamental aspect of human intelligence and its limits</li><li>Social Basis for attention<ul><li>We incline to pay more attention to what other s pay attention to</li></ul></li></ul></li></ul><h2 id="Anchoring"><a href="#Anchoring" class="headerlink" title="Anchoring"></a>Anchoring</h2><ul><li>Anchoring<ul><li>A tendency in ambiguous situations to allow oneâ€™s decisions to be affected by some anchor</li><li>Our subconscious will do anchoring for us, lol</li><li>subjects unaware of their own anchoring behavior</li><li>stock prices anchored to past values, or to other stock in same market</li></ul></li></ul><h2 id="Representativeness-Heuristic"><a href="#Representativeness-Heuristic" class="headerlink" title="Representativeness Heuristic"></a>Representativeness Heuristic</h2><ul><li>Representativeness Heuristic<ul><li>People judge by similarity to familiar types, without regard to <strong>base rate probabilities</strong><ul><li>For example, we describe a person as artist, and skeptical, then whatâ€™s the highest possible occupation of him/ her?<ul><li>two choice: banker, and sculptress</li><li>should be banker, cause there are so many more bank tellers than sculptresses</li></ul></li></ul></li><li>Tendency to see patterns in what is really random walk</li><li>Stock price manipulators try to create patterns to fool investors</li></ul></li></ul><h2 id="Disjunction-Effect"><a href="#Disjunction-Effect" class="headerlink" title="Disjunction Effect"></a>Disjunction Effect</h2><ul><li>inability to make decisions in advance in anticipation of future information</li></ul><h2 id="Magical-Thinking-amp-Quasi-Magical-Thinking"><a href="#Magical-Thinking-amp-Quasi-Magical-Thinking" class="headerlink" title="Magical Thinking  &amp; Quasi Magical Thinking"></a>Magical Thinking  &amp; Quasi Magical Thinking</h2><ul><li>Some coincidence lead you to build superstitious, but there are actually no karma (cause and effect)</li><li>Belief that unrelated events are causally connected despite the absence of any plausible causal link between them, particularly as a result of supernatural effects.</li><li>E.G<ul><li>For voting, though our vote actually has basically 0 possibility to influence president election, but a lot people do it</li><li>For lottery, we somehow put more money if we select the number</li></ul></li></ul><h2 id="Personality-Disorders"><a href="#Personality-Disorders" class="headerlink" title="Personality Disorders"></a>Personality Disorders</h2><ul><li>culture and social contagion â€” collective memory<ul><li>same effect, same memory, then similar decisions</li></ul></li><li>Antisocial Personality Disorder</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Logical-Fallacies&quot;&gt;&lt;a href=&quot;#Logical-Fallacies&quot; class=&quot;headerlink&quot; title=&quot;Logical Fallacies&quot;&gt;&lt;/a&gt;Logical Fallacies&lt;/h1&gt;&lt;h2 id=&quot;Overc
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>æŠ—é€†åŠ›</title>
    <link href="https://www.llchen60.com/%E6%8A%97%E9%80%86%E5%8A%9B/"/>
    <id>https://www.llchen60.com/%E6%8A%97%E9%80%86%E5%8A%9B/</id>
    <published>2021-08-28T04:28:59.000Z</published>
    <updated>2022-07-01T14:07:08.744Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¾ˆåº†å¹¸å¬äº†è¿™åœºè®²åº§ï¼Œå›æƒ³èµ·åŸå…ˆåšçš„ä¸€äº›å†³å®šï¼Œä¼šå›¿äºå›ºå®šæ€§æ€ç»´ï¼Œå› ä¸ºå®³æ€•å¤±è´¥ï¼Œå®³æ€•è¢«è¯å®ä¸å¤Ÿèªæ˜ï¼Œå¤±å»äº†å¾ˆå¤šå¾ˆå¤šæˆé•¿çš„æœºä¼šã€‚æ„Ÿè§‰æ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»ï¼Œåœ¨åº¦è¿‡äº†åˆšåˆšå¼€å§‹çš„ç†Ÿæ‚‰äº†è§£é˜¶æ®µä»¥åï¼ŒåæœŸé™¤äº†ä¸“ä¸šæŠ€èƒ½ä¸Šçš„æå‡ä¹‹å¤–ï¼Œæ›´åŠ é‡è¦çš„æ˜¯mindsetçš„æå‡ â€” å…³äºä½ æ˜¯æ€ä¹ˆçœ‹å¾…è‡ªå·±çš„ï¼Œæ€ä¹ˆçœ‹å¾…ä½ ç»å†çš„äº‹æƒ…ã€‚ä¸çŸ¥é“æœ€ç»ˆç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯è¿™ç¯‡é‡Œé¢è¯´çš„ä¸œè¥¿è‡³å°‘å‘Šè¯‰äº†æˆ‘æƒ³è¦è¾¾åˆ°ç†æƒ³çš„çŠ¶æ€ï¼Œä½ éœ€è¦æ¯å¤©åšäº›ä»€ä¹ˆ :)  å€¼å¾—è¿‡ä¸€æ®µæ—¶é—´å›æ¥å†çœ‹çœ‹å„ç§action items å‘€</p></blockquote><h1 id="1-å¿ƒç†éŸ§æ€§"><a href="#1-å¿ƒç†éŸ§æ€§" class="headerlink" title="1. å¿ƒç†éŸ§æ€§"></a>1. å¿ƒç†éŸ§æ€§</h1><ul><li>é«˜å¿ƒç†éŸ§æ€§æ˜¯æˆåŠŸè€…çš„å…±æ€§<ul><li>å› ä¸ºå¯¹äºä»»ä½•ä¸€ä¸ªæˆåŠŸè€…æ¥è¯´ï¼Œç£¨éš¾æ˜¯å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†</li><li>æˆåŠŸè€… åšéŸ§ä¸æ‹”çš„ç²¾ç¥</li><li>å¿ƒç†å­¦ç ”ç©¶<ul><li>é¢„æµ‹æˆåŠŸçš„æ¦‚ç‡ å’Œ åšéŸ§ä¸æ‹”çš„ç‰¹è´¨æœ‰å¾ˆæ˜æ˜¾çš„æ­£ç›¸å…³ï¼Œå’Œæ™ºå•†çš„å…³ç³»åå€’å¹¶ä¸æ˜¯å¾ˆå¼º</li><li>ç”Ÿå­˜ä¸‹æ¥çš„ä¸æ˜¯æœ€å¼ºå¤§çš„ç”Ÿç‰©ï¼Œä¹Ÿä¸æ˜¯æœ€èªæ˜çš„ç”Ÿç‰©ï¼Œè€Œæ˜¯æœ€èƒ½å¤Ÿé€‚åº”å˜åŒ–çš„ç”Ÿç‰©</li></ul></li></ul></li></ul><h2 id="1-1-å¿ƒç†å­¦å®šä¹‰"><a href="#1-1-å¿ƒç†å­¦å®šä¹‰" class="headerlink" title="1.1 å¿ƒç†å­¦å®šä¹‰"></a>1.1 å¿ƒç†å­¦å®šä¹‰</h2><ul><li>å¤åŸåŠ› resilence<ul><li>äººä»é€†å¢ƒï¼Œå†²çªï¼Œç—›æ¥šï¼Œå¤±è´¥ï¼Œå‹åŠ›å½“ä¸­è¿…é€Ÿæ¢å¤çš„å¿ƒç†èƒ½åŠ›</li></ul></li><li>åšæ¯…åŠ› grip</li><li>åˆ›ä¼¤åçš„æˆé•¿ PTG â€” Post Traumatic Growth<ul><li>ä¸æ¶ˆæ²‰ï¼Œå¥‹è¿›</li></ul></li></ul><h2 id="1-2-é«˜å¿ƒç†éŸ§æ€§äººçš„ç‰¹è´¨"><a href="#1-2-é«˜å¿ƒç†éŸ§æ€§äººçš„ç‰¹è´¨" class="headerlink" title="1.2 é«˜å¿ƒç†éŸ§æ€§äººçš„ç‰¹è´¨"></a>1.2 é«˜å¿ƒç†éŸ§æ€§äººçš„ç‰¹è´¨</h2><ul><li>èƒ½åŠ›<ul><li>é€‚åº”åŠ›</li><li>æˆé•¿åŠ›</li><li>æŠ—æŒ«åŠ›</li><li>ç§¯æåŠ› â€” æƒ…ç»ªçš„è°ƒèŠ‚çš„æ–¹æ³•</li><li>å…³ç³»åŠ› â€” å¦‚ä½•å»ºç«‹å…³ç³»</li><li>æ§åˆ¶åŠ› â€” æ·¡å®šä»å®¹ï¼Œè‡ªæˆ‘æ§åˆ¶</li></ul></li><li>ç‰¹è´¨<ul><li>æœ‰ç§¯æçš„è®¤çŸ¥æ–¹å¼  â€” the power of positive thinking<ul><li>å†³å®šæˆ‘ä»¬çš„å¹¸ç¦æŒ‡æ•°çš„ä¸æ˜¯äº‹æƒ…æœ¬èº«ï¼Œè€Œæ˜¯æˆ‘ä»¬å¦‚ä½•çœ‹å¾…è¿™ä¸ªäº‹æƒ…</li></ul></li><li>ä¹è§‚çš„æƒ…ç»ªè°ƒèŠ‚</li><li>å¥åº·çš„èº«å¿ƒçŠ¶æ€</li><li>å¼ºå¤§çš„è‡ªæˆ‘æ•ˆèƒ½æ„Ÿ  â€” æ„Ÿè§‰è‡ªå·±èƒ½æˆï¼Œæ„Ÿè§‰è‡ªå·±æœ‰ç”¨  lol<ul><li>ç»“å©šèƒ½è®©ç”·æ€§é•¿å¯¿7å¹´ lol</li></ul></li><li>è§£å†³é—®é¢˜çš„è¡ŒåŠ¨ç²¾ç¥</li><li>è‰¯å¥½çš„äººé™…å…³ç³»</li></ul></li></ul><h1 id="2-å¦‚ä½•æå‡å¿ƒç†éŸ§æ€§"><a href="#2-å¦‚ä½•æå‡å¿ƒç†éŸ§æ€§" class="headerlink" title="2. å¦‚ä½•æå‡å¿ƒç†éŸ§æ€§"></a>2. å¦‚ä½•æå‡å¿ƒç†éŸ§æ€§</h1><h2 id="2-1-è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„æå‡"><a href="#2-1-è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„æå‡" class="headerlink" title="2.1 è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„æå‡"></a>2.1 è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„æå‡</h2><ul><li>è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„æå‡ Self Efficacy<ul><li>å®šä¹‰ â€” æ˜¯ä¸ªäººå¯¹è‡ªå·±å®ŒæˆæŸæ–¹é¢å·¥ä½œèƒ½åŠ›çš„ä¸»è§‚è¯„ä¼°ï¼Œé€šè¿‡ä¸¤æ¡è·¯å¾„ä½“ç°å‡ºæ¥</li><li>é«˜è‡ªæˆ‘æ•ˆèƒ½æ„Ÿçš„äººï¼Œç”šè‡³ä¼šæŠŠå‹åŠ› æŒ«æŠ˜ æ‰“å‡»å½“åšä¸€ç§è¯æ˜è‡ªå·±çš„èƒ½åŠ›çš„æœºé‡</li><li>ä½“ç°è·¯å¾„<ul><li>ç»“æœé¢„æœŸ<ul><li>ç›¸ä¿¡è‡ªå·±ï¼Œè®¤ä¸ºæˆ‘å¯ä»¥åšåˆ°ï¼Œæ˜¯ä¸€ç§è‡ªæˆ‘å®ç°çš„é¢„è¨€</li></ul></li><li>æ•ˆèƒ½é¢„æœŸ<ul><li>æˆ‘è®¤ä¸ºæˆ‘èƒ½åšåˆ°ä¸æ˜¯å› ä¸ºè¿æ°”å¥½æˆ–è€…ç¯å¢ƒå¥½ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘çš„èƒ½åŠ›</li><li>å› æ­¤æˆ‘è¦æ–½å±•æˆ‘çš„èƒ½åŠ›ï¼Œä¸ºç»“æœåšè¶³å‡†å¤‡</li></ul></li></ul></li></ul></li><li>å¦‚ä½•å»åš<ul><li>åšå‡ºæˆåŠŸçš„æ¨¡æ ·<ul><li>è£…ç§¯æï¼Œæ˜¯ä¼šå˜æˆçœŸç§¯æçš„</li><li>æ­¥ä¼æ›´å¿«</li><li>è¯´è¯æ›´å¤š</li><li>åšäº‹ä¸»åŠ¨</li><li>ç©¿è¡£æ›´æ­£å¼äº›</li><li>é”»ç‚¼æ›´é¢‘ç¹äº›</li></ul></li><li>è¢«æˆåŠŸè€…æ¥çº³<ul><li>ä¸ç§¯æçš„äººåŒè¡Œ</li><li>æ›¿ä»£æ€§å¼ºåŒ–<ul><li>è§‚å¯Ÿè€…çœ‹åˆ°æ¦œæ ·æˆ–è€…ä»–äººæ”¶åˆ°å¼ºåŒ–ï¼ŒæˆåŠŸäº†; ä»è€Œä½¿å¾—è‡ªå·±ä¹Ÿå€¾å‘äºåšå‡ºæ¦œæ ·çš„è¡Œä¸º</li></ul></li></ul></li><li>ç¤¾ä¼šæ”¯æŒ<ul><li>è¿›åŒ–é€‰æ‹©çš„æ˜¯åˆä½œè€…</li><li>ç¤¾ä¼šç½‘ç»œé¢ç§¯è¶Šå¤§ï¼Œæ›´å®¹æ˜“äº§ç”Ÿä¼˜åŠ¿æ•ˆåº”</li><li><strong>å¼±è”ç³»çš„å¼ºåŠ¿æ•ˆåº”</strong><ul><li>å¼±è”ç³»æœ‰ç€å¾ˆå¿«çš„ä½æˆæœ¬å’Œé«˜æ•ˆèƒ½çš„ä¼ æ’­æ•ˆç‡</li><li>åœ¨å…­åº¦åˆ†éš”è¯•éªŒå½“ä¸­ï¼Œæ­£æ˜¯å±‚å±‚å åŠ çš„å¼±è”ç³»å°†ä¸–ç•Œä¸ŠåŸæœ¬æ¯«ä¸ç›¸å…³çš„äººè”ç³»åˆ°äº†ä¸€èµ·</li></ul></li></ul></li><li>æ¨¡æ‹Ÿå®æˆ˜<ul><li>é¢„è§</li><li>å¤§è„‘ä¼‘é—²çš„æ—¶å€™å¤„äºé»˜è®¤æ¨¡å¼çŠ¶æ€  hh<ul><li>ä¼šç•…æƒ³æœªæ¥ï¼Œæ˜¯ä¸€ç§ç«äº‰ä¼˜åŠ¿çš„~</li><li>å¯¹äºäº‹æƒ…è¿›è¡Œé‡è§ï¼Œæ˜¯å¯¹æˆ‘ä»¬å¸®åŠ©å¾ˆå¤§çš„</li></ul></li><li>Visualization  é¢„è§æƒ³è±¡<ul><li>å°†è‡ªå·±å°†è¦åšçš„äº‹æƒ…å»æå‰æƒ³è±¡ä¸€ä¸‹</li><li>è¿‡ä¸€éè‡ªå·±éœ€è¦æ€ä¹ˆåš</li><li>è®­ç»ƒè¶Šå¤šï¼Œæ„å‘è¶Šæ¸…æ™°</li><li>è®¾æƒ³é‡åˆ°æ‰“å‡»ï¼Œå›°éš¾çš„æ—¶å€™ä½ è¦æ€ä¹ˆåš</li></ul></li></ul></li><li>ä¸æ–­ç§¯ç´¯æˆåŠŸ<ul><li>äººæœ€å¯æ€•çš„æ˜¯å‘ç°è‡ªå·±ä¸€æˆä¸å˜</li><li>è¦å»åš</li></ul></li></ul></li></ul><h2 id="2-2-åŸ¹å…»æˆé•¿æ€§æ€ç»´"><a href="#2-2-åŸ¹å…»æˆé•¿æ€§æ€ç»´" class="headerlink" title="2.2 åŸ¹å…»æˆé•¿æ€§æ€ç»´"></a>2.2 åŸ¹å…»æˆé•¿æ€§æ€ç»´</h2><ul><li><p>äººçš„æ€ç»´æ¨¡å¼</p><ul><li>æˆé•¿æ€§æ€ç»´  Growth Mindset<ul><li>å¤©èµ‹åªæ˜¯èµ·ç‚¹</li><li>æ€åº¦å’ŒåŠªåŠ›å¯ä»¥å†³å®šä¸€åˆ‡</li><li>å¯ä»¥å­¦ä¼šä»»ä½•æˆ‘æƒ³å­¦ä¼šçš„ä¸œè¥¿</li><li>å–œæ¬¢è‡ªæˆ‘æŒ‘æˆ˜</li><li>å½“æˆ‘å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿</li><li>æˆ‘å¸Œæœ›ä½ è¡¨æ‰¬æˆ‘å¾ˆåŠªåŠ›</li><li>å¦‚æœåˆ«äººæˆåŠŸäº†ï¼Œæˆ‘ä¼šæ”¶åˆ°åˆ«äººçš„å¯å‘</li></ul></li><li>å›ºå®šæ€§æ€ç»´ â€” å“è¶Šçš„åŒ…è¢±<ul><li>æˆ‘çš„èªæ˜æ‰æ™ºå†³å®šäº†ä¸€åˆ‡</li><li>æˆ‘æ“…é•¿æŸäº›äº‹ï¼Œä¸æ“…é•¿å¦å¤–ä¸€äº›äº‹</li><li>æˆ‘ä¸æƒ³å°è¯•æˆ‘å¯èƒ½ä¸æ“…é•¿çš„ä¸œè¥¿</li><li>å¦‚æœæˆ‘å¤±è´¥äº†ï¼Œæˆ‘å°±æ— åœ°è‡ªå®¹äº†</li><li>æˆ‘å¸Œæœ›ä½ è¡¨æ‰¬æˆ‘å¾ˆèªæ˜</li><li>å¦‚æœåˆ«äººæˆåŠŸäº†ï¼Œä»–ä¼šå¨èƒåˆ°æˆ‘</li></ul></li></ul></li><li><p>å›ºå®šæ€§æ€ç»´å¯¹äºäººçš„å½±å“å¾ˆå¤§</p><ul><li>ä½ ä¼šå› ä¸ºè®¤ä¸ºè‡ªå·±èªæ˜ï¼Œä¸æ•¢åšæ›´å¤§çš„æŒ‘æˆ˜ï¼Œå› ä¸ºä¸€æ—¦å¤±è´¥ï¼Œä½ ä¼šå®³æ€•åˆ«äººè®¤ä¸ºä½ ä¸èªæ˜äº† ä¼šè¶Šæ¥è¶Šéš¾è¾¾åˆ°åˆ«äººçš„é¢„æœŸçš„</li><li>è¢«è¡¨æ‰¬åŠªåŠ›çš„å¾€å¾€ä¼šé€‰æ‹©æ›´åŠ å›°éš¾çš„ä»»åŠ¡ï¼Œä¹Ÿä¼šæ›´æ„¿æ„é€šè¿‡å­¦ä¹ ï¼Œå»å°è¯•è§£å†³æ–¹æ¡ˆ</li><li>å“è¶Šçš„åŒ…è¢±<ul><li>è£…é…·çš„å­©å­çš„åŒ…è¢±</li><li>ä¸æ„¿æ„å»å†’é™©ï¼Œä¸æ„¿æ„å»å¥‹æ–—</li><li>åŠªåŠ›æ„šè ¢ï¼Œè£…èªæ˜</li><li>ç²¾è‹±çˆ¶æ¯çš„è¿‡é«˜çš„æœŸæœ›é€ æˆçš„å¿ƒç†å‹åŠ›å’Œå¿ƒç†é˜´å½±</li><li>ä¼˜ç§€å¥³å­©çš„è¯…å’’ï¼Œè¿™ç§åŒ…è¢±å¾€å¾€å¯¹å¥³å­©çš„æ‰“å‡»æ›´å¤§ï¼Œå¥¹ä»¬å¾€å¾€æ›´åœ¨æ„å¤–åœ¨çš„è¯„ä»·ï¼Œä¸æ•¢å†’é™©å’ŒåŠªåŠ›</li><li>we are supposed to be dumb all the way, hhh</li></ul></li></ul></li><li><p>å¦‚ä½•åŸ¹å…»æˆé•¿æ€§æ€ç»´</p><ul><li>æ”¹å˜è€ƒæ ¸çš„æ ‡å‡†<ul><li>å…³æ³¨è¿›æ­¥ï¼Œè€Œä¸æ˜¯ç»“æœ</li></ul></li><li>æ”¹å˜æ²Ÿé€šçš„æ–¹å¼<ul><li>åœ¨è¯„ä»·è¡¨ç°çš„æ—¶å€™ï¼Œç”¨æš‚æ—¶ä¸è¡Œä»£æ›¿å°±æ˜¯ä¸è¡Œ</li><li>çŸ­æš‚ å±€éƒ¨ å¯ä»¥æ”¹çš„</li><li>ä¸è¦æŠŠäº‹æƒ…è¯´æˆç¨³å®šçš„é•¿æœŸçš„ä¸å¯æ”¹å˜çš„</li><li>not yet instead of failed</li></ul></li><li>æ”¹å˜è®¤çŸ¥çš„ä¹ æƒ¯ â€” Albert Ellis çš„è®¤çŸ¥æ²»ç–—ABC</li><li>å‘æŒ¥è¾©è¯æ€ç»´çš„ä¼˜åŠ¿ â€” ä»è´Ÿé¢ä½“éªŒä¸­å¸å–æˆåŠŸçš„ç»éªŒ<ul><li>å½“ä¸€ä¸ªäººå‡ºäºè‡ªæˆ‘ä¿æŠ¤è€ŒæŠ—æ‹’å†…å¿ƒçš„åœ°ç‹±çš„æ—¶å€™ï¼Œä»–ä¸€å¹¶åˆ‡æ–­äº†é€šå¾€å†…åœ¨å¤©å ‚çš„é“è·¯ã€‚<ul><li>ä¸æ‰¿è®¤è‡ªå·±å†…å¿ƒçš„é˜´æš—é¾Œé¾Šï¼Œé‚£ä¹ˆå°±æ— ä»æ”¹è¿›äº†</li></ul></li></ul></li></ul></li></ul><ul><li>è®¤çŸ¥æ²»ç–—ABC<ul><li>æ„æˆ<ul><li>A â€” Activating Events  è¯±å‘åˆºæ¿€</li><li>B â€” Beliefs  ä¿¡å¿µååº”</li><li>C â€” Consequences  è¡Œä¸ºåæœ</li></ul></li><li>åŸç†<ul><li>æˆ‘ä»¬æ˜¯æ”¹ä¸äº†Açš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ”¹Bï¼Œç„¶åCå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼ï¼</li><li>å…³é”®æ˜¯ä½ æ€ä¹ˆçœ‹å¾…Açš„ ï¼ æ”¹å˜è®¤çŸ¥</li><li>çœŸæ­£å›°æ‰°æˆ‘ä»¬çš„å¹¶ä¸æ˜¯å‘ç”Ÿåœ¨æˆ‘ä»¬èº«ä¸Šçš„äº‹æƒ…ï¼Œè€Œæ˜¯æˆ‘ä»¬å›´ç»•è¿™ä¸ªäº‹æƒ…å¯¹å®ƒç¼–ç»‡çš„æ•…äº‹ï¼Œå’Œç”±æ­¤å¼•èµ·çš„èº«å¿ƒååº”</li></ul></li></ul></li><li>æƒ…ç»ªçš„ABCDç†è®º â€” å¯¹äºå­©å­è€Œè¨€<ul><li>å‡ºç°äº†ABCä»¥åï¼Œç»™ä¸€ä¸ªæœºä¼šè®©å…¶åé©³</li><li>è®©å­©å­å»åé©³ä»–å½“æ—¶çš„å¿µå¤´</li><li>å¹²é¢„B  ä»è€Œå¹²é¢„C</li></ul></li></ul><h2 id="2-3-æé«˜è‡ªæˆ‘è°ƒæ§çš„èƒ½åŠ›"><a href="#2-3-æé«˜è‡ªæˆ‘è°ƒæ§çš„èƒ½åŠ›" class="headerlink" title="2.3 æé«˜è‡ªæˆ‘è°ƒæ§çš„èƒ½åŠ›"></a>2.3 æé«˜è‡ªæˆ‘è°ƒæ§çš„èƒ½åŠ›</h2><ul><li>å»¶è¿Ÿæ»¡è¶³ï¼Œ è‡ªæˆ‘æ§åˆ¶</li><li>è‡ªæˆ‘è°ƒæ§èƒ½åŠ›æ˜¯å¯ä»¥é”»ç‚¼ä»è€Œè·å¾—æå‡çš„</li><li>å¦‚ä½•è¿›è¡Œè®­ç»ƒ<ul><li>ä½“è‚²é”»ç‚¼</li><li>æ­£å¿µå†¥æƒ³ â€” åšäº‹æƒ…æ²‰æµ¸å…¶ä¸­å°±å¥½å•Šï¼ï¼</li><li>è‡ªæˆ‘æŒ‘æˆ˜</li><li>ç›®æ ‡æƒ³è±¡</li><li>æœ‰æ•ˆä¼‘æ¯</li><li>ç§¯æå¿ƒæ€</li></ul></li></ul><h1 id="3-ç»„ç»‡éŸ§æ€§"><a href="#3-ç»„ç»‡éŸ§æ€§" class="headerlink" title="3. ç»„ç»‡éŸ§æ€§"></a>3. ç»„ç»‡éŸ§æ€§</h1><ul><li><p>å¤åŸåŠ›</p><ul><li>ä¼ä¸šé‡åˆ°å›°éš¾åï¼Œå¦‚ä½•å›å½’æ­£å¸¸</li></ul></li><li><p>å¤åŸåçš„å‘å±•èƒ½åŠ›</p></li><li><p>å½±å“ç»„ç»‡éŸ§æ€§çš„ç»´åº¦</p><ul><li>ç»„ç»‡èµ„æœ¬<ul><li>äººåŠ›èµ„æºçš„ä¿éšœ<ul><li>ä»€ä¹ˆæ”¿ç­–</li></ul></li></ul></li><li>ç»„ç»‡æ‰¿è¯º<ul><li>å‘˜å·¥å¯¹äºç»„ç»‡çš„æ„Ÿæƒ…</li><li>ä¿¡ä»»</li></ul></li><li>ç»„ç»‡é¢†å¯¼<ul><li>leaderæœ¬èº«çš„æ€åº¦ï¼Œæ€è€ƒï¼ŒéŸ§æ€§</li></ul></li><li>ç»„ç»‡å­¦ä¹ </li><li>ç»„ç»‡æ–‡åŒ–<ul><li>ç»„ç»‡çš„ä¼ ç»Ÿå’Œä¿¡ä»°</li></ul></li><li>ç¤¾ä¼šç½‘ç»œ</li></ul></li><li><p>æå‡ç»„ç»‡éŸ§æ€§çš„æ–¹å¼</p><ul><li>Staff  é€‰æ‹©å¿ƒç†éŸ§æ€§é«˜çš„äººæ‰ï¼Œé”»ç‚¼å¿ƒç†éŸ§æ€§<ul><li>ç§¯æçš„è‡ªæˆ‘è®¤è¯†</li><li>æå€¡ç§¯æçš„æ€ç»´</li><li>åŠ å¼ºå…³ç³»å»ºè®¾</li><li>æœªæ¥å¯¼å‘</li><li>ä¹è§‚ä¸»ä¹‰ç²¾ç¥<ul><li>å¯¹äºè·¯å¾„çš„ä¹è§‚</li><li>å¯¹äºç»“æœçš„ä¹è§‚</li></ul></li></ul></li><li>System åˆ›é€ ç§¯æçš„å¿ƒç†å¥åº·ç¯å¢ƒ</li><li>Skill</li></ul></li></ul><h1 id="4-å‹åŠ›çš„åº”å¯¹æŠ€å·§"><a href="#4-å‹åŠ›çš„åº”å¯¹æŠ€å·§" class="headerlink" title="4. å‹åŠ›çš„åº”å¯¹æŠ€å·§"></a>4. å‹åŠ›çš„åº”å¯¹æŠ€å·§</h1><h2 id="4-1-å‹åŠ›çš„åº”æ¿€ååº”"><a href="#4-1-å‹åŠ›çš„åº”æ¿€ååº”" class="headerlink" title="4.1 å‹åŠ›çš„åº”æ¿€ååº”"></a>4.1 å‹åŠ›çš„åº”æ¿€ååº”</h2><ul><li>åº”æ¿€ååº”çš„ä¸‰è½´å¿ƒ<ul><li>ä¸‹ä¸˜è„‘</li><li>å‚ä½“</li><li>è‚¾ä¸Šè…º</li></ul></li><li>ä¸‰ä¸ªå™¨å®˜ä¼šé‡Šæ”¾å‹åŠ›æ¿€ç´ ï¼Œä½¿å¾—æˆ‘ä»¬çš„ååº”æ˜¯fight or flight lol</li><li>è€Œåæ¿€ç´ æ°´å¹³ä¸‹é™</li><li>å„ç§æƒ…ç»ª<ul><li>ç„¦è™‘  ä¸ºæœªæ¥çš„ææ…Œ</li><li>æŠ‘éƒ  ä¸ºè¿‡å»ä¼¤å¿ƒ</li><li>è‡ªæ®‹</li></ul></li></ul><h2 id="4-2-ä¸æƒ…ç»ªæœ‰å…³çš„è„‘åŒº"><a href="#4-2-ä¸æƒ…ç»ªæœ‰å…³çš„è„‘åŒº" class="headerlink" title="4.2 ä¸æƒ…ç»ªæœ‰å…³çš„è„‘åŒº"></a>4.2 ä¸æƒ…ç»ªæœ‰å…³çš„è„‘åŒº</h2><ul><li><p>æä»æ ¸  Amygdala</p><ul><li>ä¼šå½±å“æˆ‘ä»¬çš„æƒ…ç»ª</li><li>æƒ…ç»ªä¸å¥½çš„æ—¶å€™ä¼šè®©æä»æ ¸å……è¡€ï¼Œç„¶åæä»æ ¸æ¸©åº¦å‡é«˜</li></ul></li><li><p>å¤§è„‘çš®å±‚ Cerebral Cortex</p></li><li><p>å¦‚ä½•åº”å¯¹å‹åŠ› â€” <strong>æŠ‘åˆ¶</strong>æä»æ ¸çš„æ´»åŠ¨</p><ul><li>å¸å…¥å‡‰æ°”ï¼Œé™ä½æä»æ ¸çš„æ¸©åº¦  hhh</li><li>é¦™æ°”  è®©æˆ‘ä»¬äº§ç”Ÿæ„‰æ‚¦çš„æ„Ÿè§‰</li><li>å†™å†™æ—¥è®°</li></ul></li><li><p>æ¿€æ´»å¤§è„‘çš„å¥–åŠ±ä¸­æ¢</p><ul><li><p>ç¥ç»å…ƒä¹‹é—´çš„é—´éš™ é ç¥ç»é€’è´¨è¿æ¥</p></li><li><p>å½“å¥–èµä¸­æ¢é‡Šæ”¾ç¥ç»é€’è´¨çš„æ—¶å€™ï¼Œä¼šé‡Šæ”¾ç§¯æçš„æƒ…ç»ª</p></li><li><p>ï¼ï¼å¿ƒç†æ´»åŠ¨ä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªç‚¹ï¼Œè€Œæ˜¯ä¸€ç‰‡ä¸€ç‰‡çš„äº§ç”Ÿçš„</p></li><li><p>å¤šå·´èƒº</p><ul><li>åº†ç¥è‡ªå·±çš„æˆåŠŸ â€” è®©è‡ªå·±çš„æˆåŠŸå’Œå¿«ä¹çš„ä½“éªŒå»¶ç»­ä¸€æ®µæ—¶é—´<ul><li>å°†å¿«ä¹çš„ä½“éªŒå»¶ç»­4åˆ†é’Ÿï¼Œå°±å¯ä»¥åœ¨å¤§è„‘ä¸­å½¢æˆè®°å¿†ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå¿«ä¹çš„ç¥ç»ç½‘ç»œ</li></ul></li><li>åšè‡ªå·±å–œæ¬¢åšçš„äº‹æƒ…</li><li>äº«å—è‰ºæœ¯çš„ç¾å¦™</li></ul></li><li><p>è¡€æ¸…ç´ </p><ul><li>èƒ½å¤ŸæŒ¯å¥‹äººçš„å¿ƒæƒ…</li><li>ä»€ä¹ˆæ—¶å€™ä¼šåˆ†æ³Œ<ul><li>ä½“éªŒåˆ°è‡ªæˆ‘çš„ä»·å€¼</li><li>å¸®åŠ©åˆ«äººçš„æ—¶å€™</li><li>è‡ªå°Šå¿ƒçš„å‘µæŠ¤<ul><li>ä¿æŠ¤è‡ªå°Šå¿ƒ  ä½“ç°å…¶ä»·å€¼</li></ul></li></ul></li><li>ä¸€äº›è¡Œä¸º<ul><li>æ™’å¤ªé˜³~</li></ul></li></ul></li><li><p>å†…å•¡è‚½</p><ul><li>åªæœ‰æˆ‘ä»¬èº«å¿ƒç—›è‹¦çš„æ—¶å€™ï¼Œæ‰ä¼šé‡Šæ”¾</li><li>è¡Œä¸º<ul><li>æœ‰è§„å¾‹çš„è¿åŠ¨</li><li>å…ˆè‹¦åç”œçš„ä½“éªŒ</li><li>çœ‹å–œå‰§ï¼Œç›¸å£°~ çƒ§è„‘çš„å¹½é»˜</li></ul></li></ul></li><li><p>å‚¬äº§ç´ </p><ul><li>ç”·äººä¹Ÿæœ‰å‚¬äº§ç´ </li><li>ä¸»è¦ä½œç”¨æ˜¯å¢åŠ äººçš„çˆ±çš„æ„Ÿå—ï¼Œè€Œä¸æ˜¯ä¸ºäº†æ€€å­•</li><li>è¡Œä¸º<ul><li>å¤¸å¥–ï¼Œèµç¾</li><li>é™ªä¼´</li></ul></li></ul><h2 id="4-3-åº”å¯¹å‹åŠ›çš„é•¿æœŸç­–ç•¥"><a href="#4-3-åº”å¯¹å‹åŠ›çš„é•¿æœŸç­–ç•¥" class="headerlink" title="4.3 åº”å¯¹å‹åŠ›çš„é•¿æœŸç­–ç•¥"></a>4.3 åº”å¯¹å‹åŠ›çš„é•¿æœŸç­–ç•¥</h2></li><li><p>å‹åŠ›å®¹æ˜“è®©äººå¤±æ§å¤±å¸¸</p></li><li><p>åŸ¹å…»åº”å¯¹å‹åŠ›çš„ç§¯æä¹ æƒ¯</p><ul><li>strength based approach  å‘æŒ¥è‡ªå·±çš„é•¿å¤„ä¼˜åŠ¿  æ‰¾åˆ°è‡ªå·±çš„ä¼˜åŠ¿ï¼Œç„¶åå……åˆ†åœ¨å·¥ä½œç”Ÿæ´»å½“ä¸­ä½¿ç”¨  ä½¿ç”¨è‡ªå·±çš„ä¼˜åŠ¿ï¼ï¼ï¼</li><li>æ‰¾åˆ°è‡ªå·±çš„æµ  find your flow<ul><li>å–œæ¬¢åšçš„äº‹æƒ…ï¼Œè¿›å…¥å¿ƒæµçŠ¶æ€</li></ul></li><li>å€ŸåŠ©ä¸€äº›ç§‘å­¦æ–¹æ³•ï¼Œè‡ªä¿®ï¼ŒåŒä¿®ï¼Œä¸“ä¿®<ul><li>reading &amp; learning</li></ul></li></ul></li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>å½­å‡¯å¹³ æ¼”è®²  â€” æŠ—é€†åŠ›â€” é‡å‹ä¸‹çš„å¿ƒç†éŸ§æ€§ä¸æˆåŠŸ</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å¾ˆåº†å¹¸å¬äº†è¿™åœºè®²åº§ï¼Œå›æƒ³èµ·åŸå…ˆåšçš„ä¸€äº›å†³å®šï¼Œä¼šå›¿äºå›ºå®šæ€§æ€ç»´ï¼Œå› ä¸ºå®³æ€•å¤±è´¥ï¼Œå®³æ€•è¢«è¯å®ä¸å¤Ÿèªæ˜ï¼Œå¤±å»äº†å¾ˆå¤šå¾ˆå¤šæˆé•¿çš„æœºä¼šã€‚æ„Ÿè§‰æ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»ï¼Œåœ¨åº¦è¿‡äº†åˆšåˆšå¼€å§‹çš„ç†Ÿæ‚‰äº†è§£é˜¶æ®µä»¥åï¼ŒåæœŸé™¤äº†ä¸“ä¸šæŠ€èƒ½ä¸Šçš„æå‡ä¹‹å¤–ï¼Œæ›´åŠ é‡è¦çš„æ˜¯mindsetçš„æå‡ â€”
      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
      <category term="ç§¯æå¿ƒç†å­¦" scheme="https://www.llchen60.com/tags/%E7%A7%AF%E6%9E%81%E5%BF%83%E7%90%86%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>Make Body Language Your Super Power</title>
    <link href="https://www.llchen60.com/Make-Body-Language-Your-Super-Power/"/>
    <id>https://www.llchen60.com/Make-Body-Language-Your-Super-Power/</id>
    <published>2021-08-28T02:24:14.000Z</published>
    <updated>2021-08-28T02:25:19.176Z</updated>
    
    <content type="html"><![CDATA[<ul><li>Stand Strong</li><li>Gesture Effectively</li><li>Mind Your Audience</li></ul><h1 id="1-Posture"><a href="#1-Posture" class="headerlink" title="1. Posture"></a>1. Posture</h1><ul><li>Communication begins before you open your mouth</li><li>How to stand<ul><li>no<ul><li>hands in the pocket  â€” cannot convey strong msg</li><li>hands in the hip â€” tend to look overwhelming and powerful</li><li>hands in front of family jewels lol</li></ul></li><li>yes<ul><li>base posture â€” feet should be shoulder width apart<ul><li>thatâ€™s the first impression</li></ul></li><li>movement<ul><li>give</li><li>show</li><li>chop â€” strong msg</li></ul></li><li>palms up has better impact! comparing with palm down and pointing</li></ul></li></ul></li><li>Where to stand<ul><li>face your audience</li><li>move around in the center box</li><li>get rid of potential distraction<ul><li>like window, by nature we are attracted by moving thing, will break the concentration</li></ul></li></ul></li></ul><h1 id="2-Audience"><a href="#2-Audience" class="headerlink" title="2. Audience"></a>2. Audience</h1><ul><li>Speaker need to understand what audience is doing , make sure we are all in the journey</li><li>How to engage with audience more<ul><li>gesture</li><li>notice<ul><li>how your audience sitting</li><li>eye contact</li></ul></li><li>surprise<ul><li>cold call, lol</li></ul></li></ul></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://www.youtube.com/watch?v=cFLjudWTuGQ&ab_channel=StanfordGraduateSchoolofBusiness">https://www.youtube.com/watch?v=cFLjudWTuGQ&amp;ab_channel=StanfordGraduateSchoolofBusiness</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;Stand Strong&lt;/li&gt;
&lt;li&gt;Gesture Effectively&lt;/li&gt;
&lt;li&gt;Mind Your Audience&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-Posture&quot;&gt;&lt;a href=&quot;#1-Posture&quot; class=&quot;hea
      
    
    </summary>
    
    
      <category term="Notes" scheme="https://www.llchen60.com/categories/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Distributed Messaging System: Kafka</title>
    <link href="https://www.llchen60.com/Distributed-Messaging-System-Kafka/"/>
    <id>https://www.llchen60.com/Distributed-Messaging-System-Kafka/</id>
    <published>2021-08-24T17:07:33.000Z</published>
    <updated>2021-08-24T17:10:35.053Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Overview-of-Messaging-Systems"><a href="#1-Overview-of-Messaging-Systems" class="headerlink" title="1. Overview of Messaging Systems"></a>1. Overview of Messaging Systems</h1><h2 id="1-1-Why-we-need-a-messaging-system"><a href="#1-1-Why-we-need-a-messaging-system" class="headerlink" title="1.1 Why we need a messaging system"></a>1.1 Why we need a messaging system</h2><ul><li><p>Aim:</p><ul><li>Reliably transfer a high throughput of messages between different entities</li></ul></li><li><p>Challenges</p><ul><li>how we handle a spike of messages</li><li>how we divide the work among a set of instances</li><li>how could we receive messages from different types of sources</li><li>what will happen if the service is down?</li></ul></li><li><p>We need messaging systems in distributed architecture due to challenges above</p></li></ul><h2 id="1-2-What-is-a-messaging-system"><a href="#1-2-What-is-a-messaging-system" class="headerlink" title="1.2 What is a messaging system?"></a>1.2 What is a messaging system?</h2><ul><li><p>responsible for transferring data among services /applications/ processes/ servers</p></li><li><p>help decouple different parts of a distributed system by providing an asynchronous way of transferring messaging between the sender and the receiver</p></li><li><p>Two common ways to handle messages</p><ul><li>Queuing<ul><li>msgs are stored sequentially in a queue</li><li>producers push msg to the rear of the queue</li><li>consumers extract the msgs from the front of the queue</li><li>a particular msg can be consumed by a <strong>max of one consumer</strong> only</li></ul></li><li>Publish - Subscribe<ul><li>messages are divided into topics</li><li>a publisher sends a message to a topic</li><li>subscribers subscribe to a topic to receive every message published to that topic</li><li>msg system that stores and maintains the msg named as <strong>message broker</strong></li></ul></li></ul></li></ul><h1 id="2-Kafka"><a href="#2-Kafka" class="headerlink" title="2. Kafka"></a>2. Kafka</h1><h2 id="2-1-General"><a href="#2-1-General" class="headerlink" title="2.1 General"></a>2.1 General</h2><ul><li><strong>publish subscribe based</strong> messaging system</li><li>takes streams of messages from applications known as producers, stores them reliably on a central cluster, and allows those messages to be received by applications that process the messages</li><li>kafka is mainly used for<ul><li>reliably storing a huge amount of data</li><li>enabling high throughput of message transfer between different entities</li><li>streaming real time data</li></ul></li><li>kafka is a distributed commit log â€” write ahead log<ul><li>append-only data structure that can <strong>persistently store a sequence of records</strong></li><li>all messages are stored <strong>on disk</strong></li><li>since all reads and writes happen <strong>in sequence</strong>, Kafka takes advantage of <strong>sequential disk reads</strong></li></ul></li></ul><h2 id="2-2-Use-Cases"><a href="#2-2-Use-Cases" class="headerlink" title="2.2 Use Cases"></a>2.2 Use Cases</h2><ul><li>Metrics<ul><li>collect and aggregate monitoring data</li></ul></li><li>Log Aggregation<ul><li>collect logs from multiple sources and make them available in a standard format to multiple consumers</li></ul></li><li>Stream Processing<ul><li>the raw data consumed from a topic is transformed, enriched, or aggregated and pushed to a <strong>new topic</strong> for further consumption. This way of data processing is known as stream processing.</li></ul></li><li>Commit Log<ul><li>can be used as an external commit log for any distributed system</li><li>Distributed services can log their transactions to Kafka to keep track of what is happening. This transaction data can be used for replication between nodes and also becomes very useful for disaster recovery, for example, to help failed nodes to recover their states.</li></ul></li><li>Website activity tracking<ul><li>Build a user activity tracking pipeline</li><li>User activities like page clicks, searches, etc., are published to Kafka into separate topics. These topics are available for subscription for a range of use cases, including real-time processing, real-time monitoring, or loading into Hadoop or data warehousing systems for offline processing and reporting</li></ul></li><li>Product Suggestion</li></ul><h1 id="3-High-Level-Architecture"><a href="#3-High-Level-Architecture" class="headerlink" title="3. High Level Architecture"></a>3. High Level Architecture</h1><h2 id="3-1-Common-Terms"><a href="#3-1-Common-Terms" class="headerlink" title="3.1 Common Terms"></a>3.1 Common Terms</h2><ul><li>Brokers<ul><li>A Kafka server</li><li>responsible for reliably storing data provided by the producers and making it available to the consumers</li></ul></li><li>Records<ul><li>A message or an event that get stored in Kafka</li><li>A record contains<ul><li>key</li><li>value</li><li>timestamp</li><li>optional metadata headers</li></ul></li></ul></li><li>Topics<ul><li>Messages are divided into categories called topics</li><li>Each msg that Kafka receives from a producer is associated with a topic</li><li>consumers can subscribe to a topic to get notified when new messages are added to the topic</li><li>a topic can have multiple subscribers that read messages from it</li><li>a topic is identified by its name and must be unique</li><li>mes in a topic can be read as often as needed â€” message are not deleted after consumption, instead, Kafka <strong>retains messages for a configurable amount of time or until a storage size is exceeded</strong></li></ul></li><li>Producers<ul><li>Applications that publish or write records to Kafka</li></ul></li><li>Consumers<ul><li>Applications that subscribe to read and process data from Kafka topics</li><li>Consumers subscribe to one or more topics and consume published messages by pulling data from the brokers</li><li>In Kafka, producers and consumers are fully decoupled and agnostic of each other, which is a key design element to achieve the high scalability that Kafka is known for</li></ul></li></ul><h2 id="3-2-Architecture"><a href="#3-2-Architecture" class="headerlink" title="3.2 Architecture"></a>3.2 Architecture</h2><p><img src="https://i.loli.net/2021/08/25/Chuwtvg4mNfFU58.png" alt="Overall Architecture"></p><ul><li>Kafka cluster<ul><li>Kafka is run as a cluster of one or more servers, where each server is responsible for running one Kafka broker</li></ul></li><li>ZooKeeper<ul><li>Distributed key value store</li><li>Used for coordination and storing configurations</li><li>Kafka uses ZooKeeper to coordinate between Kafka brokers; ZooKeeper maintains metadata information about the Kafka cluster</li></ul></li></ul><h2 id="3-3-Performance-concern"><a href="#3-3-Performance-concern" class="headerlink" title="3.3 Performance concern"></a>3.3 Performance concern</h2><h3 id="3-3-1-Storing-messages-to-disks"><a href="#3-3-1-Storing-messages-to-disks" class="headerlink" title="3.3.1 Storing messages to disks"></a>3.3.1 Storing messages to disks</h3><ul><li>there is a huge difference in disk performance between <strong>random block access and sequential access</strong>. Random block access is slower because of <strong>numerous disk seeks</strong>, whereas the sequential nature of writing or reading, enables disk operations to be <strong>thousands of times faster</strong> than random access.</li><li>OS level optimization<ul><li>Read Ahead â€” prefetch large block multiples</li><li>Write Behind â€” group small logical writes into big physical writes</li><li>PageCache â€” cache the disk in free RAM</li></ul></li><li>Zero Copy optimization<ul><li>OS copy data from the pageCache directly to a socket, effectively bypassing the kafka broker application entirely</li></ul></li><li>Kafka protocol to group msg together<ul><li>reduce network overhead</li></ul></li></ul><h1 id="4-Dive-Deep-in-Kafka-Cluster"><a href="#4-Dive-Deep-in-Kafka-Cluster" class="headerlink" title="4. Dive Deep in Kafka Cluster"></a>4. Dive Deep in Kafka Cluster</h1><h2 id="4-1-Topic-Partitions"><a href="#4-1-Topic-Partitions" class="headerlink" title="4.1 Topic Partitions"></a>4.1 Topic Partitions</h2><ul><li><p>Topics are partitioned, spread over a number of fragments</p></li><li><p>Each partition can be placed on a separate Kafka broker</p></li><li><p>A new message get appended to one of the topicâ€™s partition</p><ul><li>producer controls which partition it publishes to based on the data</li></ul></li><li><p>One partition is an <strong>ordered sequence</strong> of messages</p><ul><li>producers continually append new messages to partition</li><li>ordering of messages is <strong>maintained at the partition level, not across the topic</strong></li></ul></li><li><p>Unique sequence ID â€” offset</p><ul><li>It will get assigned to every message that enters a partition</li><li>used to identify every messageâ€™s sequential position within a topicâ€™s partition</li><li>offset sequences are unique only to each partition</li><li>to locate a specific message<ul><li>topic</li><li>partition</li><li>offset number</li></ul></li><li>producers can choose to publish a message to any partition<ul><li>if ordering within a partition is not needed, a round robin partition strategy can be used</li><li>Placing each partition on separate Kafka brokers enables multiple consumers to read from a topic in parallel. That means, different consumers can concurrently read different partitions present on separate brokers</li></ul></li></ul></li><li><p>Messages once written to partitions are immutable and cannot be updated.</p></li><li><p>Kafka guarantees that messages with the same key are written to the same partition.</p></li></ul><h2 id="4-2-Dumb-Broker-and-Smart-Consumer"><a href="#4-2-Dumb-Broker-and-Smart-Consumer" class="headerlink" title="4.2 Dumb Broker and Smart Consumer"></a>4.2 Dumb Broker and Smart Consumer</h2><ul><li>Kafka does not keep track of what records are read by the consumer</li><li>Consumers themselves poll kafka for new messages and say what records they want to read<ul><li>this allow them to increment/ decrement the offset they are as they wish</li></ul></li></ul><h2 id="4-3-Leader-and-Follower"><a href="#4-3-Leader-and-Follower" class="headerlink" title="4.3 Leader and Follower"></a>4.3 Leader and Follower</h2><p>Every topic can be replicated to multiple Kafka brokers to make the data fault-tolerant and highly available. Each topic partition has one leader broker and multiple replica (follower) brokers. </p><ul><li>Structure<ul><li>the broker cluster could have multiple brokers, each broker could have multiple partitions which belong to different topics</li><li>Each topic partition would have one lead broker and multiple replica brokers</li></ul></li></ul><h3 id="4-3-1-Leader"><a href="#4-3-1-Leader" class="headerlink" title="4.3.1 Leader"></a>4.3.1 Leader</h3><ul><li>A leader is the node responsible for all reads and writes for the given partition</li><li>Each partition has one kafka broker acting as a leader</li></ul><h3 id="4-3-2-Follower"><a href="#4-3-2-Follower" class="headerlink" title="4.3.2 Follower"></a>4.3.2 Follower</h3><ul><li><p>To handle single point of failure, Kafka replicate partitions and distribute them across multiple broker servers called followers.</p></li><li><p>Each followerâ€™s responsibility is to replicate the leaderâ€™s data to serve as a backup partition</p><ul><li><p>any follower can take over the leadership if the leader goes down</p><ul><li><p>from the image below, you could see only the leader take read and write requests, follower acts as replica but not take any read and write reqeusts</p><p><img src="https://i.loli.net/2021/08/25/4t7kVJfv3jliZyK.png" alt="Leader and Follower"></p></li></ul></li></ul></li></ul><h3 id="4-3-3-In-Sync-Replicas"><a href="#4-3-3-In-Sync-Replicas" class="headerlink" title="4.3.3 In Sync Replicas"></a>4.3.3 In Sync Replicas</h3><ul><li>In Sync Replicas means the broker has the latest data for a given partition</li><li>A leader is always an in sync replica</li><li>A follower is an in sync replica only if it has fully caught up to the partition it is following</li><li>Only ISRs are eligible to become partition leaders.</li><li>Kafka can choose the minimum number of ISRs required before the data becomes available for consumers to read</li></ul><h3 id="4-3-4-High-Water-mark"><a href="#4-3-4-High-Water-mark" class="headerlink" title="4.3.4 High Water mark"></a>4.3.4 High Water mark</h3><ul><li><p>To ensure data consistency, the leader broker never returns (or exposes) messages which have not been replicated to a minimum set of ISRs</p></li><li><p>For this, brokers keep track of the high-water mark, which is the highest offset that all ISRs of a particular partition share</p></li><li><p>The leader exposes data only up to the high-water mark offset and propagates the high-water mark offset to all followers</p><p>  <img src="https://i.loli.net/2021/08/25/pyDKzGCRow6O2Wu.png" alt="High Water Mark"></p></li></ul><h1 id="5-Consumer-Group"><a href="#5-Consumer-Group" class="headerlink" title="5. Consumer Group"></a>5. Consumer Group</h1><ul><li>A set of one or more consumers working together in parallel to consume messages from topic partitions, messages are equally divided among all the consumers of a group. with no two consumers receiving the same message</li></ul><h2 id="5-1-How-to-distribute-a-specific-message-to-only-a-single-consumer"><a href="#5-1-How-to-distribute-a-specific-message-to-only-a-single-consumer" class="headerlink" title="5.1 How to distribute a specific message to only a single consumer"></a>5.1 How to distribute a specific message to only a single consumer</h2><ul><li><p>only a single consumer reads messages from any partition within a consumer group</p><ul><li>means only one consumer can work on a partition in a consumer group at a time</li><li>every time a consumer is added to or removed from a group, the consumption is rebalanced within the group</li></ul></li><li><p>with consumer groups, consumers can be parallelized so that multiple consumers can read from multiple partitions on a topic, allowing a very high message processing throughput</p></li><li><p>number of partitions impacts consumersâ€™ maximum parallelism. as there cannot be more consumers than partitions</p></li><li><p>Kafka stores the <strong>current offset per consumer group per topic per partition</strong>, as it would for a single consumer. This means that unique messages are only sent to a single consumer in a consumer group, and the load is balanced across consumers as equally as possible</p></li><li><p><strong>Number of consumers in a group = number of partitions:</strong> each consumer consumes one partition.</p></li><li><p><strong>Number of consumers in a group &gt; number of partitions:</strong> some consumers will be idle.</p></li><li><p><strong>Number of consumers in a group &lt; number of partitions:</strong> some consumers will consume more partitions than others.</p></li></ul><h1 id="6-Kafka-Workflow"><a href="#6-Kafka-Workflow" class="headerlink" title="6. Kafka Workflow"></a>6. Kafka Workflow</h1><h2 id="6-1-Pub-sub-messaging"><a href="#6-1-Pub-sub-messaging" class="headerlink" title="6.1 Pub sub messaging"></a>6.1 Pub sub messaging</h2><ul><li>Producer publish messages on a topic</li><li>Kafka broker stores messages in the partitions configured for that particular topic.<ul><li>If the producer did not specify the partition in which the msg should be stored, the broker ensures that the msg are equally shared between partitions</li><li>If the producer sends two msgs and there are two partitions, Kafka will store those two in two partitions separately.</li></ul></li><li>consumer subscribe to a specific topic</li><li>Kafka will provide the current offset of the topic to the consumer and also saves that offset in the zookeeper</li><li>consumer request kafka at regular intervals for new msgs</li><li>once kafka receives msg from producers, it forward these messages to the consumer</li><li>consumer will receive msg and process it</li><li>once processed, consumer will send an acknowledgement to the kafka broker</li><li>upon receiving the acknowledgement, kafka <strong>increments the offset and updates it in the zooKeeper</strong><ul><li>this info is stored in zooKeeper, thus consumer could read the next msg correctly even during broker outages</li></ul></li><li>consumers can rewind/ skip to the desired offset of a topic at any time and read all the subsequent messages</li></ul><h2 id="6-2-Kafka-workflow-for-consumer-group"><a href="#6-2-Kafka-workflow-for-consumer-group" class="headerlink" title="6.2 Kafka workflow for consumer group"></a>6.2 Kafka workflow for consumer group</h2><ul><li>Producers publish messages on a topic.</li><li>Kafka stores all messages in the partitions configured for that particular topic, similar to the earlier scenario.</li><li>A single consumer subscribes to a specific topic, assume <code>Topic-01</code> with Group ID as <code>Group-1</code>.</li><li>Kafka interacts with the consumer in the same way as pub-sub messaging until a new consumer subscribes to the same topic, <code>Topic-01</code>, with the same Group ID as <code>Group-1</code>.</li><li>Once the new consumer arrives, Kafka switches its operation to share mode, such that each message is passed to only one of the subscribers<br>of the consumer group <code>Group-1</code>. This message transfer is<br>similar to queue-based messaging, as only one consumer of the group<br>consumes a message. Contrary to queue-based messaging, messages are not<br>removed after consumption.</li><li>This message transfer can go on until the number of consumers<br>reaches the number of partitions configured for that particular topic.</li><li>Once the number of consumers exceeds the number of partitions, the<br>new consumer will not receive any message until an existing consumer<br>unsubscribes. This scenario arises because each consumer in Kafka will<br>be assigned a minimum of one partition. Once all the partitions are<br>assigned to the existing consumers, the new consumers will have to wait.</li></ul><h1 id="7-ZooKeeper"><a href="#7-ZooKeeper" class="headerlink" title="7. ZooKeeper"></a>7. ZooKeeper</h1><h2 id="7-1-What-is-ZooKeeper"><a href="#7-1-What-is-ZooKeeper" class="headerlink" title="7.1 What is ZooKeeper"></a>7.1 What is ZooKeeper</h2><ul><li>A distributed configuration and synchronization service</li><li>In Kafka case, help to store basic metadata<ul><li>information about brokers</li><li>topics</li><li>partitions</li><li>partition leader/ followers</li><li>consumer offsets</li></ul></li></ul><h2 id="7-2-Act-as-central-coordinator"><a href="#7-2-Act-as-central-coordinator" class="headerlink" title="7.2 Act as central coordinator"></a>7.2 Act as central coordinator</h2><p>ZooKeeper is used for storing all sorts of metadata about the Kafka cluster:</p><ul><li>It maintains the <strong>last offset position</strong> of each consumer group per partition, so that consumers can quickly recover from the last position in case of a failure (although modern clients store offsets in a<br>separate Kafka topic).</li><li>It tracks the topics, number of partitions assigned to those topics, and leadersâ€™/followersâ€™ location in each partition.</li><li>It also manages the access control lists (ACLs) to different topics in the cluster. ACLs are used to enforce access or authorization.</li></ul><h2 id="7-3-How-to-find-leaders"><a href="#7-3-How-to-find-leaders" class="headerlink" title="7.3 How to find leaders"></a>7.3 How to find leaders</h2><ul><li>The producer connects to any broker and asks for the leader of Partition 1<ul><li>each broker contains metadata</li><li>each brokers will talk to zooKeeper to get the latest metadata</li></ul></li><li>The broker responds with the identification of the leader broker responsible for partition 1</li><li>The producer connects to the leader broker to publish the message</li></ul><h1 id="8-Controller-Broker"><a href="#8-Controller-Broker" class="headerlink" title="8. Controller Broker"></a>8. Controller Broker</h1><ul><li>Within the Kafka cluster, one broker will be elected as the Controller</li><li>Responsibility<ul><li>admin operations<ul><li>creating/ deleting a topic</li><li>adding partitions</li><li>assigning leaders to partitions</li><li>monitoring broker failures</li></ul></li><li>check the health of other brokers in the system periodically</li><li>communicates the result of the partition leader election to other brokers in the system</li></ul></li></ul><h2 id="8-1-Split-brain-issue"><a href="#8-1-Split-brain-issue" class="headerlink" title="8.1 Split brain issue"></a>8.1 Split brain issue</h2><ul><li>some controller has temporary issue, during the period, we assign a new controller, but the previous one auto recover, so we have two controllers and it could bring inconsistency easily.</li><li>Solution:<ul><li>Generation Clock<ul><li>simply a monotonically increasing number to indicate a serverâ€™s generation</li><li>If the old leader had an epoch number of â€˜1â€™, the new one would have â€˜2â€™.</li><li>This epoch is included in every request that is sent from the Controller to other brokers.</li><li>This way, brokers can now easily differentiate the real Controller by simply trusting the Controller with the highest number.</li><li>The Controller with the highest number is undoubtedly the latest one, since the epoch number is always increasing.</li><li>This epoch number is stored in ZooKeeper.</li></ul></li></ul></li></ul><h1 id="9-Delivery-Semantics"><a href="#9-Delivery-Semantics" class="headerlink" title="9. Delivery Semantics"></a>9. Delivery Semantics</h1><h2 id="9-1-Producer-Delivery-Semantics"><a href="#9-1-Producer-Delivery-Semantics" class="headerlink" title="9.1 Producer Delivery Semantics"></a>9.1 Producer Delivery Semantics</h2><ul><li>How can a producer know that the data is successfully stored at the leader or that the followers are keeping up with the leader</li><li>Kafka offers three options to denote the <strong>number of brokers</strong> that <strong>must receive the record</strong> before the <strong>producer considers the write as successful</strong><ul><li>Async<ul><li>Producer sends a msg to kafka and does not wait for acknowledgement from the server</li><li>fire-and-forget approach gives the best performance as we can write data to Kafka at network speed, but <strong>no guarantee can be made</strong> that the server has received the record in this case.</li></ul></li><li>Committed to Leader<ul><li>Producer waits for an acknowledgment from the leader.</li><li>This ensures that the data is committed at the leader; it will be slower than the â€˜Asyncâ€™ option, as the data has to be written on disk on the leader.</li><li>Under this scenario, the leader will respond without waiting for acknowledgments from the followers.</li><li>In this case, the record <strong>will be lost if the leader crashes immediately after acknowledging the producer but before the followers have replicated it</strong>.</li></ul></li><li>Committed to Leader and Quorum<ul><li>Producer waits for an acknowledgment from the leader and the quorum. This means the leader will wait for the full set of in-sync replicas to acknowledge the record. This will be the slowest write but guarantees that the record will not be lost as long as at least one in-sync replica remains alive. This is the strongest available guarantee.</li></ul></li></ul></li></ul><h2 id="9-2-Consumer-Delivery-Semantics"><a href="#9-2-Consumer-Delivery-Semantics" class="headerlink" title="9.2 Consumer Delivery Semantics"></a>9.2 Consumer Delivery Semantics</h2><ul><li>Ways to provide consistency to the consumer<ul><li>At most once<ul><li>Message may be lost but are never redelivered</li><li>Under this option, the consumer upon receiving a message, commit (or increment) the offset to the broker. Now, if the consumer crashes before fully consuming the message, that message will be lost, as when the consumer restarts, it will receive the next message from the last committed offset.</li></ul></li><li>At least once<ul><li>Messages are never lost but maybe redelivered</li><li>This scenario occurs when the consumer receives a message from Kafka, and it does not immediately commit the offset.</li><li>Instead, it waits till it completes the processing.</li><li>So, if the consumer crashes after processing the message but before committing the offset, it has to reread the message upon restart.</li><li>Since, in this case, the consumer never committed the offset to the broker, the broker will redeliver the same message. Thus, duplicate message delivery could happen in such a scenario.</li></ul></li><li>Exactly once<ul><li>It is very hard to achieve this unless the consumer is working with a transactional system.</li><li>Under this option, the consumer puts the message processing and the offset increment in one transaction.</li><li>This will ensure that the offset increment will happen only if the whole transaction is complete.</li><li>If the consumer crashes while processing, the transaction will be rolled back, and the offset will not be incremented. When the consumer restarts, it can reread the message as it failed to process it last time. This option leads to no data duplication and no data loss but can lead to decreased throughput.</li></ul></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Overview-of-Messaging-Systems&quot;&gt;&lt;a href=&quot;#1-Overview-of-Messaging-Systems&quot; class=&quot;headerlink&quot; title=&quot;1. Overview of Messaging Syste
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
