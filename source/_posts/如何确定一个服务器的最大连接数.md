---
title: 如何确定一个服务器的最大连接数
date: 2020-02-02 15:05:38
categories: SystemDesign
tags:
top:
---

# 1. 连接数定义

对于给定的一个服务器而言，在任意时刻能够同时处理的最大连接数。

# 2. Tips

## 2.1 如果超过了会怎么样

+ 如果使用了Spillover的feature，额外的请求会被放置到队列里
+ 如果没使用，那么HTTP 503会返回，对于TCP连接，会被重置掉


## 2.2 如果得出准确的允许的最大连接数？

没有办法直接得出，因为运行的代码本身，机器本身都会对结果产生影响的，最好的方式依旧是做测试，即不停更改最大连接数，单独测试一个host在不同连接数的情况下的metrics，譬如延时问题，有没有fatals, etc. 以此来得到针对实际情况的正确地值。

## 2.3 General 公式

+ 需要使用的CPU时间 (local resource)
+ 远端，网路延时 （remote latency）
+ CPU 核心数量


参考公式

    maxConns = ((local + remote) / local) * cores
